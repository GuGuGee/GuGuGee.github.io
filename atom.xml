<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>我不是咕咕鸽</title>
  
  <subtitle>VPS折腾不完全记录</subtitle>
  <link href="https://blog.laoda.de/atom.xml" rel="self"/>
  
  <link href="https://blog.laoda.de/"/>
  <updated>2023-11-26T09:53:05.232Z</updated>
  <id>https://blog.laoda.de/</id>
  
  <author>
    <name>咕咕鸽</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【好玩儿的Docker项目】2023重制版本！10分钟搭建一个专属的密码管理工具——Vaultwarden</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-vaultwarden/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-vaultwarden/</id>
    <published>2023-11-26T06:41:33.000Z</published>
    <updated>2023-11-26T09:53:05.232Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>这期我们来更新一下之前分享过的vaultwarden的搭建教程。</p><p>之前的教程：<a href="https://blog.laoda.de/archives/bitwarden-docker-install/index.html">【保姆级教程】利用宝塔面板 + Docker 搭建一个优秀的密码管理器 ——Bitwarden</a></p><p>这次我们直接用docker来搭建，不需要宝塔面板。而且相对于之前，不需要特意去设置自动同步，整个搭建下来更加容易。</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>见原来的文章：<a href="https://blog.laoda.de/archives/bitwarden-docker-install/index.html">https://blog.laoda.de/archives/bitwarden-docker-install/index.html</a></p><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>官方GitHub地址：<a href="https://github.com/dani-garcia/vaultwarden">https://github.com/dani-garcia/vaultwarden</a><br>官方docker镜像地址（官方构建镜像在3个不同的容器注册中心都可用）：</p><ul><li>GitHub: ghcr.io&#x2F;dani-garcia&#x2F;vaultwarden</li><li>Docker Hub: docker.io&#x2F;vaultwarden&#x2F;server</li><li>Quay: quay.io&#x2F;vaultwarden&#x2F;server</li></ul><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li><p>服务器：咕咕这边用的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）或者<a href="https://gao.ee/lca">莱卡云</a>的香港或者美国CN2 GIA</p></li><li><p>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</p></li><li><p>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</p></li><li><p>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p></li><li><p>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</p></li><li><p>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</p></li></ul><blockquote><p>服务器建议：1C1G，能搭建docker即可</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/ZaBSMPRlvXo">https://youtu.be/ZaBSMPRlvXo</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1cH4y117eU/">https://www.bilibili.com/video/BV1cH4y117eU/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/vaultwarden</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/vaultwarden</span><br><span class="line"></span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">vaultwarden:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vaultwarden</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vaultwarden/server:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/:/data/</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOMAIN=https://subdomain.yourdomain.com</span> <span class="comment"># 这是您希望与您的Vaultwarden实例关联的域名。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOGIN_RATELIMIT_MAX_BURST=10</span> <span class="comment"># 允许在一阵登录/两步验证尝试中的最大请求次数。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOGIN_RATELIMIT_SECONDS=60</span> <span class="comment"># 这是来自同一IP的登录请求之间的平均秒数，在Vaultwarden限制登录次数之前。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ADMIN_RATELIMIT_MAX_BURST=10</span> <span class="comment"># 这与LOGIN_RATELIMIT_MAX_BURST相同，只争对admin面板。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ADMIN_RATELIMIT_SECONDS=60</span> <span class="comment"># 这与LOGIN_RATELIMIT_SECONDS相同</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ADMIN_SESSION_LIFETIME=20</span> <span class="comment"># 会话持续时间</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ADMIN_TOKEN=YourReallyStrongAdminTokenHere</span> <span class="comment"># 此值是Vaultwarden管理员面板的令牌（一种密码）。为了安全起见，这应该是一个长的随机字符串。如果未设置此值，则管理员面板将被禁用。建议openssl rand -base64 48 生成ADMIN_TOKEN确保安全</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SENDS_ALLOWED=true</span>  <span class="comment"># 此设置决定是否允许用户创建Bitwarden发送 - 一种凭证共享形式。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">EMERGENCY_ACCESS_ALLOWED=true</span> <span class="comment"># 此设置控制用户是否可以启用紧急访问其账户的权限。例如，这样做可以在用户去世后，配偶可以访问密码库以获取账户凭证。可能的值：true / false。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">WEB_VAULT_ENABLED=true</span> <span class="comment"># 此设置决定了网络保险库是否可访问。一旦您配置了您的账户和客户端，停止您的容器，然后将此值切换为false并重启Vaultwarden，可以用来防止未授权访问。可能的值：true/false。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SIGNUPS_ALLOWED=true</span> <span class="comment"># 此设置控制新用户是否可以在没有邀请的情况下注册账户。可能的值：true / false。</span></span><br></pre></td></tr></table></figure><p>简单说一下：</p><ul><li><code>DOMAIN</code>改成最后你要用的域名形式</li><li><code>ADMIN_TOKEN</code>可以在ssh里面输入<code>openssl rand -base64 48</code>生成</li><li><code>SIGNUPS_ALLOWED</code>等你注册好之后，如果你只是想自己用，可以把这边改成<code>false</code></li></ul><p>切换成英文输入法，修改好之后，按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8080</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>类似图中的，这边我们填 <code>8080</code>，示例填 <code>vaultwarden</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2023/11/01/nlmaxe-0.webp" alt="56a42aff23098af08c1ae587e19739ae.png" style="zoom:33%;" /><p>查看端口是否被占用（以 <code>8080</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8080  <span class="comment">#查看 8080 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8381</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8080</code> 访问了。</p><p>但是这边我们必须先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>这边以vaultwarden为例子，element也是一样操作即可。</p><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/11/24/ik9r6h-0.webp" alt="c8d15ba5227c2308a0518b99afb9663d.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/24/ikbf64-0.webp" alt="fae45bafe2e8deb8cdec4d0581b1bd9d.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/24/ikcgse-0.webp" alt="2c42648f904d6a6bb84a5f25c2e463c0.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/24/ikmexm-0.webp" alt="354981f64863e9c5804a3e3a6f2e1df0.png" style="zoom:33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8080</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 vaultwarden 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>vaultwarden</code> 所在的服务器 IP 就行。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8080/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者自己尝试一下。</p><h3 id="8-1-更新-vaultwarden"><a href="#8-1-更新-vaultwarden" class="headerlink" title="8.1 更新 vaultwarden"></a>8.1 更新 vaultwarden</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/root/data/docker_data/vaultwarden</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span>    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">image</span> <span class="string">prune</span>  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-vaultwarden"><a href="#8-2-卸载-vaultwarden" class="headerlink" title="8.2 卸载 vaultwarden"></a>8.2 卸载 vaultwarden</h3><p>同样进入安装页面，先停止所有容器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/vaultwarden</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/vaultwarden  <span class="comment"># 完全删除</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题及注意点"><a href="#9-常见问题及注意点" class="headerlink" title="9. 常见问题及注意点"></a>9. 常见问题及注意点</h2><h3 id="关于启用WebSocket"><a href="#关于启用WebSocket" class="headerlink" title="关于启用WebSocket"></a>关于启用WebSocket</h3><img src="https://img.laoda.de/i/2023/11/24/ikp6qg-0.webp" alt="9fb7413dd800b6d8c6df2941d456c730.png" style="zoom: 50%;" /><p><strong>自v1.29.0版本起，Vaultwarden默认启用了WebSocket。</strong></p><blockquote><p>WebSocket通知用于通知浏览器、桌面和浏览器扩展Bitwarden客户端某些事件已经发生，例如密码数据库中的条目被修改或删除时。收到通知后，客户端可以采取适当的行动，比如刷新被修改的条目，或者从其本地缓存中移除被删除的条目。在这种通知方案中，Bitwarden客户端与Bitwarden服务器（在这种情况下是Vaultwarden）建立一个持久的WebSocket连接。每当服务器有事件要报告时，它就通过这个持久连接将事件发送给客户端。</p></blockquote><p>之前的版本需要一个反向代理，因为WebSocket运行在与默认HTTPS端口不同的端口上。</p><p>自Vaultwarden版本 1.29.0 起，您可以激活移动客户端推送通知，以便在移动应用、网页扩展和网页保险库之间自动同步您的个人保险库，无需手动同步。</p><p>详情请见wiki ——<a href="https://github.com/dani-garcia/vaultwarden/wiki/Enabling-WebSocket-notifications">Enabling WebSocket notifications</a></p><h3 id="admin页面"><a href="#admin页面" class="headerlink" title="admin页面"></a>admin页面</h3><p>此页面允许服务器管理员查看所有已注册用户并删除他们。即使在禁用注册的情况下，它也允许邀请新用户。</p><h3 id="插件、客户端"><a href="#插件、客户端" class="headerlink" title="插件、客户端"></a>插件、客户端</h3><p>见原来的文章：<a href="https://blog.laoda.de/archives/bitwarden-docker-install/index.html">https://blog.laoda.de/archives/bitwarden-docker-install/index.html</a></p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/dani-garcia/vaultwarden/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/dani-garcia/vaultwarden">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/dani-garcia/vaultwarden">https://github.com/dani-garcia/vaultwarden</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;这期我们来更新一下之前分享过的vaultwarden的搭建教程。&lt;/p&gt;
&lt;p&gt;之前的教程：&lt;a href=&quot;https:/</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="密码管理工具" scheme="https://blog.laoda.de/tags/%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Bitwarden" scheme="https://blog.laoda.de/tags/Bitwarden/"/>
    
    <category term="腾讯云香港轻量服务器" scheme="https://blog.laoda.de/tags/%E8%85%BE%E8%AE%AF%E4%BA%91%E9%A6%99%E6%B8%AF%E8%BD%BB%E9%87%8F%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="密码管理" scheme="https://blog.laoda.de/tags/%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>2023黑五个人比较推荐的几款机器和服务整理（持续更新中）</title>
    <link href="https://blog.laoda.de/archives/bf2023/"/>
    <id>https://blog.laoda.de/archives/bf2023/</id>
    <published>2023-11-24T06:58:11.000Z</published>
    <updated>2023-11-26T09:54:18.382Z</updated>
    
    <content type="html"><![CDATA[<h2 id="域名邮箱"><a href="#域名邮箱" class="headerlink" title="域名邮箱"></a>域名邮箱</h2><p>黑五&#x2F;mxroute域名邮局，非常稳定好用，比自建的省心，咕咕目前手持两款。做邮件评论收发邮件非常合适。</p><p>使用教程：<a href="https://blog.laoda.de/archives/mxroute-settings/index.html">【转载】MXroute 使用教程</a></p><p>【小型】</p><ul><li>10GB 存储</li><li>无限域名</li><li>无限电子邮件帐户</li><li>每小时 300 个出站（每个电子邮件帐户）</li><li>15 美元&#x2F;3 年</li></ul><p><a href="https://accounts.mxroute.com/?cmd=cart&action=add&id=250">https://accounts.mxroute.com/?cmd=cart&amp;action=add&amp;id=250</a></p><p>【中型】</p><ul><li>25GB 存储</li><li>无限域名</li><li>无限电子邮件帐户</li><li>每小时 300 个出站（每个电子邮件帐户）</li><li>30 美元&#x2F;3 年</li></ul><p><a href="https://accounts.mxroute.com/?cmd=cart&action=add&id=251">https://accounts.mxroute.com/?cmd=cart&amp;action=add&amp;id=251</a></p><p>【大型】</p><ul><li>50GB 存储</li><li>无限域名</li><li>无限电子邮件帐户</li><li>每小时 300 个出站（每个电子邮件帐户）</li><li>$34.50 &#x2F; 年</li><li>$69 &#x2F; 2 年</li><li>$99 &#x2F; 3 年</li></ul><p><a href="https://accounts.mxroute.com/?cmd=cart&action=add&id=253">https://accounts.mxroute.com/?cmd=cart&amp;action=add&amp;id=253</a></p><p>我们可能还会在<a href="https://mxroute.blackfriday/">https://mxroute.blackfriday</a> 页面上提供其他优惠。</p><h2 id="VPS"><a href="#VPS" class="headerlink" title="VPS"></a>VPS</h2><p><img src="https://img.laoda.de/i/2023/11/24/o1twwo-0.webp" alt="b151154e72784f508c3eb2b4777eb07b.png"></p><h3 id="Racknerd（廉价玩具鸡）"><a href="#Racknerd（廉价玩具鸡）" class="headerlink" title="Racknerd（廉价玩具鸡）"></a>Racknerd（廉价玩具鸡）</h3><p><strong>适合用户：</strong>预算不高的小伙伴</p><p>Racknerd各个档位的机器全览：<a href="https://blog.laoda.de/vps">https://blog.laoda.de/vps</a></p><p>闪购基本上买不到的，直接看上面列表里的，机房选洛杉矶、西雅图、圣何塞就行。</p><img src="https://img.laoda.de/i/2023/11/24/o2wchm-0.webp" alt="4bb97a9793d3c8994a196c3f8e59756a.png" style="zoom:33%;" /><h3 id="DMIT（适合建站）"><a href="#DMIT（适合建站）" class="headerlink" title="DMIT（适合建站）"></a>DMIT（适合建站）</h3><p><strong>适合用户：</strong>对线路要求高的，预算尚可，又有建站需求的小伙伴</p><p>DMIT 黑五  美西 <a href="https://blog.laoda.de/archives/vps-route/">CN2 GIA</a> 年付 139美金一年<del>（优惠之后125.10刀，优惠码 <code>66VIP-BF2023-#DMIT#</code>）</del> 优惠码已经失效 &#x3D; &#x3D;</p><p>【PVM.LAX.sPro】</p><ul><li>2 vCPU</li><li>2 GB RAM</li><li>40 GB SSD Storage</li><li>1000 GB Transfer</li><li>300Mbps VirtIO Interface</li><li>1 IPv4 &amp; 1 IPv6 &#x2F;64</li><li>5Tbps+ DDoS Protection Always-On</li></ul><p>适合有建站需求的小伙伴，自带DDos防护 <a href="https://www.dmit.io/aff.php?aff=3967&pid=184">点击购买</a></p><p><img src="https://img.laoda.de/i/2023/11/24/o2cj0g-0.webp" alt="img"></p><p>推荐阅读：<a href="https://blog.laoda.de/archives/vps-route/">【VPS选购小常识】VPS线路解析不完全指南 什么是CN2 GIA？什么是AS9929、AS4837？什么是CU VIP？什么是移动CMI？如何判断回程路由？</a></p><h3 id="nanraja（适合建站、跑项目）"><a href="#nanraja（适合建站、跑项目）" class="headerlink" title="nanraja（适合建站、跑项目）"></a>nanraja（适合建站、跑项目）</h3><p><strong>适合用户：</strong>对性能有一定要求，稳定使用的用户</p><p>硬件牛逼，线路有点差，套CF的CDN食用，或者用欧洲9929、GIA反代。（比如<a href="https://loll.cc/olink">olink法兰克福9929</a>，搬瓦工之前的荷兰9929机房）</p><p>记得可以抗投诉来着，这次还上了zen4CPU<br><a href="https://lowendtalk.com/discussion/190344/black-friday-blazingly-fast-amd-epyc-9554-genoa-zen-4">https://lowendtalk.com/discussion/190344/black-friday-blazingly-fast-amd-epyc-9554-genoa-zen-4</a></p><p>【VPS 2 GB】</p><ul><li>1 vCores (AMD EPYC™ 9554)</li><li>2 GB Ram (DDR5)</li><li>50 GB NVMe Raid 10</li><li>1 IPV4 &amp; IPv6</li><li>5 TB transfer @ 2.5 Gbe network connection</li><li>Location: Dronten, NL</li><li>Price 18€ per year with coupon code <code>LES9YUJA9FNV4</code></li></ul><p><a href="https://clients.naranja.tech/store/black-friday-2023">https://clients.naranja.tech/store/black-friday-2023</a></p><p>记得用优惠码 <code>LES9YUJA9FNV4</code></p><h3 id="LiteServer（适合建站、跑项目）"><a href="#LiteServer（适合建站、跑项目）" class="headerlink" title="LiteServer（适合建站、跑项目）"></a>LiteServer（适合建站、跑项目）</h3><p><strong>适合用户：</strong>对性能有一定要求，稳定使用的用户</p><p>之前的相关介绍：<a href="https://blog.laoda.de/archives/liteserver-bf-2022-01/">【VPS 黑五促销】LiteServer—— 荷兰老商家，口碑很好，黑五终身 4 折，荷兰大硬盘 VPS ，500G HDD 月付€2.4， 1T HDD 月付€4.8</a></p><p>硬件牛逼，线路有点差，套CF的CDN食用，或者用<a href="https://loll.cc/olink">欧洲9929</a>、GIA反代。</p><p>详情：<a href="https://lowendtalk.com/discussion/190346/nl-black-friday-to-cyber-monday-deals-nvme-vps-plans-and-nvme-webhosting-and-reseller-webhostin">https://lowendtalk.com/discussion/190346/nl-black-friday-to-cyber-monday-deals-nvme-vps-plans-and-nvme-webhosting-and-reseller-webhostin</a></p><h3 id="servaRICA（大盘鸡）"><a href="#servaRICA（大盘鸡）" class="headerlink" title="servaRICA（大盘鸡）"></a>servaRICA（大盘鸡）</h3><p>比较稳，但是线路比较差。</p><p>之前的相关介绍：<a href="https://blog.laoda.de/archives/vps-servarica/index.html">【VPS 选购分享】Servarica —— 促销款 48 刀 2T 大盘鸡测评，机房位于加拿大蒙特利尔</a></p><p><a href="https://servarica.com/all-offers/">https://servarica.com/all-offers/</a></p><p><img src="https://img.laoda.de/i/2023/11/24/o1vofn-0.webp" alt="d57c5cada8563bf2f116f606de231a41.png"></p><h3 id="Hosthatch（本次黑五性价比不高，可以看看，不是很推荐）"><a href="#Hosthatch（本次黑五性价比不高，可以看看，不是很推荐）" class="headerlink" title="Hosthatch（本次黑五性价比不高，可以看看，不是很推荐）"></a>Hosthatch（本次黑五性价比不高，可以看看，不是很推荐）</h3><p>考虑了一下，还是放上来，但是不是很推荐大家购买。</p><p>之前的测评：<a href="https://blog.laoda.de/archives/vps-hosthatch/index.html">【VPS 选购分享】HostHatch—— 目前看过的最高性价比大盘鸡！40 刀 &#x2F; 年 2T 硬盘！</a></p><blockquote><p>特色：期货鸡，一般买了需要半个月到一个月才会开通，工单回复很慢</p></blockquote><p>hosthatch来了，价格一般，之前丢过数据，不过现在nvme很多地区有快照了。</p><p>综合来说，这次价格不是很实惠。40刀&#x2F;年 2T硬盘一去不复返了。</p><p>活动链接：<a href="https://lowendtalk.com/discussion/190331/black-friday-2023-nvme-and-storage-deals">https://lowendtalk.com/discussion/190331/black-friday-2023-nvme-and-storage-deals</a></p><p>之前的测评：<a href="https://blog.laoda.de/archives/vps-hosthatch/index.html">【VPS 选购分享】HostHatch—— 目前看过的最高性价比大盘鸡！40 刀 &#x2F; 年 2T 硬盘！</a></p><h3 id="Contabo（以前很香，现在超售比较多，可以看看，不是很推荐）"><a href="#Contabo（以前很香，现在超售比较多，可以看看，不是很推荐）" class="headerlink" title="Contabo（以前很香，现在超售比较多，可以看看，不是很推荐）"></a>Contabo（以前很香，现在超售比较多，可以看看，不是很推荐）</h3><p>contabo 黑五 4c8g 200g 免安装 免位置费 年付 €49.50 （这家以前很不错，后来超售了内存有点虚标，大家按需求上，线路比较拉垮。号上没机器，一段时间会删号）</p><p>机器挺稳的，硬盘是实打实的，CPU和内存超售，做好心理准备。</p><p>这次特色：</p><ul><li>免安装费+免位置费（本来除了德国机房，亚洲和其他地区机房都要加钱的）</li></ul><p>地址：<a href="https://contabo.com/en">https://contabo.com/en</a></p><p><img src="https://img.laoda.de/i/2023/11/24/scrtrh-0.webp" alt="image-20231124171447823"></p><h3 id="其他（适合手速网速好、有精力的小伙伴）"><a href="#其他（适合手速网速好、有精力的小伙伴）" class="headerlink" title="其他（适合手速网速好、有精力的小伙伴）"></a>其他（适合手速网速好、有精力的小伙伴）</h3><p>有一定概率出现神🐔。</p><img src="https://img.laoda.de/i/2023/11/24/o1wpwv-0.webp" alt="f0a646e57871fbefc3113767bdd80eda.png" style="zoom:50%;" /><p>LET闪购活动每20-40分钟发布一个闪购，超过280个优惠已经就绪，敬请关注→→→<a href="https://lowendtalk.com/discussion/190145/2023-black-friday-cyber-monday-flash-sale-megathread">2023 Black Friday Cyber Monday - FLASH SALE + MEGATHREAD</a></p><p>我们将在活动日的前一小时（如美国东部时间 11 月 24 日晚上 11 点）发布抢先预览，以便您了解可能出现的优惠，但请注意，由于不可预见的情况，优惠可能会发生变化，但如果抢先预览中的任何内容发生变化，我们将予以公布。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;域名邮箱&quot;&gt;&lt;a href=&quot;#域名邮箱&quot; class=&quot;headerlink&quot; title=&quot;域名邮箱&quot;&gt;&lt;/a&gt;域名邮箱&lt;/h2&gt;&lt;p&gt;黑五&amp;#x2F;mxroute域名邮局，非常稳定好用，比自建的省心，咕咕目前手持两款。做邮件评论收发邮件非常合适。&lt;/p&gt;
</summary>
      
    
    
    
    <category term="VPS推荐" scheme="https://blog.laoda.de/categories/VPS%E6%8E%A8%E8%8D%90/"/>
    
    
    <category term="黑五" scheme="https://blog.laoda.de/tags/%E9%BB%91%E4%BA%94/"/>
    
    <category term="性价比" scheme="https://blog.laoda.de/tags/%E6%80%A7%E4%BB%B7%E6%AF%94/"/>
    
  </entry>
  
  <entry>
    <title>【每月一荐】推荐5个好用的Chrome插件，再也不用担心看不懂外文了！还可以下载推特视频！｜外文学习、Chrome插件管理</title>
    <link href="https://blog.laoda.de/archives/chrome-extension-recommendation-01/"/>
    <id>https://blog.laoda.de/archives/chrome-extension-recommendation-01/</id>
    <published>2023-11-18T05:45:52.000Z</published>
    <updated>2023-11-18T08:18:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>从这周起，咕咕争取每月给大家更新一些好玩有用，可以提高生产力的网站或者小工具，帮助大家更好的学习、搬砖。</p><p>这周带来5个咕咕常用的Chrome插件。</p><h3 id="视频地址"><a href="#视频地址" class="headerlink" title="视频地址"></a>视频地址</h3><p>YouTube: <a href="https://youtu.be/N1r8ogb-hsg">https://youtu.be/N1r8ogb-hsg</a></p><h3 id="沉浸式翻译（建议搭配OpenAI的API-Key使用）"><a href="#沉浸式翻译（建议搭配OpenAI的API-Key使用）" class="headerlink" title="沉浸式翻译（建议搭配OpenAI的API Key使用）"></a>沉浸式翻译（建议搭配OpenAI的API Key使用）</h3><p>项目主页：<a href="https://immersivetranslate.com/">https://immersivetranslate.com/</a></p><p>GitHub：<a href="https://github.com/immersive-translate/immersive-translate/">https://github.com/immersive-translate/immersive-translate/</a></p><p>一款免费的，好用的，没有废话的，革命性的，饱受赞誉的，AI 驱动的双语网页翻译扩展，帮助你有效地打破信息差，在手机上也可以用！</p><img src="https://img.laoda.de/i/2023/10/18/pbtzg5-0.webp" alt="5ac550d4974f1d5d7844d25a5613aa93.png" style="zoom:50%;" /><p>可以选择开通会员，如果你和咕咕一样有open ai的OpenAI或者 Azure OpenAI的API Key，也可以直接调用API来使用。</p><p>推荐阅读：<a href="https://blog.laoda.de/archives/play-with-chatgpt/index.html">从注册到畅玩 ChatGPT—— 目前世界上最先进的民用 AI 聊天机器人</a></p><img src="https://img.laoda.de/i/2023/10/18/pc4617-0.webp" alt="cfcf16c544a849f317aada85854af8c0.png" style="zoom:50%;" /><h4 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h4><ul><li><strong>沉浸式阅读外文网站</strong> 通过智能识别网页主内容区域并进行双语对照翻译，沉浸式翻译提供了全新的外文阅读体验，因此得名“沉浸式翻译”。</li><li><strong>强大的输入框翻译</strong>，将任何网页上的输入框化身为多语言翻译器，立刻解锁谷歌搜索，ChatGPT 等工具的双语实时对话体验。</li><li><strong>高效的文件翻译</strong> 一键导出双语电子书，同时支持 PDF、字幕、TXT 等文件的实时双语翻译。</li><li><strong>创新的鼠标悬停翻译</strong> 仅需将鼠标停留在任意网页的任意段落上，相应的译文就会立即出现在段落下方。段落在在沉浸式翻译的设计理念中被视为最小单位，保留其上下文，这样我们才能真正理解并学习外语。</li><li><strong>深度定制优化主流网站</strong> 针对 Google、Twitter、Reddit、YouTube、彭博社、华尔街日报等主流网站进行优化，无论是搜索、社交还是获取资讯，都更加流畅高效。</li><li><strong>全平台支持</strong> 除了各大桌面端浏览器，移动设备也可享受同样的沉浸式翻译体验。在 iOS Safari、安卓 Kiwi 浏览器等移动端浏览器上轻松实现双语浏览 Twitter,Reddit 等社交媒体。</li><li><strong>支持 10+种翻译服务</strong> 在沉浸式翻译中，你可以选择超过 10 种翻译服务，如 Deepl、OpenAI、微软翻译、谷歌翻译、腾讯翻译等等，这份名单还在不断增加中。</li></ul><p>作者希望大家能轻松、愉悦、优雅地获取互联网上丰富的外文信息，不让语言成为障碍。</p><h3 id="YouTube双字幕（完全免费）"><a href="#YouTube双字幕（完全免费）" class="headerlink" title="YouTube双字幕（完全免费）"></a>YouTube双字幕（完全免费）</h3><p>如果你只是单纯想要看懂外文的YouTube视频，那么这个插件非常适合你，它还支持字幕下载，而且完全免费！</p><img src="https://img.laoda.de/i/2023/10/18/pbquu1-0.webp" alt="30a75b5bb25b9616e0f3bdbd4a84bb67.png" style="zoom:50%;" /><img src="https://img.laoda.de/i/2023/10/18/pbs4kg-0.webp" alt="7ce7719be903926ea7740ad5d7f2a1f0.png" style="zoom:50%;" /><p>地址：<a href="https://chrome.google.com/webstore/detail/youtube-dual-subtitles/hkbdddpiemdeibjoknnofflfgbgnebcm?hl=zh-CN">https://chrome.google.com/webstore/detail/youtube-dual-subtitles/hkbdddpiemdeibjoknnofflfgbgnebcm?hl=zh-CN</a></p><h3 id="Trancy（可以免费体验10天）"><a href="#Trancy（可以免费体验10天）" class="headerlink" title="Trancy（可以免费体验10天）"></a>Trancy（可以免费体验10天）</h3><p><img src="https://img.laoda.de/i/2023/10/18/pbn1wo-0.webp" alt="b1162b54e747a56ceac2ecae1b2702d2.png"></p><p>一个专为语言学习者设计的全能工具，除了支持YouTube&#x2F;Netflix双语字幕，Trancy还提供了网页AI划词翻译和全文翻译等功能，你可以巧妙地将内容转化为自己的语言学习资料。借助Trancy，你可以体验高效且有趣的沉浸式语言学习。</p><p>看外文的视频再也不怕啦，而且非常想要学习英语的小伙伴。</p><p>咕咕自己开了年度会员。</p><img src="https://img.laoda.de/i/2023/10/18/pbowd4-0.webp" alt="52cffa3d220fd85e2a3b328a82dd557d.png" style="zoom:50%;" /><p>如果你也想尝试一下的话，可以点击咕咕的邀请连接注册，获得免费的10天会员，体验各种功能：<a href="https://gao.ee/trancy">https://gao.ee/trancy</a></p><h3 id="TwitterMediaHarvest（完全免费）"><a href="#TwitterMediaHarvest（完全免费）" class="headerlink" title="TwitterMediaHarvest（完全免费）"></a>TwitterMediaHarvest（完全免费）</h3><p><img src="https://img.laoda.de/i/2023/10/18/pb970b-0.webp" alt="2458e26dde38971804df6c8884d0fcbd.png"></p><p>一键下载 X 的媒体文件的浏览器插件。</p><p>安装该插件之后，每条带有媒体文件的推文的右下方都会出现下载按钮，你就可以在  x 上一键下载原始图片、视频了。</p><img src="https://img.laoda.de/i/2023/10/18/pbj4j0-0.webp" alt="b3dc08267d9f2f1362794f98ac9ea359.png" style="zoom:33%;" /><p>此外，你还可以在插件设置页面设置自动显示敏感内容。</p><p>GitHub地址：<a href="https://github.com/EltonChou/TwitterMediaHarvest">https://github.com/EltonChou/TwitterMediaHarvest</a></p><h3 id="SimpleExtManager（完全免费）"><a href="#SimpleExtManager（完全免费）" class="headerlink" title="SimpleExtManager（完全免费）"></a>SimpleExtManager（完全免费）</h3><p>这简单的菜单可让你方便的管理浏览器的扩展程序。</p><img src="https://img.laoda.de/i/2023/10/18/pblp3l-0.webp" alt="8d7877dd85bdb2f314d59c7cd9d38324.png" style="zoom:50%;" /><p>功能包括：</p><ul><li>通过弹出菜单来启用&#x2F;禁用，访问选项和卸载扩展</li><li>定制弹出菜单容貌</li><li>制作扩展群组</li><li>通过弹出菜单和右键菜单启用&#x2F;禁用扩展群组</li><li>启用活动页面</li></ul><p>地址：<a href="https://chrome.google.com/webstore/detail/simpleextmanager/kniehgiejgnnpgojkdhhjbgbllnfkfdk">https://chrome.google.com/webstore/detail/simpleextmanager/kniehgiejgnnpgojkdhhjbgbllnfkfdk</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;从这周起，咕咕争取每月给大家更新一些好玩有用，可以提高生产力的网站或者小工具，帮助大家更好的学习、搬砖。&lt;/p&gt;
&lt;p&gt;这周带来5个咕咕常用的Chrome插件。&lt;/p&gt;
&lt;h3 id=&quot;视频地址&quot;&gt;&lt;a href=&quot;#视频地址&quot; class=&quot;headerlink&quot; tit</summary>
      
    
    
    
    <category term="有用的小知识" scheme="https://blog.laoda.de/categories/%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="生产力工具" scheme="https://blog.laoda.de/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7/"/>
    
    <category term="浏览器插件" scheme="https://blog.laoda.de/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/"/>
    
    <category term="Chrome插件" scheme="https://blog.laoda.de/tags/Chrome%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>无需同步，即开即用！10分钟搭建一个在线二步验证器——2FAuth ｜谷歌验证器（Google Authenticator）替代品</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-2fauth/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-2fauth/</id>
    <published>2023-11-07T11:47:29.000Z</published>
    <updated>2023-11-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>这期我们来聊一聊二步验证。</p><img src="https://img.laoda.de/i/2023/11/07/raogjp-0.webp" alt="dc6f5c9da5e0dd82a373a4cf83fe32e7.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/w6bxmz-0.webp" alt="image-20231107194553692" style="zoom:33%;" /><p>双重认证Two-factor authentication，缩写为2FA，又称为双重验证、双因子认证、双因素认证，也有叫两步验证2-Step Verification，是多重要素验证中的一个特例，使用两种不同的元素，基于时间随机生成一串验证码用于和服务器验证的技术，来确认用户的身份。（类似之前网易的将军令和银行的电子令牌）</p><img src="https://img.laoda.de/i/2023/11/07/rb6vt2-0.webp" alt="b0842a4834d3da675fd3814961555780.png" style="zoom: 50%;" /><img src="https://img.laoda.de/i/2023/11/07/rb95c8-0.webp" alt="aa61a959689eb2cc3380a9e2a9935730.png" style="zoom:50%;" /><p>强烈建议每个人都用二步验证！</p><p>二步验证可以大大降低网络钓鱼攻击的成功率，减少盗号风险，即使我们的密码因为各种原因泄露了，由于黑客没有第二个验证因素，他们仍然无法访问我们的账户。</p><p>尽管二步验证不能提供100%的安全保障，但与单一密码相比，它显著增强了账户的安全性。</p><p>市面上有非常多的免费的两步验证工具，每一个工具大体上都差不多，但是也有一些区别。有一些人在选择双重验证工具时，可能比较看重安全性，认为那些带同步的双重验证软件有泄露的风险；有一些比较看重多设备同步，因为一旦手机丢失或者损坏，两步验证工具无法恢复数据将带来灾难性的后果。</p><p>如果你不想搭建，可以使用市面上的成熟产品，比如Google Authenticator或者authy，安卓可以使用<a href="https://github.com/beemdevelopment/Aegis/releases">Aegis</a></p><p>下面介绍一下咕咕使用过的这几个软件的特点：</p><ul><li><p>Google Authenticator，谷歌出品，有Android 与 iOS客户端，支持云同步（但是不建议打开，有泄漏的风险）</p></li><li><p>Aegis，免费开源的二次验证（2FA）应用，可以导入导出，加密，自定义图标，夜间主题，选中高亮，没有云同步功能，且仅限安卓使用。（强烈推荐）</p></li><li><p>Authy，适用于 Android 和 iOS 移动设备以及Windows，Apple Watch，桌面程序等全平台，也支持登陆账号，比较不错；缺点是不支持导出。</p></li><li><p>Microsoft authenticator 不推荐使用，非常坑。</p></li></ul><p>咕咕目前使用的方式，主要用Google Authenticator（不开启同步功能），然后在家里的pixel手机上装了Aegis，备份一份。</p><p>今天我们来介绍自建2FA，把我们的2FA账户存储在我们自己的独立数据库中，可以轻松备份和恢复（再也不用担心手机丢失而导致所有2FA账户都无法访问的情况了……）</p><p><img src="https://img.laoda.de/i/2023/11/07/rbbcgz-0.webp" alt="4e6a86c320403a606c8da4be99416109.png"></p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p>主界面</p><img src="https://img.laoda.de/i/2023/11/07/rbl37n-0.webp" alt="884437d1c4556f385a411c4e8765a6bb.png" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbn2d2-0.webp" alt="7bb62a37e18c0e9e19cb34879fd17377.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbokwd-0.webp" alt="b4344c632ed46033d59a4ce4fc88b996.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbphe5-0.webp" alt="e6fb7d7ae2d8fb1a8253786f5670eb34.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbs9s9-0.webp" alt="46c42b2ad1beb330c3ea3ab89dd135b2.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbtgh4-0.webp" alt="7c8d6b9f5e03a5c56453d6164b7a1804.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbuoog-0.webp" alt="4cd2cecb9afe130c07956c8779edf89c.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rbw95n-0.webp" alt="d20354ca1fd603d34e055ee04d30d0ab.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rc692e-0.webp" alt="7225c5accbe5674587b061c978c04be8.png" style="zoom:33%;" /><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>2fa GitHub仓库：<a href="https://2fa.org/">https://2fa.org/</a><br>2fa 官方文档：<a href="https://docs.2fauth.app/">https://docs.2fauth.app/</a><br>官方demo：<a href="https://demo.2fauth.app/">https://demo.2fauth.app</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：咕咕这边用的是<a href="https://gao.ee/lca">莱卡云</a>的CN2 GIA的机器</li></ul><p>莱卡云双十一打折活动火热进行中，</p><img src="https://img.laoda.de/i/2023/11/07/ngk3u4-0.webp" alt="image-20231107141845937" style="zoom: 25%;" /><p>莱卡云双十一活动，2核4G的香港服务器<strong>每个月仅售11.11元，每人限购一台，续费同价</strong>！</p><p>另有新客专享云服务器套餐，<strong>续费同价</strong>。</p><p>详情查看：<a href="https://www.lcayun.com/actcloud.html">https://www.lcayun.com/actcloud.html</a></p><img src="https://img.laoda.de/i/2023/11/07/nl10tr-0.webp" alt="image-20231107141845937" style="zoom: 25%;" /><blockquote><p>当然你也可以用<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</p></blockquote><ul><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器建议：1C1G，能搭建docker即可</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/tCjBUefV_Go">https://youtu.be/tCjBUefV_Go</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1Xw411s7Lz/">https://www.bilibili.com/video/BV1Xw411s7Lz/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/2fa</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/2fa</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> data</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#修改目录所有者和权限</span></span><br><span class="line"><span class="built_in">chown</span> 1000:1000 data </span><br><span class="line"><span class="built_in">chmod</span> 700 data</span><br></pre></td></tr></table></figure><img src="https://img.laoda.de/i/2023/11/07/xe8169-0.webp" alt="8ea0f7576d313c95b425d34f4fcbf59c.png" style="zoom:33%;" /><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/2fa</span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>原版内容，环境变量非常多，还有smtp服务：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">2fauth:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">2fauth/2fauth</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">2fauth</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./2fauth:/2fauth</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8000</span><span class="string">:8000/tcp</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># 你可以更改应用程序的名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_NAME=2FAuth</span></span><br><span class="line">      <span class="comment"># 你可以将其保留为“local”。如果你将其更改为“production”，大多数控制台命令将要求额外确认。</span></span><br><span class="line">      <span class="comment"># 永远不要将其设置为“testing”。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_ENV=local</span></span><br><span class="line">      <span class="comment"># 如果你想在错误屏幕中看到调试信息，请将此设为true。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_DEBUG=false</span></span><br><span class="line">      <span class="comment"># 这应该是你的电子邮件地址</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SITE_OWNER=mail@example.com</span></span><br><span class="line">      <span class="comment"># 加密键用于你的数据库和会话。请确保这个非常安全。</span></span><br><span class="line">      <span class="comment"># 如果你生成了一个新的，所有现有的数据必须被视为丢失。</span></span><br><span class="line">      <span class="comment"># 将其更改为一个确切的32个字符的字符串，或使用命令`php artisan key:generate`来生成它</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_KEY=SomeRandomStringOf32CharsExactly</span></span><br><span class="line">      <span class="comment"># 这个变量必须与你安装的外部地址匹配，但请记住，</span></span><br><span class="line">      <span class="comment"># 它只在命令行中使用作为回退值。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_URL=http://localhost</span></span><br><span class="line">      <span class="comment"># 如果你想让你的应用程序像演示一样反应，可以将此设置为true。</span></span><br><span class="line">      <span class="comment"># 演示模式每小时重置应用程序内容，并设置一个通用的演示用户。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">IS_DEMO_APP=false</span></span><br><span class="line">      <span class="comment"># 日志通道定义了你的日志条目去哪里。</span></span><br><span class="line">      <span class="comment"># “daily”是默认的日志模式，为你提供在/storage/logs/下的5个日轮换日志文件。</span></span><br><span class="line">      <span class="comment"># 还存在多个其他选项。你可以使用“single”来获取一个很大的错误日志（不推荐）。</span></span><br><span class="line">      <span class="comment"># 还可以使用&#x27;syslog&#x27;、&#x27;errorlog&#x27;和&#x27;stdout&#x27;，它们会记录到系统本身。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOG_CHANNEL=daily</span></span><br><span class="line">      <span class="comment"># 日志级别。你可以从最不严重到最严重设置：</span></span><br><span class="line">      <span class="comment"># debug, info, notice, warning, error, critical, alert, emergency</span></span><br><span class="line">      <span class="comment"># 如果设置为debug，你的日志会很快变大。如果设置为emergency，可能</span></span><br><span class="line">      <span class="comment"># 永远不会记录任何东西。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOG_LEVEL=notice</span></span><br><span class="line">      <span class="comment"># 数据库配置（只能是sqlite）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_DATABASE=&quot;/srv/database/database.sqlite&quot;</span></span><br><span class="line">      <span class="comment"># 如果你正在寻找性能改进，你可以安装memcached。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CACHE_DRIVER=file</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SESSION_DRIVER=file</span></span><br><span class="line">      <span class="comment"># 邮件设置</span></span><br><span class="line">      <span class="comment"># 参考你的电子邮件提供商文档来配置你的邮件设置</span></span><br><span class="line">      <span class="comment"># 为每个可用的设置设置一个值以避免问题</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_DRIVER=log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_HOST=smtp.mailtrap.io</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_PORT=2525</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_FROM=changeme@example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_USERNAME=null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_PASSWORD=null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_ENCRYPTION=null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_FROM_NAME=null</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MAIL_FROM_ADDRESS=null</span></span><br><span class="line">      <span class="comment"># 认证设置</span></span><br><span class="line">      <span class="comment"># 默认的认证守护</span></span><br><span class="line">      <span class="comment"># 支持：</span></span><br><span class="line">      <span class="comment">#   &#x27;web-guard&#x27; : Laravel内置的auth系统（如果为null则为默认）</span></span><br><span class="line">      <span class="comment">#   &#x27;reverse-proxy-guard&#x27; : 当2FAuth部署在处理认证的反向代理后面时</span></span><br><span class="line">      <span class="comment"># 警告</span></span><br><span class="line">      <span class="comment"># 使用&#x27;reverse-proxy-guard&#x27;时，2FAuth只查找专用的头部信息并跳过所有其他内置的</span></span><br><span class="line">      <span class="comment"># 认证检查。这意味着你的代理完全负责认证过程，只要头部信息存在，2FAuth就</span></span><br><span class="line">      <span class="comment"># 会信任它。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">AUTHENTICATION_GUARD=web-guard</span></span><br></pre></td></tr></table></figure><p>这种应用，不用搞这么复杂，以下是咕咕修改的：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">2fauth:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">2fauth/2fauth</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">2fauth</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/2fauth</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8120</span><span class="string">:8000/tcp</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_NAME=2FAuth</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_KEY=SomeRandomStringOf32CharsExactly</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">APP_URL=https://2fa.gugu.ovh</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">IS_DEMO_APP=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOG_CHANNEL=daily</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LOG_LEVEL=notice</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_DATABASE=&quot;/srv/database/database.sqlite&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CACHE_DRIVER=file</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SESSION_DRIVER=file</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">AUTHENTICATION_GUARD=web-guard</span></span><br></pre></td></tr></table></figure><p>切换成英文输入法，修改好之后，按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8120</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>类似图中的，这边我们填 <code>8120</code>，示例填 <code>2fa</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2023/11/01/nlmaxe-0.webp" alt="56a42aff23098af08c1ae587e19739ae.png" style="zoom:33%;" /><p>查看端口是否被占用（以 <code>8120</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8120  <span class="comment">#查看 8120 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8381</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8120</code> 访问了。</p><p>但是这边我们必须先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>这边以2fa为例子，element也是一样操作即可。</p><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/11/07/rch2zx-0.webp" alt="bc6eb22c3841412ef0ffdedf2750fdc9.png" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/11/01/nlquzk-0.webp" alt="de87eaa4f87c945ebbec11bf9d413346.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/07/rcron3-0.webp" alt="78447578bedf11687527a5803ae01700.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/01/nls0t5-0.webp" alt="c47e6d7fd7d6a965be564124e6816746.png" style="zoom:33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8120</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 2fa 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>2fa</code> 所在的服务器 IP 就行。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8120/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者自己尝试一下。</p><h3 id="8-1-更新-2fa"><a href="#8-1-更新-2fa" class="headerlink" title="8.1 更新 2fa"></a>8.1 更新 2fa</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/root/data/docker_data/2fa</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span>    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">image</span> <span class="string">prune</span>  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-2fa"><a href="#8-2-卸载-2fa" class="headerlink" title="8.2 卸载 2fa"></a>8.2 卸载 2fa</h3><p>同样进入安装页面，先停止所有容器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/2fa</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/2fa  <span class="comment"># 完全删除</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题及注意点"><a href="#9-常见问题及注意点" class="headerlink" title="9. 常见问题及注意点"></a>9. 常见问题及注意点</h2><p><img src="https://img.laoda.de/i/2023/11/07/s97qzz-0.webp" alt="464e965827aa0695e05da3830c2c6934.png"></p><h3 id="9-1-关闭注册"><a href="#9-1-关闭注册" class="headerlink" title="9.1 关闭注册"></a>9.1 关闭注册</h3><img src="https://img.laoda.de/i/2023/11/07/rd2hxk-0.webp" alt="0a23c390177252ad4a3843d7bcfc9761.png" style="zoom:33%;" /><h3 id="9-2-数据库加密"><a href="#9-2-数据库加密" class="headerlink" title="9.2 数据库加密"></a>9.2 数据库加密</h3><p>存储在数据库中的敏感数据（2FA秘钥和otpauth URI）可以进行加密，以保护它们免受数据库被攻破的风险。</p><p>在2FAuth的设置 &gt; 选项部分中勾选“保护敏感数据”选项，启用加密功能。</p><p><strong>加密适用于所有用户的数据。</strong></p><blockquote><p>警告<br>强烈建议在启用加密时备份.env文件中定义的APP_KEY值（或整个文件）。<br>如果丢失此密钥，则无法生成一次性密码。<br>如果遗失了该密钥，则没有任何解决办法。</p></blockquote><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/Bubka/2FAuth/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/Bubka/2FAuth">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/Bubka/2FAuth">https://github.com/Bubka/2FAuth</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;这期我们来聊一聊二步验证。&lt;/p&gt;
&lt;img src=&quot;https://img.laoda.de/i/2023/11/07/</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="2FA" scheme="https://blog.laoda.de/tags/2FA/"/>
    
    <category term="Google Authenticator" scheme="https://blog.laoda.de/tags/Google-Authenticator/"/>
    
    <category term="Authy" scheme="https://blog.laoda.de/tags/Authy/"/>
    
    <category term="Microsoft Authenticator" scheme="https://blog.laoda.de/tags/Microsoft-Authenticator/"/>
    
    <category term="Aegis" scheme="https://blog.laoda.de/tags/Aegis/"/>
    
    <category term="二步验证" scheme="https://blog.laoda.de/tags/%E4%BA%8C%E6%AD%A5%E9%AA%8C%E8%AF%81/"/>
    
  </entry>
  
  <entry>
    <title>支持端到端加密！打造自己专属的去中心化即时聊天室！｜自由畅聊，我用Matrix！匿名、安全、功能丰富</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-matrix-element/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-matrix-element/</id>
    <published>2023-11-03T00:41:40.000Z</published>
    <updated>2023-11-04T00:54:52.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://img.laoda.de/i/2023/11/01/nisqe1-0.webp" alt="669ac0cb0942808427944742d69f473b.png"></p><p>详情：<a href="http://notes.valdikss.org.ru/jabber.ru-mitm/">http://notes.valdikss.org.ru/jabber.ru-mitm/</a></p><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>前阵子有小伙伴对于怎么搭建Matrix有疑问，还专门请咕咕喝咖啡请教 &#x3D; &#x3D;<br>其实Matrix咕咕之前有折腾过，这边就完整分享一下这个项目。</p><p>PS：这次还包括自己搭建Matrix的客户端——Element（因为国内element似乎被强了，如果你在海外可以直接用官方的Element app）</p><p><strong>Matrix和Element分别是什么？</strong></p><blockquote><p><strong>Matrix</strong>:</p><ul><li>Matrix 是一个开放的通信协议，用于实时通信，包括即时消息、音频和视频通话。</li><li>它是去中心化的，这意味着任何人都可以设置自己的 Matrix 服务器，并与其他 Matrix 服务器通信。</li><li>Matrix 的目标是为所有不同的通信服务提供一个统一的标准，使得不同的服务可以互相通信。</li></ul><p><strong>Element</strong>:</p><ul><li>Element 是基于 Matrix 协议的一个客户端应用。</li><li>它允许用户通过 Matrix 协议进行即时消息、音频和视频通话。</li><li>Element 有多个版本，包括 Web、桌面和移动应用。</li><li>它是 Matrix 生态系统中最流行的客户端之一。</li></ul></blockquote><p>简而言之，Matrix 是一个通信协议，而 Element 是基于这个协议的一个客户端应用。你可以将 Matrix 看作是一个电话网络（比如移动），而 Element 则是使用这个网络的手机（比如苹果）。</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p>Matrix 搭建好的样子：</p><p><img src="https://img.laoda.de/i/2023/11/01/niu17x-0.webp" alt="17f5a91ab4c843df57f05639e7a537cc.png"></p><p>Element搭建好的首页：</p><p><img src="https://img.laoda.de/i/2023/11/01/nivvmb-0.webp" alt="501a33c8a8763aebab5cd4ab4fcb92f3.png"></p><p>登陆Element网页版：</p><p><img src="https://img.laoda.de/i/2023/11/01/nixmkr-0.webp" alt="d2e3612240aff1c194c55b06b6b76f8b.png"></p><p>Element 后台界面：</p><p><img src="https://img.laoda.de/i/2023/11/01/niz3q3-0.webp" alt="62384d00ea0719ceb1e79015f9bef108.png"></p><p><img src="https://img.laoda.de/i/2023/11/01/nj92fv-0.webp" alt="c4ae8ab73e840b368d22bd562d5ff04d.png"></p><p><img src="https://img.laoda.de/i/2023/11/01/njador-0.webp" alt="7e8b395b251046ef56a6fa0ffdba6f8e.png"></p><p><img src="https://img.laoda.de/i/2023/11/01/njbdk9-0.webp" alt="b7eca30781a75b6f5a37f2eec2d5d081.png"></p><p>互相聊天：</p><p><img src="https://img.laoda.de/i/2023/11/01/njcxf8-0.webp" alt="6ee2dc44f53685ff769ffcc36afaf924.png"></p><p><img src="https://img.laoda.de/i/2023/11/01/njebc3-0.webp" alt="8204772a96f7a738fcbc3ad3d817cad3.png"></p><p><img src="https://img.laoda.de/i/2023/11/01/njg3ff-0.webp" alt="eebece77818640ae1708a61d51db7ee5.png"></p><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>Matrix 官方网站：<a href="https://matrix.org/">https://matrix.org/</a><br>Matrix GitHub官方仓库：<a href="https://github.com/matrix-org/synapse">https://github.com/matrix-org/synapse</a><br>Element 官方网站：<a href="https://element.io/">https://element.io/</a><br>Element 自建GitHub地址：<a href="https://github.com/vector-im/element-web">https://github.com/vector-im/element-web</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：咕咕演示搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器，硬盘也可以大一些）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）反向代理咕咕用的是<a href="https://gao.ee/lca">莱卡云</a>的CN2 GIA的机器</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器建议：1C2G起，硬盘可以大一些，有条件的可以把Matrix和Element分两个不同的域名反代，具体原因见：<a href="https://github.com/vector-im/element-web/issues/1977">#1977</a>。</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/MyxdBmgowfs">https://youtu.be/MyxdBmgowfs</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1qz4y1N7p2/">https://www.bilibili.com/video/BV1qz4y1N7p2/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/matrix</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/matrix</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo docker run -it --<span class="built_in">rm</span> \</span><br><span class="line">-v /root/data/docker_data/matrix/data:/data \</span><br><span class="line">-e SYNAPSE_SERVER_NAME=matrix.gugu.ovh \</span><br><span class="line">-e SYNAPSE_REPORT_STATS=<span class="built_in">yes</span> \</span><br><span class="line">matrixdotorg/synapse:latest generate</span><br></pre></td></tr></table></figure><p>注意：<code>matrix.gugu.ovh</code>改成自己的域名</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /root/data/docker_data/matrix/data</span><br><span class="line"></span><br><span class="line">vim homeserver.yaml</span><br></pre></td></tr></table></figure><p>改成下面的内容：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Configuration file for Synapse.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is a YAML file: see [1] for a quick introduction. Note in particular</span></span><br><span class="line"><span class="comment"># that *indentation is important*: all the elements of a list or dictionary</span></span><br><span class="line"><span class="comment"># should have the same indentation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For more information on how to configure Synapse, including a complete accounting of</span></span><br><span class="line"><span class="comment"># each option, go to docs/usage/configuration/config_documentation.md or</span></span><br><span class="line"><span class="comment"># https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html</span></span><br><span class="line"><span class="attr">server_name:</span> <span class="string">&quot;matrix.gugu.ovh&quot;</span></span><br><span class="line"><span class="attr">pid_file:</span> <span class="string">/data/homeserver.pid</span></span><br><span class="line"><span class="attr">listeners:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8008</span></span><br><span class="line">    <span class="attr">tls:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">x_forwarded:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">names:</span> [<span class="string">client</span>, <span class="string">federation</span>]</span><br><span class="line">        <span class="attr">compress:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">database:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sqlite3</span></span><br><span class="line">  <span class="attr">args:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">/data/homeserver.db</span></span><br><span class="line"><span class="attr">log_config:</span> <span class="string">&quot;/data/matrix.gugu.ovh.log.config&quot;</span></span><br><span class="line"><span class="attr">media_store_path:</span> <span class="string">/data/media_store</span></span><br><span class="line"><span class="attr">registration_shared_secret:</span> <span class="string">&quot;wwaftxJ&amp;3W3Xkx1y4gYoeoY0p6ywmkx96JZB7rCYg2+_bd~M,t&quot;</span></span><br><span class="line"><span class="attr">report_stats:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">macaroon_secret_key:</span> <span class="string">&quot;+i6*ZU+ZgxnIjX98@F3F#Oxw*Un*40=58ESt=+HW=SVA@N6ITy&quot;</span></span><br><span class="line"><span class="attr">form_secret:</span> <span class="string">&quot;xMGG5P~DD-7Brm19jaYR9v0d.wG:abNxN9ikdWcgNE7Z3F;NmB&quot;</span></span><br><span class="line"><span class="attr">signing_key_path:</span> <span class="string">&quot;/data/matrix.gugu.ovh.signing.key&quot;</span></span><br><span class="line"><span class="attr">trusted_key_servers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">server_name:</span> <span class="string">&quot;matrix.org&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">enable_registration:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">enable_registration_without_verification:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vim:ft=yaml</span></span><br></pre></td></tr></table></figure><p>切换成英文输入法，修改好之后，按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/matrix</span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>以下是咕咕修改的：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">synapse:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;matrixdotorg/synapse:latest&quot;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">&quot;matrix_synapse&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8008</span><span class="string">:8008</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./data:/data&quot;</span> <span class="comment"># it will look at the current directory where you save the file and look for the data folder inside</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">VIRTUAL_HOST:</span> <span class="string">&quot;matrix.gugu.ovh&quot;</span></span><br><span class="line">      <span class="attr">VIRTUAL_PORT:</span> <span class="number">8008</span></span><br><span class="line">      <span class="attr">LETSENCRYPT_HOST:</span> <span class="string">&quot;matrix.gugu.ovh&quot;</span></span><br><span class="line">      <span class="attr">SYNAPSE_SERVER_NAME:</span> <span class="string">&quot;matrix.gugu.ovh&quot;</span></span><br><span class="line">      <span class="attr">SYNAPSE_REPORT_STATS:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">  <span class="attr">element-web:</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8009:80&#x27;</span></span><br><span class="line">    <span class="comment">#volumes:</span></span><br><span class="line">    <span class="comment">#    - &#x27;/etc/element-web/config.json:/app/config.json&#x27;</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vectorim/element-web</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure><p>切换成英文输入法，修改好之后，按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>这边只说matrix的，element也是一样的做！</p><p>打开防火墙的端口 <code>8008</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>这边我们填 <code>8008</code>，示例填 <code>matrix</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2023/11/01/nlmaxe-0.webp" alt="56a42aff23098af08c1ae587e19739ae.png" style="zoom:33%;" /><p>查看端口是否被占用（以 <code>8008</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8008  <span class="comment">#查看 8008 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8381</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8008</code> 访问了。</p><p>但是这边我们需要先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>这边以matrix为例子，element也是一样操作即可。</p><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/11/01/nloado-0.webp" alt="7a5274d47aaf7c03c505b33a9ddc9248.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/01/nlpij6-0.webp" alt="8752890c07e855331c65db035723238f.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/01/nlquzk-0.webp" alt="de87eaa4f87c945ebbec11bf9d413346.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/11/01/nls0t5-0.webp" alt="c47e6d7fd7d6a965be564124e6816746.png" style="zoom:33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8008</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 matrix 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>matrix</code> 所在的服务器 IP 就行。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8008/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者自己尝试一下。</p><h3 id="8-1-更新-matrix"><a href="#8-1-更新-matrix" class="headerlink" title="8.1 更新 matrix"></a>8.1 更新 matrix</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/root/data/docker_data/matrix</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span>    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">image</span> <span class="string">prune</span>  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-matrix"><a href="#8-2-卸载-matrix" class="headerlink" title="8.2 卸载 matrix"></a>8.2 卸载 matrix</h3><p>同样进入安装页面，先停止所有容器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/matrix</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/matrix  <span class="comment"># 完全删除</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题及注意点"><a href="#9-常见问题及注意点" class="headerlink" title="9. 常见问题及注意点"></a>9. 常见问题及注意点</h2><h3 id="9-1-Matrix和Element-分两个不同的二级域名"><a href="#9-1-Matrix和Element-分两个不同的二级域名" class="headerlink" title="9.1 Matrix和Element 分两个不同的二级域名"></a>9.1 Matrix和Element 分两个不同的二级域名</h3><p>把Matrix和Element分两个不同的域名反代，具体原因见：<a href="https://github.com/vector-im/element-web/issues/1977">#1977</a>。</p><h3 id="9-2-element-记得千万做好https"><a href="#9-2-element-记得千万做好https" class="headerlink" title="9.2 element 记得千万做好https"></a>9.2 element 记得千万做好https</h3><p>否则会出现：</p><p><img src="https://img.laoda.de/i/2023/11/01/njxw3c-0.webp" alt="1928f0319151c905bce864b8e8107c82.png"></p><h3 id="9-3-关闭注册"><a href="#9-3-关闭注册" class="headerlink" title="9.3 关闭注册"></a>9.3 关闭注册</h3><p>搭建完成之后，注册了用户，之后建议关闭服务的注册功能</p><p>把这边<code>homeserver.yaml</code>里的这两项改为<code>false</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">enable_registration:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">enable_registration_without_verification:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="9-4-更换数据库、添加smtp"><a href="#9-4-更换数据库、添加smtp" class="headerlink" title="9.4 更换数据库、添加smtp"></a>9.4 更换数据库、添加smtp</h3><p>这些都可以做，详情可以参考官方仓库的文档进行操作。</p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/matrix-org/synapse/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/matrix-org/synapse">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://fossengineer.com/selfhosting-matrix-synapse-docker/">https://fossengineer.com/selfhosting-matrix-synapse-docker/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://img.laoda.de/i/2023/11/01/nisqe1-0.webp&quot; alt=&quot;669ac0cb0942808427944742d69f473b.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;详情：&lt;a href=&quot;http://notes.va</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="DockerCompose" scheme="https://blog.laoda.de/tags/DockerCompose/"/>
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="去中心化" scheme="https://blog.laoda.de/tags/%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96/"/>
    
    <category term="匿名" scheme="https://blog.laoda.de/tags/%E5%8C%BF%E5%90%8D/"/>
    
    <category term="端到端加密" scheme="https://blog.laoda.de/tags/%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8A%A0%E5%AF%86/"/>
    
    <category term="安全" scheme="https://blog.laoda.de/tags/%E5%AE%89%E5%85%A8/"/>
    
    <category term="功能丰富" scheme="https://blog.laoda.de/tags/%E5%8A%9F%E8%83%BD%E4%B8%B0%E5%AF%8C/"/>
    
    <category term="即时通信" scheme="https://blog.laoda.de/tags/%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】10分钟搭建一个高颜值的在线工具箱，用户体验很棒！</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-it-tools/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-it-tools/</id>
    <published>2023-10-24T06:16:12.000Z</published>
    <updated>2023-10-24T07:24:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>咕咕前段时间自己搭了一个在线工具箱，搭建会麻烦一点：</p><p><img src="https://img.laoda.de/i/2023/10/18/qrkc9x-0.webp" alt="934cd4843959e553ae52649672ce784d.png"></p><p>今天直接给大家分享一个可以一条docker命令直接搭的在线工具箱。</p><p>他俩的功能也类似，感兴趣的可以搭一个玩玩～</p><p><img src="https://img.laoda.de/i/2023/10/18/qrm5pl-0.webp" alt="2fa5e01d8b4d36f43a6f0291b9b942b6.png"></p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p>uuid批量生成：</p><p><img src="https://img.laoda.de/i/2023/10/18/qrnfrq-0.webp" alt="682fd6155bacaa1557b95aa2cb76035e.png"></p><p>base64 编解码：</p><p><img src="https://img.laoda.de/i/2023/10/18/qrxkxb-0.webp" alt="571bd4331fbed7395503408f204c3fd1.png"></p><p>获取emoji的unicode：</p><p><img src="https://img.laoda.de/i/2023/10/18/qryiwu-0.webp" alt="fc5ebc22bf6878354368c47ecaf78c67.png"></p><p>二维码生成器：</p><p><img src="https://img.laoda.de/i/2023/10/18/qs0mm2-0.webp" alt="51f5365f2a96b6a427033f0fc563d89f.png"></p><p>docker cli转 docker compose</p><p><img src="https://img.laoda.de/i/2023/10/18/qs1kg6-0.webp" alt="8d7ad5a92daafdda8d523d17bd2dae87.png"></p><p>各种实用的功能，非常适合开发者使用。</p><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>GitHub官方仓库：<a href="https://github.com/CorentinTh/it-tools">https://github.com/CorentinTh/it-tools</a><br>官方Demo：<a href="https://it-tools.tech/">https://it-tools.tech/</a><br>咕咕的Demo：<a href="https://tools.gugu.ovh/">https://tools.gugu.ovh/</a></p><p>这边直接丢出核心的<code>docker-compose.yaml</code>文件，熟悉 docker 环境的小伙伴可以直接拷贝搭建。</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">it-tools:</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">it-tools</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;8380:80&#x27;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&#x27;corentinth/it-tools:latest&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：咕咕演示搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器，硬盘也可以大一些）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）反向代理咕咕用的是<a href="https://gao.ee/lca">莱卡云</a>的CN2 GIA的机器</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：1C1G，可以运行docker即可</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/bVAofvh_qyc">https://youtu.be/bVAofvh_qyc</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1PM411X7kh/">https://www.bilibili.com/video/BV1PM411X7kh/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/it-tools</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/it-tools</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>以下是咕咕修改的：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">it-tools:</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">it-tools</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;8380:80&#x27;</span>  <span class="comment">#8380可以修改成服务器上未使用过的其他端口</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&#x27;corentinth/it-tools:latest&#x27;</span></span><br></pre></td></tr></table></figure><p>大家修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8380</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>这边我们填 <code>8380</code>，示例填 <code>it-tools</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2023/10/18/qs5fb8-0.webp" alt="8fc76c9819bd3bb7073d2f3723371947.png" style="zoom: 33%;" /><p>查看端口是否被占用（以 <code>8380</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8380  <span class="comment">#查看 8380 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8381</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8380</code> 访问了。</p><p>但是这边我们需要先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/10/18/qs8uyo-0.webp" alt="a5f8fdeed90c24b933fdbea19d7cf68d.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/10/18/qsieiv-0.webp" alt="d2eb8512962872f35cc9164ce5591652.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/10/18/qsjm5u-0.webp" alt="66d162a93c1a0c7733794267eff6d00c.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/10/18/qsl55h-0.webp" alt="876b0c64d68f6b8779d2b67c6528e1ee.png" style="zoom:33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8380</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 it-tools 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>it-tools</code> 所在的服务器 IP 就行。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8380/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者自己尝试一下。</p><h3 id="8-1-更新-it-tools"><a href="#8-1-更新-it-tools" class="headerlink" title="8.1 更新 it-tools"></a>8.1 更新 it-tools</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">/root/data/docker_data/it-tools</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span>    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line"><span class="string">docker</span> <span class="string">image</span> <span class="string">prune</span>  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-it-tools"><a href="#8-2-卸载-it-tools" class="headerlink" title="8.2 卸载 it-tools"></a>8.2 卸载 it-tools</h3><p>同样进入安装页面，先停止所有容器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/it-tools</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/it-tools  <span class="comment"># 完全删除</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><h3 id="9-1-暂时还不支持中文"><a href="#9-1-暂时还不支持中文" class="headerlink" title="9.1 暂时还不支持中文"></a>9.1 暂时还不支持中文</h3><p>目前是英文版本的，暂时没有切换中文的选项，不知道后续作者会不会考虑增加。</p><p>不过这些英文也不难，遇到稍微生疏一点的完全可以用翻译软件翻译一下。</p><p>希望大家都能学好英文，去看看更大的世界。</p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/CorentinTh/it-tools/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/CorentinTh/it-tools">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/CorentinTh/it-tools">https://github.com/CorentinTh/it-tools</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;咕咕前段时间自己搭了一个在线工具箱，搭建会麻烦一点：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img.laoda.</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="在线工具箱" scheme="https://blog.laoda.de/tags/%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7%E7%AE%B1/"/>
    
    <category term="base64编解码" scheme="https://blog.laoda.de/tags/base64%E7%BC%96%E8%A7%A3%E7%A0%81/"/>
    
    <category term="二维码生成" scheme="https://blog.laoda.de/tags/%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%94%9F%E6%88%90/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】10分钟搭建一个内置图片转换功能的图床——Picsur</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-picsur/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-picsur/</id>
    <published>2023-10-17T02:15:59.000Z</published>
    <updated>2023-10-20T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>咕咕有一个<a href="https://img.gugu.ovh/">公益图床</a>，给一些小伙伴们临时存放一些图片使用，当时我们是用的<a href="https://blog.laoda.de/archives/docker-compose-install-easyimage/index.html">简单图床</a>来搭建的。</p><p>前阵子oneinstack和lnmp的挂马事件，震惊了很多小伙伴。</p><p>今天，我们就再来介绍一个纯老外做的开源图床<a href="https://github.com/caramelfur/picsur">Picsur</a>——一个易于使用、可自托管的图片分享服务，类似于Imgur，并内置转换功能。</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图。</p><p>界面同样非常简洁：</p><p><img src="https://img.laoda.de/i/2023/10/08/ppb7wn-0.webp" alt="246769fe0e4fd6e59e4fb360a3d24d88.png"></p><p><img src="https://img.laoda.de/i/2023/10/08/ppdkb2-0.webp" alt="f80bfca4bd86c1c7da82b6e80df74bd6.png"></p><p>可以看到你上传的所有图片：</p><p><img src="https://img.laoda.de/i/2023/10/08/ppepyv-0.webp" alt="3db0056943f83c2eeaca5026afe0b2f2.png"></p><p>可以设置图片的有效期：</p><p><img src="https://img.laoda.de/i/2023/10/08/ppgln1-0.webp" alt="54bb5e2947e99ea4542f4ea093ca9f74.png"></p><p>可以自由设置图片的格式：</p><p><img src="https://img.laoda.de/i/2023/10/08/ppixo7-0.webp" alt="ce1a095a0d3756197f5dbf3eaa6217ce.png"></p><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li><p>支持docker一键部署</p></li><li><p>匿名上传</p></li><li><p>支持多账户</p></li><li><p>适当的CORS限制</p></li><li><p>Exif信息剥离</p></li><li><p>支持保留原始图像的能力</p></li><li><p>支持多种格式：</p><ul><li>QOI</li><li>JPG</li><li>PNG</li><li>WEBP（支持动画）</li><li>TIFF</li><li>BMP</li><li>GIF（支持动画）</li></ul></li><li><p>支持转换图像</p></li><li><p>支持编辑图像</p><ul><li>调整大小</li><li>旋转</li><li>翻转</li><li>去除透明度</li><li>负片效果</li><li>灰度化处理</li></ul></li><li><p>可删除图片</p></li><li><p>正确的数据库迁移</p></li><li><p>支持在列表中显示自己的图片</p></li><li><p>支持聊天窗口上正确显示预览图</p></li><li><p>支持设置图片有效期</p></li><li><p>支持ShareX API</p></li><li><p>支持ARM64和AMD64 Docker镜像</p></li><li><p>白色模式（WIP）</p></li><li><p>公共画廊（WIP）</p></li><li><p>相册（WIP）</p></li></ul><p>EXIF是什么？</p><blockquote><p>EXIF数据，全称”Exchangeable Image File Format”，是一种包含各种关于照片的信息的数据格式。它可以包含很多有关照片的信息，比如相机制造商、相机型号、照片拍摄日期、ISO设置、快门速度、焦距，是否使用了闪光灯等等。一些相机还会添加地理位置的gps信息。</p><p>正因为EXIF数据可能包含这种敏感信息，例如地理位置，所以在分享照片的时候需要小心。如果你不希望建议自己的这些信息被公开，你应该在发布照片之前去除这些EXIF数据。</p></blockquote><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>GitHub官方仓库：<a href="https://github.com/caramelfur/picsur">https://github.com/caramelfur/picsur</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：咕咕演示搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器，硬盘也可以大一些）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）反向代理咕咕用的是<a href="https://gao.ee/lca">莱卡云</a>的CN2 GIA的机器</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：硬盘越大越好</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/VrsaCTWrjYE">https://youtu.be/VrsaCTWrjYE</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV13h4y1i7tq/">https://www.bilibili.com/video/BV13h4y1i7tq/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/picsur</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/picsur</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>以下是咕咕修改的，可以看看有啥不一样（具体见视频）</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">picsur:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/caramelfur/picsur:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">picsur</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8003:8080&#x27;</span> <span class="comment">#8003可以改成服务器上没有用过的端口</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PICSUR_HOST:</span> <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">      <span class="attr">PICSUR_PORT:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">PICSUR_DB_HOST:</span> <span class="string">picsur_postgres</span></span><br><span class="line">      <span class="attr">PICSUR_DB_PORT:</span> <span class="number">5432</span></span><br><span class="line">      <span class="attr">PICSUR_DB_USERNAME:</span> <span class="string">picsur</span></span><br><span class="line">      <span class="attr">PICSUR_DB_PASSWORD:</span> <span class="string">nice-long-strong-passw0rd-here</span>  <span class="comment"># 确保和picsur_postgres:部分的 POSTGRES_PASSWORD 匹配</span></span><br><span class="line">      <span class="attr">PICSUR_DB_DATABASE:</span> <span class="string">picsur</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">## 默认管理员账户是 admin, 这个没法改，密码就是下面这个你设置的</span></span><br><span class="line">      <span class="attr">PICSUR_ADMIN_PASSWORD:</span> <span class="string">different-nice-long-str0n6-passw0rd-here</span>       </span><br><span class="line"></span><br><span class="line">      <span class="comment">## 可选的，如果没有设置会默认生产随机字符</span></span><br><span class="line">      <span class="comment"># PICSUR_JWT_SECRET: CHANGE_ME</span></span><br><span class="line">      <span class="comment"># PICSUR_JWT_EXPIRY: 7d</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">## 最大可以上传的字节数</span></span><br><span class="line">      <span class="attr">PICSUR_MAX_FILE_SIZE:</span> <span class="number">128000000</span>  <span class="comment"># 128 MB</span></span><br><span class="line">      <span class="comment">## No need to touch this, unless you use a custom frontend</span></span><br><span class="line">      <span class="comment"># PICSUR_STATIC_FRONTEND_ROOT: &quot;/picsur/frontend/dist&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">## Warning: Verbose mode might log sensitive data</span></span><br><span class="line">      <span class="comment"># PICSUR_VERBOSE: &quot;true&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">picsur_postgres:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:14-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">picsur_postgres</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_DB:</span> <span class="string">picsur</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">nice-long-strong-passw0rd-here</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">picsur</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./picsur-data:/var/lib/postgresql/data</span>  <span class="comment"># 默认数据存放在当前文件夹下的picsur-data目录中，可以自行修改</span></span><br></pre></td></tr></table></figure><p>大家修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8003</code>和</p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>这边我们端口填 <code>8003</code>，备注填 <code>picsur</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2023/10/08/pr2dc6-0.webp" alt="image-20231008155710365" style="zoom:33%;" /><p>查看端口是否被占用（以 <code>8003</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8003  <span class="comment">#查看 8003 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8003</code> 访问了。</p><p>但是这边我们需要先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/10/08/pq4h57-0.webp" alt="5c9e551ea244c475284ef8eb1ec7dc65.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/10/08/pqes31-0.webp" alt="cfdb0f8e093e5c588728152b6fdf5fba.png" style="zoom:33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8003</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 picsur 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>picsur</code> 所在的服务器 IP 就行。</p><p>比如这边我用的<a href="https://loll.cc/tx">腾讯云</a>的服务器搭建服务，NPM却是在<a href="https://gao.ee/lac">莱卡云</a>的服务器上的，所以这边我就需要填写腾讯云服务器的IP了</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8003/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><h3 id="8-1-使用picsur"><a href="#8-1-使用picsur" class="headerlink" title="8.1 使用picsur"></a>8.1 使用picsur</h3><p>建议参考视频。</p><h3 id="8-2-更新-picsur"><a href="#8-2-更新-picsur" class="headerlink" title="8.2 更新 picsur"></a>8.2 更新 picsur</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/picsur</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -r /root/data/docker_data/picsur /root/data/docker_data/picsur.archive  <span class="comment"># 万事先备份，以防万一</span></span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line">docker image prune  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-3-卸载-picsur"><a href="#8-3-卸载-picsur" class="headerlink" title="8.3 卸载 picsur"></a>8.3 卸载 picsur</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/picsur</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/picsur  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><p>目前项目还在初期，很多功能还没完善（比如图片墙、多语言等功能），也可能会有一些bug，大家可以多多向作者反馈，毕竟用的人多了，作者会更有动力去维护，也会有更多的人加入到项目的开发当中去，让项目也变得更好用。</p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/caramelfur/picsur/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/caramelfur/picsur">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/caramelfur/picsur">https://github.com/caramelfur/picsur</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;咕咕有一个&lt;a href=&quot;https://img.gugu.ovh/&quot;&gt;公益图床&lt;/a&gt;，给一些小伙伴们临时存放一些图片使</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="图床" scheme="https://blog.laoda.de/tags/%E5%9B%BE%E5%BA%8A/"/>
    
    <category term="easyimage" scheme="https://blog.laoda.de/tags/easyimage/"/>
    
  </entry>
  
  <entry>
    <title>搬瓦工多款限量版补货，包括年付49.9美元的远古级CN2 GIA限量版！</title>
    <link href="https://blog.laoda.de/archives/bwg-promotion-10-16/"/>
    <id>https://blog.laoda.de/archives/bwg-promotion-10-16/</id>
    <published>2023-10-16T02:22:38.000Z</published>
    <updated>2023-10-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p>网址：<a href="https://bwh81.net/">https://bwh81.net</a></p><p>日常6.81% 优惠码：BWHNCXNVXV</p><p>瓦工详情介绍：<a href="https://blog.laoda.de/archives/vps-bandwagonhost/">https://blog.laoda.de/archives/vps-bandwagonhost/</a></p><h3 id="搬瓦工年付-49-99美元-CN2-GIA套餐补货"><a href="#搬瓦工年付-49-99美元-CN2-GIA套餐补货" class="headerlink" title="搬瓦工年付$49.99美元 CN2 GIA套餐补货"></a>搬瓦工年付$49.99美元 CN2 GIA套餐补货</h3><p>SPECIAL 10G KVM PROMO V5 - LOS ANGELES - CN2 GIA LIMITED EDITION</p><p>三网CN2 GIA（移动去程直连）线路。可选 DC6 CN2 GIA-E、DC9 CN2 GIA、日本软银、荷兰联通 9929 等机房。不能切换香港cmi（同价位GIA的除了v_ps &#x2F;咸鱼家的特价机(现在也买不到)，基本没有什么更好的选择了，这个机型在二手市场溢价不低。如果有需要可以 无脑冲！）</p><p>测试IP：65.49.131.102</p><ul><li>内存：512M</li><li>CPU：1核</li><li>硬盘：10G SSD</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$49.99&#x2F;年（可使用：BWH3HYATVBJW 优惠6.81%）</li></ul><p>购买链接：<a href="https://gao.ee/bwg49">https://gao.ee/bwg49</a></p><p>具体介绍：<a href="https://blog.laoda.de/archives/bwg-promotion-2023/">下架多年，重磅回归！搬瓦工传家宝 49 美元 CN2 GIA 套餐回来了！这次还有限量版免费更换 IP 套餐！</a></p><h3 id="DC9-CN2-GIA-E-限量版-VPS-目前已经断货"><a href="#DC9-CN2-GIA-E-限量版-VPS-目前已经断货" class="headerlink" title="DC9 CN2 GIA-E 限量版 VPS (目前已经断货)"></a>DC9 CN2 GIA-E 限量版 VPS (目前已经断货)</h3><p>可使用 DC6 CN2 GIA-E、日本软银等机房。</p><ul><li>内存：1G</li><li>CPU：1核</li><li>硬盘：20G SSD</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$89.99&#x2F;年（可使用：BWHNCXNVXV 优惠6.81%，折后价83.86美元。）</li></ul><p>购买链接：<a href="https://gao.ee/bwg89">https://gao.ee/bwg89</a></p><h3 id="搬瓦工新款-CN2-GIA-E-40G-限量版套餐补货"><a href="#搬瓦工新款-CN2-GIA-E-40G-限量版套餐补货" class="headerlink" title="搬瓦工新款 CN2 GIA-E 40G 限量版套餐补货"></a>搬瓦工新款 CN2 GIA-E 40G 限量版套餐补货</h3><p>可使用 DC6 CN2 GIA-E、DC9 CN2 GIA、日本软银、荷兰 EUNL_9 等 14 个机房。</p><ul><li>CPU：2核</li><li>内存：2GB</li><li>硬盘：40GB SSD</li><li>流量：1000GB 月流量</li><li>带宽：2.5Gbps</li><li>价格：$99.99&#x2F;年</li><li>优惠码：BWHNCXNVXV</li></ul><p>购买链接:<a href="https://gao.ee/bwg99">https://gao.ee/bwg99</a></p><h3 id="迪拜-20G限量版-目前已经断货"><a href="#迪拜-20G限量版-目前已经断货" class="headerlink" title="迪拜 20G限量版 (目前已经断货)"></a>迪拜 20G限量版 (目前已经断货)</h3><p>搬瓦工迪拜 20G限量版，可选迪拜、DC6&#x2F;DC9 CN2 GIA、日本软银、联通9929、普通机房等。</p><ul><li>CPU：1核</li><li>内存：1G</li><li>硬盘：20GB</li><li>流量：500GB流量，</li><li>价格：月付$9.9&#x2F;年付 $99.99</li><li>优惠码：BWHNCXNVXV</li></ul><p>购买链接:<a href="https://gao.ee/bwgdb">https://gao.ee/bwgdb</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;官网&quot;&gt;&lt;a href=&quot;#官网&quot; class=&quot;headerlink&quot; title=&quot;官网&quot;&gt;&lt;/a&gt;官网&lt;/h2&gt;&lt;p&gt;网址：&lt;a href=&quot;https://bwh81.net/&quot;&gt;https://bwh81.net&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;日常6.81% 优</summary>
      
    
    
    
    <category term="VPS推荐" scheme="https://blog.laoda.de/categories/VPS%E6%8E%A8%E8%8D%90/"/>
    
    
    <category term="美国VPS" scheme="https://blog.laoda.de/tags/%E7%BE%8E%E5%9B%BDVPS/"/>
    
    <category term="搬瓦工" scheme="https://blog.laoda.de/tags/%E6%90%AC%E7%93%A6%E5%B7%A5/"/>
    
  </entry>
  
  <entry>
    <title>分享一下自己在VPS/NAS/本地电脑上是怎么备份数据的</title>
    <link href="https://blog.laoda.de/archives/321-backup/"/>
    <id>https://blog.laoda.de/archives/321-backup/</id>
    <published>2023-09-22T09:41:03.000Z</published>
    <updated>2023-09-22T09:53:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天在整理文件，正好稍微梳理一下自己在不同设备上的备份方法，简单和大家分享下。（有不对的地方或者更好的建议欢迎评论区指出～）</p><p>先简单介绍一个ChatGPT给出的321备份策略（有很多种说法，这个是其中一种）：</p><img src="https://img.laoda.de/i/2023/09/22/spa8o4-0.webp" alt="8f3274298133f20b777c479310e1df5b.png" style="zoom:50%;" /><blockquote><p>321备份原则是一种数据备份策略，旨在防止数据丢失。具体来说，它建议按照以下方式备份数据：</p><ul><li>3份备份：也就是最少拥有你数据的三个副本。比如说，一个在你的电脑硬盘上（原始数据），剩下的两个在其他不同的存储媒介上。</li><li>2种不同的存储类型：这意味着你不能把所有的备份都放在同一种存储设备上，例如仅使用硬盘做备份。第二份备份应储存在不同的设备或系统上，比如外部硬盘，网络附加存储（NAS），DVD，云存储等。</li><li>1份离线（或离站）备份：这意味着你需要有一份备份是存储在离开你的日常工作区域的区域中的，最好是在完全不同的地理位置。这是为了防止像火灾、洪水这种可能摧毁你现场数据和备份的灾难。</li></ul></blockquote><p>按照321备份原则做好数据备份，你就具备了充分保护数据，防止灾难性数据丢失的准备。</p><h2 id="服务器上的数据备份"><a href="#服务器上的数据备份" class="headerlink" title="服务器上的数据备份"></a>服务器上的数据备份</h2><img src="https://img.laoda.de/i/2023/09/22/spbwf8-0.webp" alt="5fed802585c251d8d30d5536f32b9a8e.png" style="zoom: 67%;" /><p>这个适合那些手头上VPS不止一台的小伙伴使用。（最好有一台机器硬盘大一点）</p><p>其实之前也和大家已经介绍过了——<a href="https://blog.laoda.de/archives/chatgpt-script-about-vps-backup/index.html">用ChatGPT帮你写一个VPS定时自动备份脚本</a>，不少小伙伴总喜欢尝试一些奇奇怪怪的VPS商家，这些商家说不定哪天就跑路了，但是架不住人家便宜啊，就是忍不住剁手要买，搭配这个脚本，可以让你少丢失一些数据。（开玩笑，任何VPS商家都有丢失数据的可能性，如果你觉得你的数据重要，就一定记得备份）</p><p>这边以Debian 11 系统为例子，如果看咕咕视频比较多的，应该都知道咕咕推荐大家玩docker把各个项目都放<code>/root/data/docker_data</code>目录下（其实更好的是把配置文件和数据分开放），这个脚本就是备份我们的docker项目的，实现的功能如下：</p><p>把A服务器上的<code>/root/data/docker_data</code>目录下的文件每天早上4点钟定时备份到B服务器的<code>/root/data/backup_data</code>文件夹下，</p><ul><li>备份文件在B服务器上最多保存3份，并以时间戳命名。</li><li>B服务器的IP地址是：<code>150.117.211.107</code>, ssh端口是<code>222</code>。（按需修改）</li><li>备份的日志保存在A服务器的<code>/root/logs</code>文件夹下，并且日志包含时间信息</li><li>备份和传输的过程可以显示进度条，并且有提示信息，并且进度条最多显示100%（安装好pv，临时备份文件放在<code>/tmp</code>目录下，上传完成之后可以删掉）</li><li>保留文件原有的属性（所有者等信息）</li><li>恢复备份的时候，只有<code>/root/data/docker_data</code>中的内容而不包括<code>/root/data/...</code>完整路径</li></ul><p>咕咕这边用的备份服务器是<a href="https://blog.laoda.de/archives/vps-hosthatch/index.html">Hosthatch</a>家的大盘鸡，当时65刀&#x2F;3年的价格，有1T的硬盘，还有无限流量的BUG（标的20T，实际不统计流量），还不错的。（他家有过丢数据的情况，所以这个机器咕咕就用来跑下载和备份用了）</p><img src="https://img.laoda.de/i/2023/09/22/spmiwk-0.webp" alt="df9c744aa798d9df038870d916816c2c.png" style="zoom:33%;" /><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">cd ~</span><br><span class="line">apt update -y &amp;&amp; apt upgrade -y </span><br><span class="line">apt install pv rsync -y    # 注意A、B服务器上都装上rsync</span><br><span class="line">mkdir script</span><br><span class="line">vim backup.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Variables</span></span><br><span class="line">SOURCE_DIR=<span class="string">&quot;/root/data/docker_data/&quot;</span></span><br><span class="line">DEST_DIR=<span class="string">&quot;/root/data/backup_data/&quot;</span></span><br><span class="line">REMOTE_IP=<span class="string">&quot;150.117.211.107&quot;</span></span><br><span class="line">SSH_PORT=222</span><br><span class="line">TMP_BACKUP=<span class="string">&quot;/tmp/data_backup_<span class="subst">$(date +&#x27;%Y%m%d%H%M%S&#x27;)</span>.tar.gz&quot;</span></span><br><span class="line">LOG_FILE=<span class="string">&quot;/root/logs/backup_<span class="subst">$(date +&#x27;%Y%m%d&#x27;)</span>.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start backup</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span> - Starting backup...&quot;</span> | <span class="built_in">tee</span> -a <span class="variable">$LOG_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the backup with tar, display progress with pv</span></span><br><span class="line">tar czfP - <span class="variable">$SOURCE_DIR</span> --absolute-names --transform <span class="string">&#x27;s|^/root/data/||&#x27;</span> | pv -p -t -e -r -s $(<span class="built_in">du</span> -sb <span class="variable">$SOURCE_DIR</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>) &gt; <span class="variable">$TMP_BACKUP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rsync the backup to the remote server, displaying progress</span></span><br><span class="line">rsync -avhP --remove-source-files -e <span class="string">&quot;ssh -p <span class="variable">$SSH_PORT</span>&quot;</span> <span class="variable">$TMP_BACKUP</span> root@<span class="variable">$REMOTE_IP</span>:<span class="variable">$DEST_DIR</span> | <span class="built_in">tee</span> -a <span class="variable">$LOG_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove backups in B server exceeding 3</span></span><br><span class="line">ssh -p <span class="variable">$SSH_PORT</span> root@<span class="variable">$REMOTE_IP</span> <span class="string">&quot;cd <span class="variable">$DEST_DIR</span> &amp;&amp; (ls -t | head -n 3; ls) | sort | uniq -u | xargs rm -f&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cleanup temp file in case rsync failed to remove it</span></span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$TMP_BACKUP</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span> - Backup completed.&quot;</span> | <span class="built_in">tee</span> -a <span class="variable">$LOG_FILE</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x backup.sh</span><br></pre></td></tr></table></figure><p>A服务器创建好文件夹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> logs</span><br></pre></td></tr></table></figure><p>B服务器创建好文件夹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /root/data/backup_data/</span><br></pre></td></tr></table></figure><p>A、B服务器之间创建免密码登录</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在A服务器上</span></span><br><span class="line"></span><br><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line">ssh-keygen    <span class="comment"># 一路回车即可</span></span><br><span class="line"></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub -p 222 root@150.117.211.107</span><br></pre></td></tr></table></figure><p>每天早上4点执行备份：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>在crontab界面中输入：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0 4 * * * /root/script/backup.sh</span><br></pre></td></tr></table></figure><blockquote><p>脚本操作包含敏感操作，如远程登录、文件传输等，在执行前，应确保所有操作、路径和细节均无问题。<br>可以根据需要修改脚本，比如修改备份文件名、备份路径、备份文件最多保留数目等参数。</p></blockquote><p>咕咕的站点都在<a href="https://blog.laoda.de/archives/vps-bandwagonhost/index.html">搬瓦工</a>和<a href="https://blog.laoda.de/archives/vps-hetzner/index.html">Hetzner</a>上，其中搬瓦工有免费的自动备份，Hetzner也有收费的自动备份功能，咕咕都用上了，搭配这个脚本，一定程度上减少了数据丢失的风险。</p><h2 id="NAS的数据备份"><a href="#NAS的数据备份" class="headerlink" title="NAS的数据备份"></a>NAS的数据备份</h2><img src="https://img.laoda.de/i/2023/09/22/spokpd-0.webp" alt="37f639a2a4f8f78bbdf60881c93d9d9d.png" style="zoom: 33%;" /><p>咕咕之前用的威联通TS-453BMini（8G版本），系统还是比较复杂的（上周挂了小黄鱼打算出掉，有想要接盘的吗）</p><p>前俩周淘了一台群晖的Synology DS920+，发现这个系统才友好嘛。这边就以群晖来举例子。</p><p>首先说说RAID的事情。</p><p>这边直接放出我自己个人的做法：</p><p>不组RAID，不做SHR，全部四块硬盘用的都是BASIC。</p><p>简单聊一下为啥。</p><ul><li>SHR 群晖自己的RAID模式，适合小白，本质上是根据硬盘数量帮你自动组RAID1、RAID5之类的</li><li>RAID0 读写速度翻倍，享受全部硬盘容量，但是一块坏了，数据就全丢了，风险太高（如果你是纯搞PT刷流量可以考虑）</li><li>RAID1 其实本质就是一块硬盘完全同步另一块硬盘的数据，同步的作用，的确是可以一定程度帮忙恢复数据的（一块硬盘坏了），但是对我来说，重要的数据即使丢了一点也很可惜，还是得备份，而且RAID1还损失了一半的硬盘空间。</li><li>RAID5 也有一定的容错能力，但是据说恢复数据非常非常慢，而且最好等你新硬盘到了再拆坏掉的硬盘，不然期间又坏了一块硬盘，你的数据就都没了。而且恢复期间服务用不了，比较讨厌。</li><li>JBOD 这个曾经是咕咕在类似OVH和HZ独立服务器上最想要弄的模式，因为搞PT下载，一个盘只有2T不够用（qb挂载的问题只能有一个路径，换另一个路径似乎这个路径下就做不了种了），把4块2T合在一起，直接变8T就很爽了。最近才知道原来这种情况下万一有一块硬盘坏了，数据也是全丢的，那不如直接上RAID0 了（如果有错误，欢迎评论区指出）</li></ul><p>所以咕咕最后的选择是全部BASIC模式，类似Windows上的CDEF盘一样，彼此不干扰，重要的数据自己再备份。</p><p>备份方案：</p><p>Cloud Sync 挂载 Onedrive备份重要文件（强烈建议大家可以搞一个office365的家庭版）</p><img src="https://img.laoda.de/i/2023/09/22/sppms8-0.webp" alt="5173fadaa9fd2565de71f60e5420355e.png" style="zoom:33%;" /><p>再用 USB Copy，备份一份到移动硬盘上。（咕咕用的是很多年以前的LaCie 1T版本，但是花了529 &#x3D; &#x3D; 没怎么关注移动硬盘了，欢迎大家在评论区推荐性价比高的）</p><img src="https://img.laoda.de/i/2023/09/22/spqu2n-0.webp" alt="a19985c50a9eb7654adcedf0a97845af.png" style="zoom: 33%;" /><p>这样一来，也符合321备份原则，可以放心数据安全问题了。</p><blockquote><p>PS：其实不管是群晖还是威联通，本质都是Linux系统，也都能算“服务器”，完全也可以用前面服务器备份的方法来搞，不过既然这边有现成的套件，咕咕就用套件了</p></blockquote><h2 id="本地电脑的数据备份"><a href="#本地电脑的数据备份" class="headerlink" title="本地电脑的数据备份"></a>本地电脑的数据备份</h2><img src="https://img.laoda.de/i/2023/09/22/sps79s-0.webp" alt="a942fdeea69f1f44966d93cfa84f4cf2.png" style="zoom:80%;" /><p>这边咕咕用的就比较多了，咕咕日常使用的是MacBook Air，我开通了iCloud的2T套餐，手上又有家庭版的1T的Onedrive还有<a href="https://blog.laoda.de/archives/docker-compose-install-nextcloud-aio/index.html">自建的Nextcloud</a></p><p>这边我都用了 &#x3D; &#x3D;</p><p>文稿和桌面文件夹用iCloud同步，和家里的MacMini配合使用起来还不错。</p><p>工作的文件大部分都在Onedrive里头，这个Windows电脑、Mac电脑都能同步，上下班不用再背电脑回去了。</p><p>挂载Nextcloud一般放一些个人的资料。Nextcloud有一个问题就是它没办法和iCloud和Onedrive一样有个“释放本地空间”的功能，这样会比较占本地的空间，没法想下载下载想释放空间释放空间，有点遗憾。</p><p>以上。写的有点粗糙，希望能够给大家有所启发。</p><p>有问题，或者文中有什么错误的地方也欢迎大家在评论区交流指正。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今天在整理文件，正好稍微梳理一下自己在不同设备上的备份方法，简单和大家分享下。（有不对的地方或者更好的建议欢迎评论区指出～）&lt;/p&gt;
&lt;p&gt;先简单介绍一个ChatGPT给出的321备份策略（有很多种说法，这个是其中一种）：&lt;/p&gt;
&lt;img src=&quot;https://img</summary>
      
    
    
    
    <category term="有用的小知识" scheme="https://blog.laoda.de/categories/%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="备份" scheme="https://blog.laoda.de/tags/%E5%A4%87%E4%BB%BD/"/>
    
    <category term="NAS" scheme="https://blog.laoda.de/tags/NAS/"/>
    
    <category term="iCloud" scheme="https://blog.laoda.de/tags/iCloud/"/>
    
    <category term="Onedrive" scheme="https://blog.laoda.de/tags/Onedrive/"/>
    
  </entry>
  
  <entry>
    <title>下架多年，重磅回归！搬瓦工传家宝49美元 CN2 GIA套餐回来了！这次还有限量版免费更换IP套餐！</title>
    <link href="https://blog.laoda.de/archives/bwg-promotion-2023/"/>
    <id>https://blog.laoda.de/archives/bwg-promotion-2023/</id>
    <published>2023-09-12T13:05:23.000Z</published>
    <updated>2023-11-14T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="【2023-11-14更新】"><a href="#【2023-11-14更新】" class="headerlink" title="【2023-11-14更新】"></a>【2023-11-14更新】</h3><p><strong>车又来了！</strong></p><p>目前，</p><p>搬瓦工年付$49.99美元 CN2 GIA套餐补货（最推荐！！！）</p><p>FREEDOM PLAN 限量版套餐 -不可切换机房（对IP有需求的推荐！！！）</p><p>这俩49美金&#x2F;年和89美金&#x2F;年的还有货！</p><p>非常建议大家使用新邮箱购买！万一不要了可以出手。（49刀这款之前二手市场溢价贼高 &#x3D; &#x3D;）</p><p>咕咕已经入手一个了 &#x3D; &#x3D;</p><p><img src="https://img.laoda.de/i/2023/09/12/zmh8f5-0.webp" alt="image-20230912215404833"></p><p>一张图告诉你为啥要买：</p><img src="https://img.laoda.de/i/2023/09/13/tyk9g9-0.webp" alt="image-20230913181155450" style="zoom:67%;" /><p>偷懒，以下是ChatGPT生成的：</p><p>亲爱的网络爱好者们，搬瓦工正在推出他们的全新套餐——FREEDOM PLAN。这个精心打造的计划，仅适用于 DC2 AO Coresite 机房，只需$89&#x2F;年，就可以享受2核 CPU、2GB 内存、40GB SSD 硬盘、2000GB 流量以及高达2.5Gbps的带宽——这是你所需要的一切，尽在这个包里！</p><p>最值得一提的是，此套餐独有的优惠——每两周都可以免费更换一次 IP 地址。想象一下这样的自由和便利，每14天，都有新的开始等你接受。更为独特的是，你无需为更换 IP 换得头痛而烦恼，一切都已在这份套餐里包含了。</p><p>不仅如此，今天是个特殊的日子，搬瓦工正与前所未有的慷慨心情为你重新上架一款备受热爱的产品——洛杉矶DC6 CN2 GIA-E限量版。这款产品已经下架多年，如今又重磅回归，仅需$46.59&#x2F;年。别忘了，还有 DC9、日本软银等多款限量版套餐都重新上架了。</p><p>这是一个不可多得的机会，无论你是刚入手的初学者，还是寻求网络性能升级的专业人士，我们的新款优化线路的产品都能满足你的需求。如果你一直在寻找一款性价比高的机器，那么今天就是你找寻的那一天。别犹豫！立即享受搬瓦工为你实现的一切网络自由的可能性吧。</p><p><img src="https://img.laoda.de/i/2023/09/12/xx85tb-0.webp" alt="搬瓦工，上架两周免费更换IP套餐年付89美元，并补货美西DC6/DC9/日本软银等限量套餐/年付49美元起"></p><h4 id="1、官网"><a href="#1、官网" class="headerlink" title="1、官网"></a>1、官网</h4><p><strong>网址</strong>： <strong><a href="https://bwh81.net/aff.php?aff=67086">https://bwh81.net</a></strong></p><p>日常6.81%优惠码：<a href="https://bwh81.net/aff.php?aff=67086">BWHNCXNVXV</a></p><p>搬瓦工介绍：<a href="https://blog.laoda.de/archives/vps-bandwagonhost">https://blog.laoda.de/archives/vps-bandwagonhost</a></p><h4 id="2、搬瓦工年付-49-99美元-CN2-GIA套餐补货（最推荐！！！）"><a href="#2、搬瓦工年付-49-99美元-CN2-GIA套餐补货（最推荐！！！）" class="headerlink" title="2、搬瓦工年付$49.99美元 CN2 GIA套餐补货（最推荐！！！）"></a>2、搬瓦工年付$49.99美元 CN2 GIA套餐补货（最推荐！！！）</h4><p>SPECIAL 10G KVM PROMO V5 - LOS ANGELES - CN2 GIA LIMITED EDITION</p><p>三网CN2 GIA（移动去程直连）线路。可选 DC6 CN2 GIA-E、DC9 CN2 GIA、日本软银、荷兰联通 9929 等机房。</p><p>可用机房预览：</p><p><img src="https://img.laoda.de/i/2023/09/13/91awo-0.webp" alt="image-20230913001515552"></p><p>测试IP：65.49.131.102</p><ul><li>内存：512M</li><li>CPU：1核</li><li>硬盘：10G SSD</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$49.99&#x2F;年（可使用：<a href="https://bwh81.net/aff.php?aff=67086">BWHCCNCXVV</a> 优惠6.78%）</li><li><a href="https://bwh81.net/aff.php?aff=67086&pid=94"><strong>购买链接</strong></a></li></ul><h4 id="3、FREEDOM-PLAN-限量版套餐-不可切换机房（对IP有需求的推荐！！！）"><a href="#3、FREEDOM-PLAN-限量版套餐-不可切换机房（对IP有需求的推荐！！！）" class="headerlink" title="3、FREEDOM PLAN 限量版套餐 -不可切换机房（对IP有需求的推荐！！！）"></a>3、FREEDOM PLAN 限量版套餐 -不可切换机房（对IP有需求的推荐！！！）</h4><p>特色：每两周可免费更换一次 IP 地址。</p><p>网络：三网双程直连，走的都是各自的骨干线路。</p><p>测试 IP：65.49.198.195</p><ul><li>内存：2G</li><li>CPU：2核</li><li>硬盘：40G SSD</li><li>流量：2000G&#x2F;月</li><li>带宽：2.5Gbps</li><li>价格：$89&#x2F;年（可使用：<a href="https://bwh81.net/aff.php?aff=67086">BWHCCNCXVV</a> 优惠6.78%）</li><li><a href="https://bwh81.net/aff.php?aff=67086&pid=133"><strong>购买链接</strong></a></li></ul><h4 id="4、DC9-CN2-GIA-限量版-VPS补货"><a href="#4、DC9-CN2-GIA-限量版-VPS补货" class="headerlink" title="4、DC9 CN2 GIA 限量版 VPS补货"></a>4、DC9 CN2 GIA 限量版 VPS补货</h4><p>SPECIAL 20G KVM PROMO V3 - LOS ANGELES - CN2 GIA LIMITED EDITION DC9 VPS</p><p>三网CN2 GIA（移动去程直连）线路。可使用 DC9 CN2 GIA、DC3 CN2 等机房（不能用 DC6、软银、EUNL_9）</p><p>测试IP：65.49.131.102</p><ul><li>内存：1G</li><li>CPU：1核</li><li>硬盘：20G SSD</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$79.99&#x2F;年（可使用：<a href="https://bwh81.net/aff.php?aff=67086">BWHNCXNVXV </a> 优惠6.58%，折后 $74.73&#x2F;年）</li><li><a href="https://bwh81.net/aff.php?aff=67086&pid=112"><strong>购买链接</strong></a></li></ul><h4 id="4、DC6-CN2-GIA-E-限量版-VPS-89-9美元款（建站推荐！！！）"><a href="#4、DC6-CN2-GIA-E-限量版-VPS-89-9美元款（建站推荐！！！）" class="headerlink" title="4、DC6 CN2 GIA-E 限量版 VPS - 89.9美元款（建站推荐！！！）"></a>4、DC6 CN2 GIA-E 限量版 VPS - 89.9美元款（建站推荐！！！）</h4><p>三网CN2 GIA（移动去程直连）线路。可切换机房：美西DC6（USCA_6）、DC9（USCA_9）、日本软银 (JPOS_1)、荷兰（EUNL_9）等</p><blockquote><p>目前可在购买后升级到 CN2 GIA-E 40G 限量版，仅需10美元配置翻倍。</p></blockquote><ul><li>内存：1G</li><li>CPU：1核</li><li>硬盘：20G SSD</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$89.99&#x2F;年（可使用：<a href="https://bwh81.net/aff.php?aff=67086">BWHNCXNVXV</a> 优惠6.81%，折后价83.86美元。）</li><li><a href="https://bwh81.net/aff.php?aff=67086&pid=105"><strong>购买链接</strong></a></li></ul><h4 id="5、日本软银限量版套餐补货"><a href="#5、日本软银限量版套餐补货" class="headerlink" title="5、日本软银限量版套餐补货"></a>5、日本软银限量版套餐补货</h4><p>三网双程都是走的日本软银，此外移动去程为cmi线路。日本软银 (JPOS_1)，不可更换机房。</p><ul><li>内存：512M</li><li>CPU：1核</li><li>硬盘：10G SSD（RAID-10）</li><li>流量：500G&#x2F;月</li><li>带宽：1Gbps</li><li>价格：$69.99&#x2F;年（可使用：<a href="https://bwh81.net/aff.php?aff=67086">BWHNCXNVXV </a> 优惠6.58%）</li><li><a href="https://bwh81.net/aff.php?aff=67086&pid=104"><strong>购买链接</strong></a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;【2023-11-14更新】&quot;&gt;&lt;a href=&quot;#【2023-11-14更新】&quot; class=&quot;headerlink&quot; title=&quot;【2023-11-14更新】&quot;&gt;&lt;/a&gt;【2023-11-14更新】&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;车又来了！&lt;/strong&gt;</summary>
      
    
    
    
    <category term="VPS推荐" scheme="https://blog.laoda.de/categories/VPS%E6%8E%A8%E8%8D%90/"/>
    
    
    <category term="CN2 GIA" scheme="https://blog.laoda.de/tags/CN2-GIA/"/>
    
    <category term="搬瓦工" scheme="https://blog.laoda.de/tags/%E6%90%AC%E7%93%A6%E5%B7%A5/"/>
    
  </entry>
  
  <entry>
    <title>无惧DDOS，无需开放额外端口，无需服务器，随时随地访问局域网Web应用——Cloudflare Tunnel</title>
    <link href="https://blog.laoda.de/archives/cloudflare-tunnel/"/>
    <id>https://blog.laoda.de/archives/cloudflare-tunnel/</id>
    <published>2023-09-09T12:18:19.000Z</published>
    <updated>2023-09-09T13:22:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>利用这个方法，可以让你在局域网（尤其是NAS）上搭建的web应用支持公网访问，成本低而且操作简单！</p><p>如果是博客的话还可以有效防止DDOS攻击！</p><blockquote><p>对于联通用户可能不太友好，据咕咕所知很多地区联通用户访问不了Cloudflare的节点</p></blockquote><h2 id="1-视频"><a href="#1-视频" class="headerlink" title="1. 视频"></a>1. 视频</h2><p>文字比较简略，强烈建议搭配视频食用！</p><p>YouTube：<a href="https://youtu.be/Q_xB3433WTg">https://youtu.be/Q_xB3433WTg</a></p><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1pj411C78j/">https://www.bilibili.com/video/BV1pj411C78j/</a></p><h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2><ul><li>一个域名（推荐<a href="https://loll/cc.ns">Namesilo</a>注册，输入优惠码<code>laodade</code>或者<code>gugugee</code>可以便宜1美元）</li><li>一张外币信用卡或者PayPal</li></ul><h2 id="3-配置域名"><a href="#3-配置域名" class="headerlink" title="3. 配置域名"></a>3. 配置域名</h2><h3 id="3-1-注册Namesilo"><a href="#3-1-注册Namesilo" class="headerlink" title="3.1 注册Namesilo"></a>3.1 注册Namesilo</h3><p><img src="https://img.laoda.de/i/2023/09/09/vq76zf-0.webp" alt="fea8081ce89bea90ea01ef29cd2fce7a.png"></p><h3 id="3-2-注册CloudFlare"><a href="#3-2-注册CloudFlare" class="headerlink" title="3.2 注册CloudFlare"></a>3.2 注册CloudFlare</h3><p><img src="https://img.laoda.de/i/2023/09/09/vr7bz2-0.webp" alt="ab221202a98a188093d1ed8bf1630f5c.png"></p><h3 id="3-3-更换DNS解析"><a href="#3-3-更换DNS解析" class="headerlink" title="3.3 更换DNS解析"></a>3.3 更换DNS解析</h3><p><img src="https://img.laoda.de/i/2023/09/09/w1lfqa-0.webp" alt="image-20230909193757157"></p><h2 id="4-开通CloudFlare-Tunnel"><a href="#4-开通CloudFlare-Tunnel" class="headerlink" title="4. 开通CloudFlare Tunnel"></a>4. 开通CloudFlare Tunnel</h2><p>绑定一个支付方式，实际CF并不会扣钱。</p><p><img src="https://img.laoda.de/i/2023/09/09/xrzzrt-0.webp" alt="2023-09-09-0002"></p><h2 id="5-群晖配置Cloudflared"><a href="#5-群晖配置Cloudflared" class="headerlink" title="5. 群晖配置Cloudflared"></a>5. 群晖配置Cloudflared</h2><h3 id="5-1-使用图形化界面安装Cloudflared"><a href="#5-1-使用图形化界面安装Cloudflared" class="headerlink" title="5.1 使用图形化界面安装Cloudflared"></a>5.1 使用图形化界面安装Cloudflared</h3><p><img src="https://img.laoda.de/i/2023/09/09/vszu81-0.webp" alt="image-20230909192313776"></p><p><img src="https://img.laoda.de/i/2023/09/09/vt5hum-0.webp" alt="image-20230909192339730"></p><p><img src="https://img.laoda.de/i/2023/09/09/vtlx6v-0.webp" alt="image-20230909192415905"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --restart=always cloudflare/cloudflared:latest tunnel --no-autoupdate run --token eyJhIjoiNGQ4ZGY0ZjVjODJjYmY0MmUwNjg3NmRmZWZmZmZlODIieLCJ0IjoiODY3YjgzNGMtNWFkYy00O0TI3LTkyN2MtYmQyNWUzYzk5MTUyIiwicyI6Ik1EVmpaalEwT0RVdE1URmlPUzAwTW1JeExUZ3wlOVGNr0TjJFeU9EZzFNV1kxTTJNMyJ9</span><br></pre></td></tr></table></figure><p>命令填：<code>tunnel run --token eyJhIjoiNGQ4ZGY0ZjVjODJjYmY0MmUwNjg3NmRmZWZmZmZlODIieLCJ0IjoiODY3YjgzNGMtNWFkYy00O0TI3LTkyN2MtYmQyNWUzYzk5MTUyIiwicyI6Ik1EVmpaalEwT0RVdE1URmlPUzAwTW1JeExUZ3wlOVGNr0TjJFeU9EZzFNV1kxTTJNMyJ9</code>即可。</p><h3 id="5-2-使用命令行安装Cloudflared（推荐）"><a href="#5-2-使用命令行安装Cloudflared（推荐）" class="headerlink" title="5.2 使用命令行安装Cloudflared（推荐）"></a>5.2 使用命令行安装Cloudflared（推荐）</h3><h4 id="5-2-1-打开SSH"><a href="#5-2-1-打开SSH" class="headerlink" title="5.2.1 打开SSH"></a>5.2.1 打开SSH</h4><p><img src="https://img.laoda.de/i/2023/09/09/vrewat-0.webp" alt="f319dbbe140bba2de1c8672eb28adea3.png"></p><h4 id="5-2-2-运行"><a href="#5-2-2-运行" class="headerlink" title="5.2.2 运行"></a>5.2.2 运行</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --restart=always cloudflare/cloudflared:latest tunnel --no-autoupdate run --token eyJhIjoiNGQ4ZGY0ZjVjODJjYmY0MmUwNjg3NmRmZWZmZmZlODIieLCJ0IjoiODY3YjgzNGMtNWFkYy00O0TI3LTkyN2MtYmQyNWUzYzk5MTUyIiwicyI6Ik1EVmpaalEwT0RVdE1URmlPUzAwTW1JeExUZ3wlOVGNr0TjJFeU9EZzFNV1kxTTJNMyJ9</span><br></pre></td></tr></table></figure><p>这条命令的完整解释如下：</p><ul><li><p><code>docker run</code>: 这是用来启动一个新容器的命令。</p></li><li><p><code>-d</code>: 这个选项让 Docker 在后台运行这个容器，并且返回容器 ID。</p></li><li><p><code>--restart=always</code>: 如上所述，这将设置容器的重启策略为始终重启。</p></li><li><p><code>cloudflare/cloudflared:latest</code>: 这是你想运行的 Docker 镜像。具体来说，你正在运行 Cloudflare 的 <code>cloudflared</code> 镜像的最新版本。</p></li><li><p><code>tunnel --no-autoupdate run --token eyJhI...J9</code>: 这些是传递给 <code>cloudflared</code> 镜像的参数，用于配置和运行你的 tunnel。</p></li></ul><p>这条命令将启动一个新的 <code>cloudflared</code> 容器，这个容器将始终在后台运行，并在停止后自动重新启动。</p><h2 id="6-CF后台配置"><a href="#6-CF后台配置" class="headerlink" title="6. CF后台配置"></a>6. CF后台配置</h2><p><img src="https://img.laoda.de/i/2023/09/09/w6c4s4-0.webp" alt="tunnel-0001"></p><p><img src="https://img.laoda.de/i/2023/09/09/w6o85h-0.webp" alt="tunnel-0003"></p><p><img src="https://img.laoda.de/i/2023/09/09/w6u68w-0.webp" alt="tunnel-0004"></p><p><img src="https://img.laoda.de/i/2023/09/09/w6wb6z-0.webp" alt="tunnel-0005"></p><p><img src="https://img.laoda.de/i/2023/09/09/w78iec-0.webp" alt="tunnel-0006"></p><p><img src="https://img.laoda.de/i/2023/09/09/w7b09s-0.webp" alt="tunnel-0007"></p><h2 id="7-添加额外认证"><a href="#7-添加额外认证" class="headerlink" title="7. 添加额外认证"></a>7. 添加额外认证</h2><p><img src="https://img.laoda.de/i/2023/09/09/w7e4k8-0.webp" alt="tunnel-0008"></p><p><img src="https://img.laoda.de/i/2023/09/09/w7ifp5-0.webp" alt="tunnel-0009"></p><p><img src="https://img.laoda.de/i/2023/09/09/w7suox-0.webp" alt="tunnel-0011"></p><p><img src="https://img.laoda.de/i/2023/09/09/w7uoar-0.webp" alt="tunnel-0012"></p><p><img src="https://img.laoda.de/i/2023/09/09/w7wkpv-0.webp" alt="tunnel-0013"></p><p><img src="https://img.laoda.de/i/2023/09/09/w8195d-0.webp" alt="tunnel-0017"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;利用这个方法，可以让你在局域网（尤其是NAS）上搭建的web应用支持公网访问，成本低而且操作简单！&lt;/p&gt;
&lt;p&gt;如果是博客的话还可以有效防止DDOS攻击！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;对于联通用户可能不太友好，据咕咕所知很多地区联通用户访问不了Cloudfla</summary>
      
    
    
    
    <category term="有用的小知识" scheme="https://blog.laoda.de/categories/%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="NAS" scheme="https://blog.laoda.de/tags/NAS/"/>
    
    <category term="Cloudflare Tunnel" scheme="https://blog.laoda.de/tags/Cloudflare-Tunnel/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】Nextcloud All-in-One 全新搭建分享，拒绝繁琐配置，开箱即用！维护简单！</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-nextcloud-aio/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-nextcloud-aio/</id>
    <published>2023-08-26T01:20:35.000Z</published>
    <updated>2023-10-17T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><img src="https://img.laoda.de/i/2023/08/25/rbpf7g-0.webp" alt="IMG_9771C6762B1A-1.jpeg" style="zoom:33%;" /><p>百度网盘，咕咕已经好久没用了，准确来说，百度的产品，咕咕已经好久没用了，今天收到了这条短信，打算偷偷用公司的百度会员把之前存的一些老古董学习资料转移备份一波。</p><p>问题来了，东西放哪？</p><p>咕咕目前用的主力存储空间是：</p><ul><li>1T的office 365的Onedrive</li><li>1T的Google One</li><li>2T的iCloud 家庭组</li></ul><p>这些都是第三方的大厂，而且相对来说比较靠谱。</p><p>然而，谷歌也不乏因为用户图库里面有小孩子下体的照片，误判为儿童色情内容，把用户账号封禁的例子。要想要真正把数据掌握在自己手里，还是得多备份。</p><p>或者说，自建一个网盘，多备份。</p><p>Nextcloud是非常有名的开源网盘，功能丰富。</p><p>之前和大家介绍过Nextcloud的搭建方法：</p><p>宝塔版本：</p><p><a href="https://blog.laoda.de/archives/nextcloud-aapanel-install/index.html">【好玩的项目】可能是史上最全的基于宝塔面板（海外版 aapanel）的 Nextcloud 网盘搭建教程！</a></p><p>无面板版本：<br><a href="https://blog.laoda.de/archives/docker-compose-install-nextcloud/index.html">【好玩儿的 Docker 项目】可能是目前全网最完整的 Docker 搭建 Nextcloud 教程（包含安全与设置警告报错信息的解决方法）</a></p><p>以上任意一个搭建方法，搭完之后都要处理一堆的问题，很是累人。</p><p>根据小伙伴们的反馈，用上述方法搭建完成之后，想要装onlyoffice等一些插件也会多多少少遇到一些奇奇怪怪的问题。</p><p>今天我们就来分享如何彻底解决以上安装Nextcloud的痛点。</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><img src="https://img.laoda.de/i/2023/08/25/rbrisj-0.webp" alt="5d00cf8124b264eacc182aba357bd3fd.png" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/08/25/rbugyf-0.webp" alt="2fb495fb09994de60f232fff0335b16b.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rbvqbx-0.webp" alt="e0ddba048766714b8c2f66c8bfa58369.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rc5xl9-0.webp" alt="348e8be10f8ee969184740aae3df03b9.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rc7cu0-0.webp" alt="4d4f7027061390bac462a74e8f0b6a11.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rc9g7x-0.webp" alt="1b6cf331c449698c1cf0c812814767a6.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcaz1j-0.webp" alt="f9015a710ade4e45cc21e94b37fa2765.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rccdiu-0.webp" alt="039659b98a430182355bcbd237cd502a.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcdn10-0.webp" alt="5955d14f93f6f115c6cb83eb83b6e2ba.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcesnv-0.webp" alt="18bb49ff699fe6c4e401837fa89f96d4.png" style="zoom:33%;" /><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li>支持docker一键部署，用容器部署容器</li><li>更新简单</li><li>高性能后端</li><li>支持全局搜索</li><li>支持Nextcloud Talk</li><li>支持ClamAV（Nextcloud的杀毒软件后端）</li><li>支持全套办公套件</li><li>支持备份（基于BorgBackup）</li><li>省心省力</li><li>文档及其丰富（各种地方的搭建教程均有）<br>……</li></ul><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>GitHub官方仓库：<a href="https://github.com/nextcloud/all-in-one">https://github.com/nextcloud/all-in-one</a><br>官方Docker镜像：<a href="https://hub.docker.com/r/nextcloud/all-in-one">https://hub.docker.com/r/nextcloud/all-in-one</a><br>官方反代相关文档地址：<a href="https://github.com/nextcloud/all-in-one/blob/main/reverse-proxy.md">https://github.com/nextcloud/all-in-one/blob/main/reverse-proxy.md</a> （支持各种反代）</p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：<del>腾讯香港轻量应用服务器 24 元 &#x2F; 月 VPS 一台</del> 咕咕演示搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：内存建议2G以上，越大越好！硬盘也是越大越好</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/CapStYi-Djs">https://youtu.be/CapStYi-Djs</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1Yu4y1X7yX">https://www.bilibili.com/video/BV1Yu4y1X7yX</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/aio-nextcloud</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/aio-nextcloud</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>以下是咕咕修改的，可以看看有啥不一样（具体见视频）</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"> <span class="attr">nextcloud_aio_mastercontainer:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">nextcloud_aio_mastercontainer</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="attr">nextcloud:</span></span><br><span class="line">   <span class="attr">image:</span> <span class="string">nextcloud/all-in-one:latest</span></span><br><span class="line">   <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">   <span class="attr">container_name:</span> <span class="string">nextcloud-aio-mastercontainer</span></span><br><span class="line">   <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">nextcloud_aio_mastercontainer:/mnt/docker-aio-config</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock:ro</span></span><br><span class="line">   <span class="attr">ports:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="number">8090</span><span class="string">:8080</span> <span class="comment"># change the port on the left side if it&#x27;s already in use on your host system.</span></span><br><span class="line">   <span class="attr">environment:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">APACHE_PORT=11000</span>  <span class="comment"># change this port number if 11000 is already in use on your host system.</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">APACHE_DISABLE_REWRITE_IP=1</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">NEXTCLOUD_TRUSTED_DOMAINS=pan.gugu.ovh</span> <span class="number">31.22</span><span class="number">.109</span><span class="number">.18</span> <span class="comment"># Your domain name + proxy host IP</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">TRUSTED_PROXIES=31.22.109.18</span> <span class="comment"># proxy host IP</span></span><br></pre></td></tr></table></figure><p>大家修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8090</code>和<code>11000</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>图中示例填的是 <code>5230</code>，备注填的是 <code>memos</code>，这边我们填 <code>8090</code>，示例填 <code>aio-nextcloud</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2022/08/19/o4byqz-2.webp" alt="image-20220819145844555" style="zoom: 25%;" /><p>查看端口是否被占用（以 <code>8090</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8090  <span class="comment">#查看 8090 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8090</code> 访问了。</p><p>但是这边我们需要先搞一下反向代理！</p><p>做反向代理前，你需要一个域名！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2023/08/25/rcrfvt-0.webp" alt="c1352ab7d41b750af109fe70df9838fb.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcsx5o-0.webp" alt="a289ca549a9d1d79348aefac66486f2e.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcuk4b-0.webp" alt="e1f240a840f498e5869a29dc0f9348bd.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/rcvy7u-0.webp" alt="b8c1b61838dc0ca9a2c6d8d220fb97d5.png" style="zoom:33%;" /><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">client_body_buffer_size</span> <span class="number">512k</span>;</span><br><span class="line"><span class="attribute">proxy_read_timeout</span> <span class="number">86400s</span>;</span><br><span class="line"><span class="attribute">client_max_body_size</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>11000</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 aio-nextcloud 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>aio-nextcloud</code> 所在的服务器 IP 就行。</p><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><p>然后输入：<a href="https://ip:8090/">https://ip:8090</a> 进入安装页面。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:11000/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者结合官方文档食用：<a href="https://github.com/nextcloud/all-in-one">https://github.com/nextcloud/all-in-one</a></p><h3 id="8-1-登录"><a href="#8-1-登录" class="headerlink" title="8.1 登录"></a>8.1 登录</h3><p>输入<code>https://ip:8090</code>，登录nextcloud后台安装页面。</p><p>记住这个密码：</p><img src="https://img.laoda.de/i/2023/08/25/rddvv2-0.webp" alt="403eecf1f240d71c1fb50ed58b6bc92e.png" style="zoom: 33%;" /><p>输入密码：</p><img src="https://img.laoda.de/i/2023/08/25/rdflfi-0.webp" alt="04a2c5341a79f40a5452faa45c466001.png" style="zoom:33%;" /><p>输入你在<code>docker-compose.yml</code>填的域名：</p><img src="https://img.laoda.de/i/2023/08/25/rdi7xw-0.webp" alt="692c6b9a57842b0f893f68d83bb3ac26.png" style="zoom:33%;" /><p>选择想要额外安装的容器（我这边全选了，注意全选的话内存官方建议8G以上）</p><img src="https://img.laoda.de/i/2023/08/25/rdjszs-0.webp" alt="ed7035cb2b4d39a1aecf14b03880bc09.png" style="zoom:33%;" /><p>等全绿了说明安装好了，这个过程根据你服务器的性能时间长短不一，慢的可能要10分钟。</p><img src="https://img.laoda.de/i/2023/08/25/re5x6j-0.webp" alt="2ee0014bea22791be8fea1c10aa99044.png" style="zoom:33%;" /><p>耐心等待之后，搞定啦！</p><img src="https://img.laoda.de/i/2023/08/25/re7vkj-0.webp" alt="21bdcf0cb22e65f6a1b42efd6a835eef.png" style="zoom:33%;" /><h3 id="8-2-更新-aio-nextcloud"><a href="#8-2-更新-aio-nextcloud" class="headerlink" title="8.2 更新 aio-nextcloud"></a>8.2 更新 aio-nextcloud</h3><p>同样进入安装页面，点击更新即可。</p><h3 id="8-3-卸载-aio-nextcloud"><a href="#8-3-卸载-aio-nextcloud" class="headerlink" title="8.3 卸载 aio-nextcloud"></a>8.3 卸载 aio-nextcloud</h3><p>同样进入安装页面，先停止所有容器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/aio-nextcloud</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/aio-nextcloud  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>你还需要查看一下volume，删除volume。</p><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><h3 id="9-1-导出数据插件似乎有问题"><a href="#9-1-导出数据插件似乎有问题" class="headerlink" title="9.1 导出数据插件似乎有问题"></a>9.1 导出数据插件似乎有问题</h3><img src="https://img.laoda.de/i/2023/08/25/reaatk-0.webp" alt="b280834aa5396bbb25e508e1c999eed1.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/s4haku-0.webp" alt="3d2724e28a18c0fafb237ec58880c923.png" style="zoom:33%;" /><h3 id="9-2-迁移服务器很丝滑"><a href="#9-2-迁移服务器很丝滑" class="headerlink" title="9.2 迁移服务器很丝滑"></a>9.2 迁移服务器很丝滑</h3><p>咕咕实测很顺利，主要就是找到你备份的那个borg文件夹位置（备份的密码也千万记得），把他迁移到新的服务器上，然后重新运行一下<code>docker-compose.yml</code>文件即可</p><p>登录安装页面之后，选择恢复文件（注意选对borg的路径），输入密码，后台就会先起一个borg的容器，等备份恢复了之后，再次登录安装页面，再启动其他的容器即可。</p><p>下面是几张咕咕自测的参考图：</p><img src="https://img.laoda.de/i/2023/08/25/s4x05z-0.webp" alt="002f91235efbdd321995f71877645c16.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/s6tp39-0.webp" alt="1f7eeac788a7110a479e7238ab2512e2.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/25/s74w6e-0.webp" alt="17348b5f7579b56c827631cf75fbfe47.png" style="zoom:33%;" /><h3 id="9-3-删除备份（更换备份文件夹路径）"><a href="#9-3-删除备份（更换备份文件夹路径）" class="headerlink" title="9.3 删除备份（更换备份文件夹路径）"></a>9.3 删除备份（更换备份文件夹路径）</h3><p>本地先删除原来的borg文件夹，然后在服务器输入<code>sudo docker exec nextcloud-aio-mastercontainer rm /mnt/docker-aio-config/data/borg.config</code> 之后通过Nextcloud后台进入管理页面：</p><img src="https://img.laoda.de/i/2023/09/19/nnja10-0.webp" alt="image-20230919143024342" style="zoom:50%;" /><p>就可以重新设置一个备份目录了。</p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/nextcloud/all-in-one/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/nextcloud/all-in-one">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/nextcloud/all-in-one">https://github.com/nextcloud/all-in-one</a><br>官方Docker镜像地址：hub.docker.com&#x2F;r&#x2F;nextcloud&#x2F;all-in-one</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;img src=&quot;https://img.laoda.de/i/2023/08/25/rbpf7g-0.webp&quot; alt=&quot;I</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="DockerCompose" scheme="https://blog.laoda.de/tags/DockerCompose/"/>
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="Nextcloud" scheme="https://blog.laoda.de/tags/Nextcloud/"/>
    
    <category term="开源网盘" scheme="https://blog.laoda.de/tags/%E5%BC%80%E6%BA%90%E7%BD%91%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>Hetzner独立服务器（拍卖机）测评及折腾不完全指南</title>
    <link href="https://blog.laoda.de/archives/hetzner-dedicated-sb/"/>
    <id>https://blog.laoda.de/archives/hetzner-dedicated-sb/</id>
    <published>2023-08-24T10:00:30.000Z</published>
    <updated>2023-08-24T10:34:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>咕咕斥巨资买了一台Hetzner的独立服务器（<a href="https://www.hetzner.com/sb">拍卖机</a>），官方售价27.7欧&#x2F;月。</p><img src="https://img.laoda.de/i/2023/08/24/rc87dd-0.webp" alt="image.png" style="zoom:50%;" /><p>下面就来简单测评一下，供大家参考。</p><p>关于Hetzner的介绍，大家可以移步至：<a href="https://blog.laoda.de/archives/vps-hetzner/index.html">【VPS 选购分享】Hetzner—— 欧洲阿里云！性能小钢炮！非常适合跑业务，还有适合刷 PT 的神鸡！</a></p><h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>首先还是请出秋水的 bench.sh 脚本，这个脚本可以查看 Linux 系统信息，还可以测试网络带宽及硬盘读写速率。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -qO- bench.sh | bash</span><br></pre></td></tr></table></figure><p>运行后如图：</p><img src="https://img.laoda.de/i/2023/08/23/sjs0x8-0.webp" alt="image.png" style="zoom:33%;" /><p>上图第一部分就是 Linux 的详细信息，可以看到 CPU 型号、8核心、内存64G、硬盘买的时候是说512Gx2也就是1T（但是显示是936.7G）、Dedicated 杜甫、Hz自建机房，机房位置纽伦堡等信息。</p><p>第二部分也就是硬盘读写速率，硬盘一般分为 HHD、SSD、NVMe 三类， 正常 SSD 硬盘的 IO 一般在 300MB&#x2F;S 左右，差一点 200MB&#x2F;S 左右，100MB&#x2F;S 以下这种的就是石头盘了，没法用。这边咕咕的是NVMe的盘，正常应该就是900-1000MB&#x2F;S。</p><p>第三部分就是上传下载速率了，这个可以看出服务器的带宽，上传下载的速率，这个机器是 1G 口的基本也跑满了，国内稍微有点差。</p><p>总结一下，上面大家要注意的几个点：</p><p>1、如果是VPS，虚拟方式一定注意是不是 KVM，因为有些商家用的 OpenVZ 虚拟技术而故意不说明，OpenVZ 的缺点是不能修改内核也就不能开启 BBR 和可以随意超售。独立服务器的话，一般就是显示Dedicated了。</p><p>2、硬盘的 IO 差，一般是因为母鸡超售过多造成了，看 IO 数值就可以看出 VPS 有没有超售。独立服务器的话没有超售一说，如果你选的HDD硬盘（假设两块硬盘），觉得IO速度实在过低，还可以选择组raid 0，这样速度会翻倍，但是raid 0 只要有一块硬盘坏了，数据都会丢失，这个得权衡考量。</p><p>3、Speed 测速可以直观地看出 VPS 的带宽，一般G口就是 1000Mbps，百兆口也就是 100Mbps，10G 口也就是高于10000Mbps</p><h3 id="线路测试"><a href="#线路测试" class="headerlink" title="线路测试"></a>线路测试</h3><p>线路测试包括去程和回程，去程是针对的上传数据，回程一般是指下载数据也就是 VPS 回传数据。因此一个 IP 的路由好坏，看回程才有参考价值，去程反而不是那么重要了。</p><p>下面就看看回程路由：</p><h4 id="回程测试"><a href="#回程测试" class="headerlink" title="回程测试"></a>回程测试</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -qO- git.io/besttrace | bash</span><br></pre></td></tr></table></figure><img src="https://img.laoda.de/i/2023/08/23/snxui6-0.webp" alt="image.png" style="zoom:33%;" /><p>这个机器电信回程是直连的，移动和联通脚本问题没测，回程应该不是很理想，线路不咋地，这也是这台机器最大的缺点。（一般这种情况下，会考虑套CloudFlare的CDN使用，所谓带上套，大家都一样，众生平等。）</p><h4 id="去程测试"><a href="#去程测试" class="headerlink" title="去程测试"></a>去程测试</h4><p>下面看看去程，一般来说流量是不对等的，回复流量基本上是请求流量的数倍。</p><p>就比如，你浏览本站的文章，点击一个网址就可以了，电脑把网址发到本博位于国外的服务器，数据一般小于 1KB。但是本站回复你文章内容，里面的文字、图片、脚本等各种资源，压缩后至少也是几十KB，这个过程中去程和回程数据有数倍的差异。如果你看的是油管的视频，出国的流量可能就几兆，但是传过来的视频可能上G，数据相差上百倍。</p><p>所以你应该明白了上面为什么说去程没啥参考价值，因为它压根就不堵。当然，既然写到了去程这个话题，还是留下测试去程的方法：</p><p>打开下面的网址，左边选择你附近的服务器，然后右边填上你的 VPS IP 就可以查看去程路由了：</p><p><a href="https://tools.ipip.net/traceroute.php">https://tools.ipip.net/traceroute.php</a></p><p>上海电信</p><img src="https://img.laoda.de/i/2023/08/24/pgiamt-0.webp" alt="image.png" style="zoom:33%;" />上海联通<img src="https://img.laoda.de/i/2023/08/24/ph1aif-0.webp" alt="image.png" style="zoom:33%;" />上海移动<img src="https://img.laoda.de/i/2023/08/24/phimjb-0.webp" alt="image.png" style="zoom:33%;" /><h4 id="ping值查询"><a href="#ping值查询" class="headerlink" title="ping值查询"></a>ping值查询</h4><p>当然，不能忘了各运营商的 ping 值查询，这算是一个直观且简单的查询方式，如图，如果下面国内部分全线飘红，说明丢包严重，ping 值亚洲 VPS 在 100ms 左右属正常范围，美帝 VPS 在 250ms 左右属正常范围，欧洲在250-300ms左右。</p><p>当然，这些数值受时段的影响比较大，建议北京时间 22：00 - 23：00 高峰期（俗称晚高峰）测试。</p><p><a href="https://ping.pe/">https://ping.pe</a></p><img src="https://img.laoda.de/i/2023/08/24/pgd2k1-0.webp" alt="image.png" style="zoom:33%;" /><p>国内惨不忍睹 &#x3D; &#x3D;</p><h3 id="CPU性能测试"><a href="#CPU性能测试" class="headerlink" title="CPU性能测试"></a>CPU性能测试</h3><p>还是请出秋水的 UnixBench 脚本来测试。</p><p>UnixBench 是一个类 Unix 系（Unix，BSD，Linux）统下的性能测试工具，一个开源工具，被广泛用与测试 Linux 系统主机的性能。UnixBench 的主要测试项目有：系统调用、读写、进程、管道、运算、C库等系统基准性能提供测试数据。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/unixbench.sh &amp;&amp; <span class="built_in">chmod</span> +x unixbench.sh &amp;&amp; ./unixbench.sh</span><br></pre></td></tr></table></figure><p>上面脚本运行需要1个小时左右，运行完会显示类似下面的数据：</p><img src="https://img.laoda.de/i/2023/08/24/pdjnqs-0.webp" alt="image.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/08/24/pdml4w-0.webp" alt="image.png" style="zoom:33%;" /><p>上部分是单核跑分数据，下部分是多核跑分数据。VPS的话单核跑分有500分以上属于正常水平，低于500分就属于性能很弱了。这边独立服务器跑这个分还凑合。</p><h3 id="取消RAID"><a href="#取消RAID" class="headerlink" title="取消RAID"></a>取消RAID</h3><p>默认两块硬盘的话，Hz会自动给你装raid1，即只有一块硬盘的容量，另一块硬盘相当于是备份用的，如果不是特别重要的数据的话，一般会考虑不组raid，这样我们硬盘空间就能完整利用起来了。（除非你是刷PT，不然不建议组raid0）</p><p>首先进入Hetzner的控制后台，找到服务器，选择Rescue (救援模式)，设置完成后重启服务器：</p><img src="https://img.laoda.de/i/2023/08/24/stv0vm-0.webp" alt="db415600eb005d470c09fd338f7f27be.png" style="zoom: 50%;" /><img src="https://img.laoda.de/i/2023/08/24/stw94z-0.webp" alt="236306b87b7c8295cc25c721d6a46561.png" style="zoom:50%;" /><img src="https://img.laoda.de/i/2023/08/24/stx8ap-0.webp" alt="5c7acaad58ed198ac754cb94e74f614a.png" style="zoom: 33%;" /><p>重启完成后登录服务器，现在看到的就是救援模式；</p><p><img src="https://img.laoda.de/i/2023/08/24/szy5ss-0.webp" alt="9dc758f8e60573ffe32cdf0e1fb44dd6.png"></p><p>在救援模式下输入下面命令后按回车</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">installimage</span><br></pre></td></tr></table></figure><p>然后选择你需要安装的系统</p><img src="https://img.laoda.de/i/2023/08/24/stz8g5-0.webp" alt="06c362326cabb91bd216ae76ee798f14.png" style="zoom: 67%;" /><img src="https://img.laoda.de/i/2023/08/24/su02er-0.webp" alt="8d9d81282bce722db89e7e7ac4e50ec7.png" style="zoom:67%;" /><img src="https://img.laoda.de/i/2023/08/24/su0y4v-0.webp" alt="c461ed3a9c975677bd038f827098197c.png" style="zoom:67%;" /><p>选择完成后编辑配置文件；</p><img src="https://img.laoda.de/i/2023/08/24/su26pp-0.webp" alt="abdc141b5e5dfc486318cbf763ce1f9e.png" style="zoom:67%;" /><img src="https://img.laoda.de/i/2023/08/24/su37zd-0.webp" alt="d0f924a8fd74f22a9dbe66fb0ca95c86.png" style="zoom:67%;" /><p>RAID设置区分</p><blockquote><p>NO RIAD：一般情况建议不设置RAID，这样既保证空间大小，也保证了安全性.；<br>RIAD 0：好处：速度快，合并容量，缺点：两个硬盘只要挂一个，那么文件全都挂了；<br>RIAD 1：好处：同时把文件写入到两个硬盘，坏一个也没事，缺点：浪费空间，读写速度稍微有降低；</p></blockquote><p>编辑完成后按<code>F10</code> 保存配置文件；</p><img src="https://img.laoda.de/i/2023/08/24/sud8iq-0.webp" alt="c19dc65b5c83a0c3d03ab736157776d6.png" style="zoom:67%;" /><p>选择<code>yes</code>回车</p><img src="https://img.laoda.de/i/2023/08/24/sueih2-0.webp" alt="6e66366167554e244f22932995008919.png" style="zoom:67%;" /><p>等待程序执行完毕：</p><img src="https://img.laoda.de/i/2023/08/24/sug4lq-0.webp" alt="4f76ddbe0e13c78abc3292f036583b8d.png" style="zoom:67%;" /><p>程序执行完成后输入<code>reboot</code>重启即可：</p><p><img src="https://img.laoda.de/i/2023/08/24/szyi1k-0.webp" alt="be0a4c045730c8b0514dc9bd992b685e.png"></p><p>重启后登录新系统可以查看之前的分区情况</p><p><img src="https://img.laoda.de/i/2023/08/24/szylul-0.webp" alt="d5505acc2f1effc967dd3f2bebb34fa3.png"></p><p><code>RAID 0</code>和<code>RAID 1</code>的测试对比</p><p>RAID 0</p><p><img src="https://img.laoda.de/i/2023/08/24/szyzeg-0.webp" alt="87c7f18154d25fd529849906175821b2.png"></p><p>RAID 1</p><p><img src="https://img.laoda.de/i/2023/08/24/szzayf-0.webp" alt="25a31dcba8adf129773f98274fea79bc.png"></p><p>无RAID</p><p><img src="https://img.laoda.de/i/2023/08/24/szzjl3-0.webp" alt="adbfd0ca48584412ad41baa6bb7a8fbf.png"></p><h3 id="installimage命令一把梭"><a href="#installimage命令一把梭" class="headerlink" title="installimage命令一把梭"></a>installimage命令一把梭</h3><p>上面的方法是图形化一步一步来搞的，其实你也可以直接用一条命令直接自动安装。</p><p>还是利用官方的installimage命令。</p><p>一般你想要知道一个命令支持哪些参数，都可以用<code>命令 -h</code>或者<code>命令 --help</code>来查看。</p><p>比如</p><p><code>installimage -h</code> 或者 <code>installimage --help</code></p><p>以下是installimage命令的参数：</p><p>这是 <code>installimage</code> 的使用说明，该脚本支持多种参数，以下是每个参数的简要描述：</p><ol><li><code>-h</code>: 显示帮助信息。</li><li><code>-a</code>: 自动模式 &#x2F; 批处理模式 - 结合下面的选项使用可以无需进一步交互地进行安装。</li><li><code>-c &lt;configfile&gt;</code>: 使用指定的配置文件进行自动设置。</li><li><code>-x &lt;post-install&gt;</code>: 使用此文件作为安装后脚本，安装完成后在 chroot 环境中执行。</li><li><code>-n &lt;hostname&gt;</code>: 设置指定的主机名。</li><li><code>-r &lt;yes|no&gt;</code>: 是否激活软件 RAID。</li><li><code>-l &lt;0|1|5|6|10&gt;</code>: 设置指定的 RAID 级别。</li><li><code>-i &lt;imagepath&gt;</code>: 使用指定的 IMAGE 进行安装。</li><li><code>-g</code>: 强制验证带有分离的 GPG 签名的图像文件。如果图像无效，安装将中止。</li><li><code>-p &lt;partitions&gt;</code>: 定义要创建的分区。</li><li><code>-v &lt;logical volumes&gt;</code>: 定义要创建的逻辑卷。</li><li><code>-d &lt;drives&gt;</code>: 要使用的驱动器的 &#x2F;dev 名称。</li><li><code>-f &lt;yes|no&gt;</code>: 是否格式化第二块驱动器（如果不用于 RAID）。</li><li><code>-s &lt;de|en&gt;</code>: 用于不同事务的语言（例如 PLESK）。</li><li><code>-z PLESK_&lt;Version&gt;</code>: 安装像 PLESK 这样的可选软件。</li><li><code>-K &lt;path/url&gt;</code>: 从文件&#x2F;URL 安装 SSH 密钥。</li><li><code>-t &lt;yes|no&gt;</code>: 接管救援系统的 SSH 公钥。</li><li><code>-u &lt;yes|no&gt;</code>: 是否允许 USB 驱动器。</li><li><code>-G &lt;yes|no&gt;</code>: 是否生成新的 SSH 主机密钥（默认为 yes）。</li></ol><p>这些选项允许用户在不进入交互式模式的情况下，通过指定适当的参数来自动化服务器的安装过程。在实际使用中，您需要根据具体需求选择和组合这些参数。</p><h4 id="installimage命令设置raid安装"><a href="#installimage命令设置raid安装" class="headerlink" title="installimage命令设置raid安装"></a>installimage命令设置raid安装</h4><p>直接对话<a href="https://blog.laoda.de/archives/chatgpt-plus-depay/index.html">ChatGPT</a>，让它帮个小忙。</p><p>问：</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">`installimage -n hostname -a -r 0 -d sda,sdb -p /boot:ext3:1024M,/:ext4:all -i /root/images/Debian-1101-bullseye-amd64-base.tar.gz`所以这个命令写的有问题吗</span><br></pre></td></tr></table></figure><p>答：</p><p>让我们逐一检查您给出的 <code>installimage</code> 命令的参数：</p><ol><li><code>-n hostname</code>: 设置主机名为 “hostname”。</li><li><code>-a</code>: 启用自动模式。</li><li><code>-r 0</code>: 指定 RAID 类型为 RAID 0。</li><li><code>-d sda,sdb</code>: 指定两个设备 <code>/dev/sda</code> 和 <code>/dev/sdb</code> 用于 RAID 0。</li><li><code>-p /boot:ext3:1024M,/:ext4:all</code>: 分区信息，其中 <code>/boot</code> 分区使用 <code>ext3</code> 文件系统大小为 1024M，<code>/</code> 根分区使用 <code>ext4</code> 文件系统，占据所有剩余空间。</li><li><code>-i /root/images/Debian-1101-bullseye-amd64-base.tar.gz</code>: 指定安装镜像路径。</li></ol><p>从给出的使用说明中，这些参数似乎都是正确的。但有一点需要注意：</p><p>在使用 RAID 0 时，您指定了 <code>-r 0</code>，这是正确的，但根据使用说明，还需要指定 RAID 级别 <code>-l</code>。尽管在您的命令中没有明确使用 <code>-l</code>，但由于您使用了 <code>-r 0</code>，这可能意味着 RAID 0 是默认选项。然而，为了确保没有遗漏或误解，建议明确指定 RAID 级别，即添加 <code>-l 0</code>。</p><p>所以，更完整的命令可能是：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">installimage -n hostname -a -r yes -l 0 -d sda,sdb -p /boot:ext3:1024M,/:ext4:all -i /root/images/Debian-1101-bullseye-amd64-base.tar.gz</span><br></pre></td></tr></table></figure><p>但再次，这取决于 <code>installimage</code> 的具体实现和版本。上述命令应该是正确的，但在真正执行之前，建议再次检查您的具体环境和文档以确保一切正确。</p><h4 id="installimage命令不设置raid安装"><a href="#installimage命令不设置raid安装" class="headerlink" title="installimage命令不设置raid安装"></a>installimage命令不设置raid安装</h4><p>同理，如果你不想做raid，假设你有sda、sdb还有一块nvme0n1，你打算把系统装在nvme0n1上（靠谱一些），然后把sda和sdb当作存储盘之后单独挂载，你可以用诸如下面的命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">installimage -n hz -a -d nvme0n1 -p /boot:ext3:1024M,/:ext4:all -i /root/images/Debian-stable-64-minimal.tar.gz</span><br></pre></td></tr></table></figure><p>这个路径可能要根据实际情况修改一下<code>/root/images/Debian-stable-64-minimal.tar.gz</code></p><p>你可以在救援模式中输入:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls -al /root/images/</span><br></pre></td></tr></table></figure><p>查看你想要的系统版本然后替换到上面命令中。</p><p>这样你安装完之后，系统就在<code>nvme0n1</code>盘上了，另外两块硬盘需要你手动格式化并挂载。</p><h3 id="硬盘挂载"><a href="#硬盘挂载" class="headerlink" title="硬盘挂载"></a>硬盘挂载</h3><p>好的，下面是详细的步骤，描述如何为 <code>/dev/nvme1n1</code> 创建一个分区并挂载它。请注意，这些操作可能导致数据丢失，所以在开始前，请确保已备份所有重要数据。</p><p>这边以<code>nvme1n1</code>这块硬盘为例子，有可能你的是<code>/dev/sdb</code> 、<code>/dev/sda</code>  这种，其实是一样的，以此类推。</p><p>具体你的硬盘叫啥，可以登录到救援模式查看（一登录成功上方就有提示）</p><img src="https://img.laoda.de/i/2023/08/24/u1b4za-0.webp" alt="image-20230824181616538" style="zoom:50%;" /><h4 id="1-创建分区"><a href="#1-创建分区" class="headerlink" title="1. 创建分区"></a>1. 创建分区</h4><p>使用 <code>fdisk</code> 命令为 <code>/dev/nvme1n1</code> 创建一个新分区。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo fdisk /dev/nvme1n1</span><br></pre></td></tr></table></figure><p>在 <code>fdisk</code> 命令界面:</p><ol><li>输入 <code>p</code> 并回车，以查看现有分区。</li><li>输入 <code>n</code> 并回车，开始创建新分区。</li><li>选择分区类型（主分区或逻辑分区）。通常，输入 <code>p</code> 选择主分区。</li><li>选择分区号。通常情况下，默认选项应该是可以的。</li><li>为起始和结束扇区选择默认值，这将使用整个磁盘。</li><li>输入 <code>w</code> 并回车，写入分区表并退出。</li></ol><h4 id="2-格式化分区"><a href="#2-格式化分区" class="headerlink" title="2. 格式化分区"></a>2. 格式化分区</h4><p>假设你创建的分区是 <code>/dev/nvme1n1p1</code>（这取决于你之前的选择和现有分区），你可以使用以下命令将其格式化为 <code>ext4</code> 文件系统：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mkfs.ext4 /dev/nvme1n1p1</span><br></pre></td></tr></table></figure><h4 id="3-挂载分区"><a href="#3-挂载分区" class="headerlink" title="3. 挂载分区"></a>3. 挂载分区</h4><p>首先，创建一个挂载点：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> /mnt/mydrive</span><br></pre></td></tr></table></figure><p>然后，挂载新分区到这个挂载点：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mount /dev/nvme1n1p1 /mnt/mydrive</span><br></pre></td></tr></table></figure><h4 id="4-开机自动挂载"><a href="#4-开机自动挂载" class="headerlink" title="4. 开机自动挂载"></a>4. 开机自动挂载</h4><p>要使得每次开机都自动挂载这个分区，需要修改 <code>/etc/fstab</code> 文件。首先，获取 UUID：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo blkid</span><br></pre></td></tr></table></figure><p>找到 <code>/dev/nvme1n1p1</code> 的 UUID。接着，编辑 <code>/etc/fstab</code>：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/fstab</span><br></pre></td></tr></table></figure><p>在文件的底部添加以下内容（替换你的 UUID）：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UUID=你的UUID  /mnt/mydrive  ext4  defaults  0  2</span><br></pre></td></tr></table></figure><p>保存并退出。</p><p>这样，每次启动时，新分区都会自动挂载到 <code>/mnt/mydrive</code>。</p><p>以上就是创建、格式化和挂载新分区的步骤。确保每一步都仔细检查，避免任何可能的错误。</p><h4 id="合并sda和sdb（使用-LVM-将-sda-和-sdb-合并为一个逻辑卷）"><a href="#合并sda和sdb（使用-LVM-将-sda-和-sdb-合并为一个逻辑卷）" class="headerlink" title="合并sda和sdb（使用 LVM 将 sda 和 sdb 合并为一个逻辑卷）"></a>合并sda和sdb（使用 LVM 将 sda 和 sdb 合并为一个逻辑卷）</h4><p>假如想要把sda和sdb合并成一个硬盘，挂载，你可以：</p><p>问：</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">我有一块nvme0n1,还有sda，sdb，我想把系统安装在nvme0n1上，然后把sda和sdb合并成一块硬盘，用来存放文件，我是不是要定义要创建的逻辑卷？请问我应该怎么做，帮我写一个完整的安装脚本</span><br></pre></td></tr></table></figure><p>答：</p><p>为了满足您的需求，我们可以使用以下策略：</p><ol><li>将操作系统安装在 <code>nvme0n1</code> 上。</li><li>使用 LVM 将 <code>sda</code> 和 <code>sdb</code> 合并为一个逻辑卷并用于存储。</li></ol><p>以下是您可以使用的 <code>installimage</code> 命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">installimage -n hostname -a -d nvme0n1 -p /boot:ext3:1024M,/:ext4:all -i /root/images/Debian-1101-bullseye-amd64-base.tar.gz</span><br></pre></td></tr></table></figure><p>此命令将 Debian 11.01 Bullseye 安装在 <code>nvme0n1</code> 上，其中 <code>/boot</code> 使用 <code>ext3</code> 文件系统，大小为 1024M，根 <code>/</code> 使用 <code>ext4</code> 文件系统，占据所有剩余空间。</p><p>安装操作系统后，您可以使用以下步骤将 <code>sda</code> 和 <code>sdb</code> 合并为一个 LVM 逻辑卷：</p><ol><li><p>创建物理卷：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pvcreate /dev/sda</span><br><span class="line">pvcreate /dev/sdb</span><br></pre></td></tr></table></figure></li><li><p>创建一个名为 <code>myvg</code> 的卷组，其中包含 <code>sda</code> 和 <code>sdb</code>：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgcreate myvg /dev/sda /dev/sdb</span><br></pre></td></tr></table></figure></li><li><p>使用上面创建的卷组创建一个名为 <code>mylv</code> 的逻辑卷，占据所有可用空间：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lvcreate -l 100%FREE -n mylv myvg</span><br></pre></td></tr></table></figure></li><li><p>格式化逻辑卷并挂载它：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkfs.ext4 /dev/myvg/mylv</span><br><span class="line"><span class="built_in">mkdir</span> /data</span><br><span class="line">mount /dev/myvg/mylv /data</span><br></pre></td></tr></table></figure></li><li><p>为了确保每次启动时都能自动挂载，需要在 <code>/etc/fstab</code> 中添加一行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/myvg/mylv /data ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure></li></ol><p>以上步骤在操作系统安装后执行，可以将它们写入一个脚本中，然后在安装操作系统后手动运行。或者，您可以使用 <code>installimage</code> 的 <code>-x</code> 参数指定一个脚本，该脚本将在安装后自动执行上述步骤。</p><p>以下是一个脚本，名为 <code>post_install.sh</code>，用于在操作系统安装后设置和挂载逻辑卷：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建物理卷</span></span><br><span class="line">pvcreate /dev/sda</span><br><span class="line">pvcreate /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个名为 `myvg` 的卷组</span></span><br><span class="line">vgcreate myvg /dev/sda /dev/sdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用上面创建的卷组创建一个名为 `mylv` 的逻辑卷</span></span><br><span class="line">lvcreate -l 100%FREE -n mylv myvg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化逻辑卷</span></span><br><span class="line">mkfs.ext4 /dev/myvg/mylv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据目录并挂载逻辑卷</span></span><br><span class="line"><span class="built_in">mkdir</span> /data</span><br><span class="line">mount /dev/myvg/mylv /data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新 /etc/fstab 以在启动时自动挂载逻辑卷</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/dev/myvg/mylv /data ext4 defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure><p>您可以将上述脚本保存为 <code>post_install.sh</code>，然后为其赋予执行权限：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x post_install.sh</span><br></pre></td></tr></table></figure><p>然后，您可以使用以下 <code>installimage</code> 命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">installimage -n hostname -a -d nvme0n1 -p /boot:ext3:1024M,/:ext4:all -i /root/images/Debian-1101-bullseye-amd64-base.tar.gz -x /path/to/post_install.sh</span><br></pre></td></tr></table></figure><p>请确保将 <code>/path/to/</code> 替换为您保存 <code>post_install.sh</code> 脚本的实际路径。</p><p>这样，当 <code>installimage</code> 完成操作系统的安装后，它将自动运行 <code>post_install.sh</code> 脚本来设置和挂载逻辑卷。</p><h3 id="救援模式恢复密码"><a href="#救援模式恢复密码" class="headerlink" title="救援模式恢复密码"></a>救援模式恢复密码</h3><p>如果您在Hetzner使用独立服务器（Dedicated Server）并且忘记了root登录密码，您可以通过以下步骤重置密码：</p><ol><li><p><strong>登录Hetzner Robot控制面板</strong>:<br>打开浏览器，访问 <a href="https://robot.hetzner.com/">Hetzner Robot</a>，然后登录您的账户。</p></li><li><p><strong>选择您的服务器</strong>:<br>在控制面板中，找到并选择您需要重置密码的服务器。</p></li><li><p><strong>启动救援系统</strong>:<br>在服务器的管理页面上，找到“Rescue”或“救援系统”选项并启动它。Hetzner的救援系统允许您启动一个小型的Linux环境，这样您就可以访问服务器的硬盘并对其进行操作。</p></li><li><p><strong>重启服务器到救援系统</strong>:<br>一旦您启动了救援系统，需要重新启动服务器以进入该系统。您可以在Robot控制面板中找到并点击“重启”按钮。</p></li><li><p><strong>通过SSH登录到救援系统</strong>:<br>当服务器重启并运行救援系统时，您应该能够使用提供的SSH凭据（通常是root和一个临时密码）登录到服务器。</p></li><li><p><strong>挂载服务器的文件系统</strong>:<br>一旦您登录到救援系统，您需要挂载服务器的主文件系统。这通常可以通过以下命令完成（假设您的根文件系统在<code>/dev/sda1</code>上）：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sda1 /mnt</span><br></pre></td></tr></table></figure></li></ol><p>注意，如果取消挂载，试另一块硬盘的话，可以先执行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unmount /mnt</span><br></pre></td></tr></table></figure><ol start="7"><li><p><strong>重置root密码</strong>:<br>挂载文件系统后，您可以使用<code>chroot</code>命令更改root密码。如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chroot</span> /mnt</span><br><span class="line">passwd root</span><br></pre></td></tr></table></figure><p>按照提示输入新的密码。</p></li><li><p><strong>重启服务器到主系统</strong>:<br>一旦您完成了密码重置，退出chroot环境，然后从救援模式重启服务器回到主系统。您可以在Robot控制面板中完成这一步。</p></li><li><p><strong>登录并测试新密码</strong>:<br>当服务器重启并运行主系统时，尝试使用新的root密码登录。确保您可以成功登录并且所有服务都在正常运行。</p></li></ol><p>请注意，这些步骤是基于Hetzner的独立服务器的通常操作。具体的步骤可能会因Hetzner的系统更新或其他原因而有所不同。如果您遇到任何问题，建议联系Hetzner的技术支持以获得更多帮助。</p><p>输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><p>输出：</p><img src="https://img.laoda.de/i/2023/08/24/sc8bx4-0.webp" alt="image.png" style="zoom:50%;" /><p>从您提供的 <code>lsblk</code> 输出来看：</p><ul><li><code>sda</code> 磁盘只有一个分区 <code>sda1</code>，大小为 476.9G，目前已经挂载到 <code>/mnt</code>。</li><li><code>sdb</code> 磁盘有三个分区：<ul><li><code>sdb1</code> 大小为 32G</li><li><code>sdb2</code> 大小为 1G</li><li><code>sdb3</code> 大小为 443.9G</li></ul></li></ul><p>这里的关键是确定哪一个分区是您的根文件系统。考虑到 <code>sda1</code> 已经挂载到 <code>/mnt</code>，您可能已经检查了它。但我们还需要检查 <code>sdb</code> 的分区，尤其是 <code>sdb3</code>，因为它的大小与一个主要的文件系统相匹配。</p><p>下面是如何检查 <code>sdb</code> 的分区：</p><ol><li><p><strong>挂载并检查 <code>sdb1</code></strong>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sdb1 /mnt</span><br><span class="line"><span class="built_in">ls</span> /mnt</span><br></pre></td></tr></table></figure><p>如果这里有 <code>bin</code>, <code>etc</code>, <code>home</code>, <code>root</code>, <code>usr</code> 等目录，那么这可能是您的根文件系统。</p></li><li><p><strong>如果 <code>sdb1</code> 不是根文件系统，尝试挂载并检查 <code>sdb3</code></strong>:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">umount /mnt</span><br><span class="line">mount /dev/sdb3 /mnt</span><br><span class="line"><span class="built_in">ls</span> /mnt</span><br></pre></td></tr></table></figure><p>同样，查找典型的根文件系统目录。</p></li></ol><p>您提供的信息不足以确定哪个分区是引导分区或是否有单独的 <code>/home</code> 分区，但上述步骤应该可以帮助您确定哪个是根文件系统。如果您还不确定，请告诉我您在每个分区上看到的主要目录，这样我可以为您提供更多的指导。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>SunPma’Blog：<a href="https://sunpma.com/656.html">https://sunpma.com/656.html</a><br>主机会话：<a href="https://hostalk.net/posts/vps_test.html">https://hostalk.net/posts/vps_test.html</a><br><a href="https://www.openos.org/post/196/">https://www.openos.org/post/196/</a><br><a href="https://wiki.hetzner.de/index.php/Installimage/en">https://wiki.hetzner.de/index.php/Installimage/en</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;咕咕斥巨资买了一台Hetzner的独立服务器（&lt;a href=&quot;https://www.hetzner.com/sb&quot;&gt;拍卖机&lt;/a&gt;），官方售价27.7欧&amp;#x2F;月。&lt;/p&gt;
&lt;img src=&quot;https://img.laoda.de/i/2023/08/24/rc</summary>
      
    
    
    
    <category term="有用的小知识" scheme="https://blog.laoda.de/categories/%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%8F%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Hetzner" scheme="https://blog.laoda.de/tags/Hetzner/"/>
    
    <category term="服务器测评" scheme="https://blog.laoda.de/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%84/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】Umami替代品，又一款网站流量统计工具——Plausible</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-plausible/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-plausible/</id>
    <published>2023-08-13T04:37:21.000Z</published>
    <updated>2023-10-30T05:39:16.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>之前和大家介绍过一款精美的网站流量统计工具——<a href="https://blog.laoda.de/archives/umami/index.html">Umami</a></p><p><img src="https://img.laoda.de/i/2023/08/08/qhd3n3-0.webp"></p><p>最近，Umami爆出一个严重的安全漏洞（某位小伙伴在博客评论区提醒我的，感谢），</p><p><img src="https://img.laoda.de/i/2023/08/08/qhefts-0.webp" alt="4ce9d75b54d9ead867e1b5ea75f95fe2.png"></p><p>分享的网站数据链接可能会导致的你的网站统计数据被重置。</p><p>这个对个人来说还好，毕竟没多少访问量，但是对于小型团队，尤其是要做数据分析的（同比、环比）的用户来说，还是比较讨厌的。（希望社区的维护人员应该在尽力解决这个问题了。）</p><p>这一期，我们就趁着机会，来介绍另一个流量统计的项目——Plausible。</p><blockquote><p>Plausible Analytics 是一个简单、开源、轻量级（&lt; 1 KB）且注重隐私的 Google Analytics 替代品。Plausible 被超过10,000个付费订阅用户信任，用于提供他们网站和业务洞察力。我们完全独立、自筹资金并自给自足。</p></blockquote><p>来自<a href="https://plausible.io/docs">官方Docs</a></p><p><img src="https://img.laoda.de/i/2023/08/08/qhh4c5-0.webp" alt="f7d8459c33258f930f7b4fa230448ef8.png"></p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p><img src="https://img.laoda.de/i/2023/08/08/qhipan-0.webp" alt="62fead07032a298c61a3cb14f0300e4e.png"></p><p><img src="https://img.laoda.de/i/2023/08/08/qhsh9z-0.webp" alt="af05ea78d49628ae5e95ef7aa4fa0141.png"></p><p><img src="https://img.laoda.de/i/2023/08/08/qhtise-0.webp" alt="bcdabf1f64a40e3b128c36ba822978aa.png"></p><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li>支持docker一键部署，轻量级Docker镜像（使用Alpine Linux）</li><li>支持谷歌API，链接谷歌分析、谷歌关键词工具</li><li>支持自定义事件</li><li>颜值高</li></ul><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>咕咕的Demo：<a href="https://plausible.laoda.de/share/blog.laoda.de?auth=hUyCbI97k9n5qouBij3N7">本站流量情况</a><br>GitHub官方仓库：<a href="https://github.com/plausible/analytics">https://github.com/plausible/analytics</a><br>官方文档地址：<a href="https://plausible.io/docs">https://plausible.io/docs</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：<del>腾讯香港轻量应用服务器 24 元 &#x2F; 月 VPS 一台</del> 咕咕自己搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择 <a href="https://gao.ee/lca">莱卡云 美国CN2 GIA</a> 的服务器，（莱卡云服务器介绍：<a href="https://blog.laoda.de/archives/vps-lcayun/">点击查看</a>）或者<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：内存建议1G以上</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/U0tXcsqVSMo">https://youtu.be/U0tXcsqVSMo</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1Hh4y1Q7tH/">https://www.bilibili.com/video/BV1Hh4y1Q7tH/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/plausible</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/plausible</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/plausible/hosting</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> hosting</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>以下是咕咕修改的，可以看看有啥不一样（具体见视频）</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bytemark/smtp</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">plausible_db:</span></span><br><span class="line">    <span class="comment"># supported versions are 12, 13, and 14</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:14-alpine</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./db-data:/var/lib/postgresql/data</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">POSTGRES_PASSWORD=postgres</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">plausible_events_db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">clickhouse/clickhouse-server:23.3.7.5-alpine</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./event-data:/var/lib/clickhouse</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./clickhouse/clickhouse-config.xml:/etc/clickhouse-server/config.d/logging.xml:ro</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./clickhouse/clickhouse-user-config.xml:/etc/clickhouse-server/users.d/logging.xml:ro</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">nofile:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">262144</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">262144</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">plausible:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">plausible/analytics:v2.0</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&quot;sleep 10 &amp;&amp; /entrypoint.sh db createdb &amp;&amp; /entrypoint.sh db migrate &amp;&amp; /entrypoint.sh run&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">plausible_db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">plausible_events_db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mail</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8090</span><span class="string">:8000</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">plausible-conf.env</span></span><br></pre></td></tr></table></figure><p>大家可以用默认的设置，也可以和咕咕一样修改一下，修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl rand -<span class="built_in">base64</span> 64 | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> ; <span class="built_in">echo</span></span><br></pre></td></tr></table></figure><p>保存下来。</p><p>打开环境配置文件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim plausible-conf.env</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BASE_URL=填你打算给plausible准备的域名，比如https://analytics.baidu.com</span><br><span class="line">SECRET_KEY_BASE=填刚刚生成的那个密钥</span><br></pre></td></tr></table></figure><p>修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><p>更多参数配置，请看文档：<a href="https://plausible.io/docs/self-hosting-configuration">https://plausible.io/docs/self-hosting-configuration</a></p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8090</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>图中示例填的是 <code>5230</code>，备注填的是 <code>memos</code>，这边我们填 <code>8090</code>，示例填 <code>plausible</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2022/08/19/o4byqz-2.webp" alt="image-20220819145844555" style="zoom: 25%;" /><p>查看端口是否被占用（以 <code>8090</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8090  <span class="comment">#查看 8090 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>理论上我们就可以输入 <code>http://ip:8090</code> 访问了。</p><blockquote><p><strong>注意：</strong></p><p>1、不知道服务器 IP，可以直接在命令行输入：<code>curl ip.sb</code>，会显示当前服务器的 IP。</p><p>2、遇到访问不了的情况，请再次检查在宝塔面板的防火墙和服务商的后台防火墙是否打开对应了端口。</p></blockquote><p>一般情况下，我们都需要给网页加上https！让网页更安全！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><p>我们要用域名而不是IP+端口的方式来访问我们的服务！</p><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2022/05/02/kfes4s_7.webp" alt="image-20220502123517401" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/05/27/lvep5w-0.webp" alt="image-20230527132253249" style="zoom: 33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8090</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 plausible 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>plausible</code> 所在的服务器 IP 就行。</p><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><p>再次打开，勾选这些：</p><img src="https://img.laoda.de/i/2022/10/16/n7nn6e-2.webp" alt="image-20221016140356324" style="zoom:50%;" /><p>然后就可以用域名来安装访问了。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8090/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>建议参考视频，或者结合官方文档食用：<a href="https://plausible.io/docs">https://plausible.io/docs</a></p><h3 id="8-1-登录"><a href="#8-1-登录" class="headerlink" title="8.1 登录"></a>8.1 登录</h3><p>输入域名，登录Plausible</p><p><img src="https://img.laoda.de/i/2023/08/08/qhx308-0.webp" alt="c3fea4fa25e9ee495bdb3c6395ff0519.png"></p><h3 id="8-2-填写需要统计的网站的名称"><a href="#8-2-填写需要统计的网站的名称" class="headerlink" title="8.2 填写需要统计的网站的名称"></a>8.2 填写需要统计的网站的名称</h3><p><img src="https://img.laoda.de/i/2023/08/08/qhycg6-0.webp" alt="d7aff08aa538238172bc5ad6de2186b5.png"></p><h3 id="8-3-获取统计代码"><a href="#8-3-获取统计代码" class="headerlink" title="8.3 获取统计代码"></a>8.3 获取统计代码</h3><p><img src="https://img.laoda.de/i/2023/08/08/qi00em-0.webp" alt="8e4030aabf1d1548446f1bd8f4f2b38c.png"></p><p>将这串js代码放到网站的<code>&lt;head&gt;&lt;/head&gt;</code>之间就行。</p><p>比如Hexo博客（以<a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a>主题为例子）：</p><p><img src="https://img.laoda.de/i/2023/08/08/qi1l4m-0.webp" alt="e51d8f5b49a4691a154abb5f565bb1ff.png"></p><p>Halo博客（以<a href="https://blog.laoda.de/archives/docker-compose-install-halo-version-2/">Halo 2.0</a>为例子）：</p><img src="https://img.laoda.de/i/2023/08/08/qi46fo-0.webp" alt="be1e31f92a0c393d793ca39209a15c36.png" style="zoom: 33%;" /><p>WordPress博客（以<a href="https://gao.ee/justnews">JustNews</a>主题为例子）：</p><img src="https://img.laoda.de/i/2023/08/08/qie8hb-0.webp" alt="b5341063d3728312825a8b3b1bb3b6cd.png" style="zoom:33%;" /><h3 id="8-4-查看统计数据"><a href="#8-4-查看统计数据" class="headerlink" title="8.4 查看统计数据"></a>8.4 查看统计数据</h3><p>没什么问题的话，访问一下你的网站，很快这边就能显示数据啦。</p><img src="https://img.laoda.de/i/2023/08/08/qifvmh-0.webp" alt="c3b71dbd83f26694dc82e8121269c8c3.png" style="zoom:33%;" /><p>更高级的功能，比如如何连接谷歌统计等等，请结合官方文档食用：<a href="https://plausible.io/docs">https://plausible.io/docs</a></p><h3 id="8-5-更新-plausible"><a href="#8-5-更新-plausible" class="headerlink" title="8.5 更新 plausible"></a>8.5 更新 plausible</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/plausible</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -r /root/data/docker_data/plausible /root/data/docker_data/plausible.archive  <span class="comment"># 万事先备份，以防万一</span></span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line">docker image prune  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-6-卸载-plausible"><a href="#8-6-卸载-plausible" class="headerlink" title="8.6 卸载 plausible"></a>8.6 卸载 plausible</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/plausible</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/plausible  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><p>如果不想让别人注册你的plausible，可以选择关闭注册功能，或者开启邀请注册，具体操作如下：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/plausible/hosting</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim plausible-conf.env</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DISABLE_REGISTRATION=invite_only</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DISABLE_REGISTRATION=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>完整的env配置如下：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BASE_URL=填你打算给plausible准备的域名，比如https://analytics.baidu.com</span><br><span class="line">SECRET_KEY_BASE=填刚刚生成的那个密钥</span><br><span class="line">DISABLE_REGISTRATION=invite_only</span><br></pre></td></tr></table></figure><p>更多参数配置，请看文档：<a href="https://plausible.io/docs/self-hosting-configuration">https://plausible.io/docs/self-hosting-configuration</a></p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/plausible/analytics/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/plausible/analytics">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/plausible/analytics">https://github.com/plausible/analytics</a><br>官方文档地址：<a href="https://plausible.io/docs">https://plausible.io/docs</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;之前和大家介绍过一款精美的网站流量统计工具——&lt;a href=&quot;https://blog.laoda.de/archives</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="Umami" scheme="https://blog.laoda.de/tags/Umami/"/>
    
    <category term="谷歌统计" scheme="https://blog.laoda.de/tags/%E8%B0%B7%E6%AD%8C%E7%BB%9F%E8%AE%A1/"/>
    
    <category term="百度统计" scheme="https://blog.laoda.de/tags/%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1/"/>
    
    <category term="网站统计" scheme="https://blog.laoda.de/tags/%E7%BD%91%E7%AB%99%E7%BB%9F%E8%AE%A1/"/>
    
    <category term="流量统计" scheme="https://blog.laoda.de/tags/%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>免费12个月使用！体验AWS——目前世界上最大的云服务器提供商家！（含DD教程）</title>
    <link href="https://blog.laoda.de/archives/aws-free/"/>
    <id>https://blog.laoda.de/archives/aws-free/</id>
    <published>2023-08-03T13:55:12.000Z</published>
    <updated>2023-08-03T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><p>更新了文末使用注意事项。</p><p>更新了EC2 每个月可以用100G流量的说明。</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p><img src="https://img.laoda.de/i/2023/08/03/dy68sc-0.webp" alt="54f5c741679d226ad992c348d6bcca2e.png"></p><p>几乎每个大厂都可以免费体验一定时长的云服务，比如GCP、Azure，甲骨文甚至还有可以永久免费的服务器。</p><p><img src="https://img.laoda.de/i/2023/08/03/dzsptl-0.webp" alt="33bb560749fb4dc108fd22aa7efe27e3.png"></p><p>这一期，我们就来免费体验一下世界上最大的云服务器提供商——亚马逊的云服务 (<a href="https://gao.ee/aws">AWS</a>)</p><p><img src="https://img.laoda.de/i/2023/08/03/dyi6b7-0.webp" alt="a6008202f607ebee921a0e39d19cd8d6.png"></p><blockquote><p>世界上最大的云服务器提供商是亚马逊网络服务 (AWS)。AWS 是一家全球性云计算平台，提供计算、存储、数据库、网络、分析、机器学习、人工智能、移动、开发工具和企业应用等多种服务。AWS 在全球拥有超过 200 个区域和 70 多个国家&#x2F;地区的数据中心。</p><p>2022 年，AWS 的收入为 540.5 亿美元，比 2021 年增长了 37%。AWS 是世界上最受欢迎的云计算平台，拥有超过 300 万客户。AWS 的客户包括小型企业、中型企业和大型企业，以及政府机构和非营利组织。</p><p>AWS 的优势包括：</p><p>广泛的服务：AWS 提供广泛的服务，满足企业的各种需求。<br>可靠性：AWS 拥有全球最可靠的数据中心网络。<br>安全性：AWS 提供最先进的安全功能。<br>成本效益：AWS 的价格非常合理。</p></blockquote><p>来源：bard.google.com</p><p><a href="https://gao.ee/aws">AWS</a>其实可以免费<del>白嫖</del>体验很多产品，比如云服务器（ec2），云存储（S3），CDN相关产品（网站提速），lightsail（VPS,搭建远程桌面）SES (群发邮件)，Amazon Chime （视频会议）等等等等，大家可以随意尝试。</p><p>这边我们玩服务器多一些，就来白嫖12个月的EC2吧。</p><p><img src="https://img.laoda.de/i/2023/07/19/10w0lwk-0.webp" alt="74853af64cc16c50f361471e346b97ba.png"></p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>AWS 免费体验地址：<a href="https://gao.ee/aws">https://gao.ee/aws</a></p><p>正式开始之前，建议你准备：</p><ul><li>一个邮箱</li><li>一个可以接受验证码的手机号（大家可以用自己的手机号接受验证码，正常国内的能收到码，也可以可以选择GV或者是到<a href="https://5sim.net/zh">5sim.net</a>上找接码，看是最低6卢布（大概5毛钱）一条）</li><li>一张信用卡（只是授权一下，并不会要你钱，可以是虚拟卡，比如咕咕用的<a href="https://blog.laoda.de/archives/onekey-card-tutorial">OneKey Card</a>）</li><li>注册账号的时候不要挂代理</li></ul><h2 id="开始注册"><a href="#开始注册" class="headerlink" title="开始注册"></a>开始注册</h2><p>点击创建<a href="https://gao.ee/aws">AWS账户</a>，一步一步完成注册即可，地址填拼音。</p><p>具体可以看视频。</p><p>YouTube视频地址：<a href="https://youtu.be/r6Mr5tBCnvc">https://youtu.be/r6Mr5tBCnvc</a></p><p>bilibili视频地址：<a href="https://www.bilibili.com/video/BV1VP411t7ia/">https://www.bilibili.com/video/BV1VP411t7ia/</a></p><img src="https://img.laoda.de/i/2023/07/19/10wadak-0.webp" alt="b16ce8b66a52d72e800af237395260e4.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10wbyp2-0.webp" alt="634cfafb4f2c40764ae6a21fa62f61ed.png" style="zoom:33%;" /><p>没什么问题的话，你会看到这个界面。</p><p><img src="https://img.laoda.de/i/2023/07/19/10wd9bi-0.webp" alt="d0ee6d255c695ffd6ac1b83c17fd3828.png"></p><p>信用卡验证预扣款截图：</p><p><img src="https://img.laoda.de/i/2023/07/19/10weg2q-0.webp" alt="517e9a1ec1a10e77e29c553d273b5a61.png"></p><h2 id="AWS后台概览"><a href="#AWS后台概览" class="headerlink" title="AWS后台概览"></a>AWS后台概览</h2><p>选择服务器地区：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wflzn-0.webp" alt="2c17a641badf9ab13cacc453ca4e1b65.png"></p><p>创建实例：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wgygv-0.webp" alt="1f331693624de7d3afb6c74212e785b9.png"></p><p>输入名称：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wiapn-0.webp" alt="6cfd3d5ecad6d7a995d653d6d2f23c48.png"></p><p>选择系统：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wkpgg-0.webp" alt="a8e3e0ba03287d2dbfb0676de8778316.png"></p><p>打开<code>22</code>、<code>80</code>、<code>443</code>端口：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wlpkr-0.webp" alt="9f49cf1bf1bd666895b1f4b56e6b57fe.png"></p><p>修改硬盘大小：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wvluk-0.webp" alt="1d90fc5f95ec2db36bbce5438f4703ba.png"> </p><p>启动实例失败，需要我们创建一个密钥对：</p><p><img src="https://img.laoda.de/i/2023/07/19/10wwvdi-0.webp" alt="de088cbcc6a9fd7008bef38acb241a5e.png"></p><img src="https://img.laoda.de/i/2023/07/19/10wybtd-0.webp" alt="b1067d9e84116a9eacf9ea05e4ea2ad3.png" style="zoom:33%;" /><p>再次启动实例：</p><img src="https://img.laoda.de/i/2023/07/19/10x04g2-0.webp" alt="a37dbccb9e3c3338ca3e036509a0e79f.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10x1vtf-0.webp" alt="e3767553bf2908ccc8dcf8bb86e41eec.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10x3gyw-0.webp" alt="df8ede3760eee791cf9fa7ca22974e98.png" style="zoom:33%;" /><p>连接服务器：</p><img src="https://img.laoda.de/i/2023/07/19/10x54lb-0.webp" alt="8370b0de6fdba51d82a7d5201b89fe20.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10x6if8-0.webp" alt="9754a9c6fab6875769d9229495dd5481.png" style="zoom:33%;" /><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 400 密钥地址</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -i 密钥位置 admin@ip</span><br></pre></td></tr></table></figure><p>即可登录。</p><img src="https://img.laoda.de/i/2023/07/19/10x88my-0.webp" alt="d1a5f5fb28805e4c0cb7faa98c09f5c0.png" style="zoom:33%;" /><h2 id="DD一个干净的Debian-11"><a href="#DD一个干净的Debian-11" class="headerlink" title="DD一个干净的Debian 11"></a>DD一个干净的Debian 11</h2><p>默认的登录方式其实是最安全的，但是对我们来说难免太不方便了，我们希望可以随时随地用密钥登录，这边我们就来完全重装一下这台机器的系统吧。</p><p>dd 脚本（大概5-10分钟）</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash &lt;(wget --no-check-certificate -qO- <span class="string">&#x27;https://raw.githubusercontent.com/MoeClub/Note/master/InstallNET.sh&#x27;</span>) -d 11 -v 64 -p <span class="string">&quot;自定义root密码&quot;</span> -port <span class="string">&quot;自定义ssh端口&quot;</span></span><br></pre></td></tr></table></figure><p>这边我的dd脚本是这样的：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash &lt;(wget --no-check-certificate -qO- <span class="string">&#x27;https://raw.githubusercontent.com/MoeClub/Note/master/InstallNET.sh&#x27;</span>) -d 11 -v 64 -p <span class="string">&quot;password123&quot;</span> -port <span class="string">&quot;222&quot;</span></span><br></pre></td></tr></table></figure><p>我把密码改成了<code>password123</code>，SSH端口改成了<code>222</code></p><p>直接输入到命令行即可。</p><h2 id="AWS-开启后台端口的方法"><a href="#AWS-开启后台端口的方法" class="headerlink" title="AWS 开启后台端口的方法"></a>AWS 开启后台端口的方法</h2><p>默认我们的这台机器只开了22端口（我们视频里也勾选了80、443端口）</p><p>所以现在总共只打开了三个端口，我们还需要开启<code>222</code>端口，不然一会儿SSH连接不上。</p><p>这边我们尝试开启<code>222</code>端口。</p><img src="https://img.laoda.de/i/2023/07/19/10xityv-0.webp" alt="aa27bc877189bfa406ed75f1735b4338.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xk07i-0.webp" alt="144f461d39264ba6c24b52b745431063.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xlhrf-0.webp" alt="49ec2f94666cef05c6c7528b55482c7a.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xmzmx-0.webp" alt="078eac72fa962f787e6d4c2db2601b33.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xoe1m-0.webp" alt="123a36565da4b5ee0513e2a4d16d8841.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xpxss-0.webp" alt="2fae84dc62654a8a2420eb26dca2d8dc.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/07/19/10xr52a-0.webp" alt="940357987a82d82f77554bcbdd3e3060.png" style="zoom:33%;" /><p>开启之后，我们尝试登录机器。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh root@ip -p 222</span><br></pre></td></tr></table></figure><p>成功登录！</p><img src="https://img.laoda.de/i/2023/07/19/10xslee-0.webp" alt="0472055b9aa4ee416dd36d594dda8f02.png" style="zoom:33%;" /><p>好了，现在你就有一台干净系统的机器啦，下一期我们介绍一下如何在这个机器上装一个好玩儿的Docker项目，在这个免费使用的12个月里面好好折腾它！</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>服务器免费政策是每月750小时，也就是说如果只开一个Instance，一个月最多只能开31天(744个小时)。如果起了好几个Instance，你就面临付款的风险了。</li><li>Instance计时是以小时做单位，如果你一个小时之内start &#x2F;stop 5次服务器的话，你会被记5个小时。</li><li>服务器使用过程中流量，I&#x2F;O次数等等很多信息都有免费的上限，一般个人学习实验是够的，如果乱用，也有需要付款的风险。</li><li>免费期是12个月，12月之内一定要终止你使用的AWS服务，否则会被计费。</li><li>不清楚的情况下，不要乱点其他服务，不然被收费了都不知道为什么</li><li>如果是自己的信用卡，记得给信用卡锁一下每日额度，避免不小心被乱扣费</li></ul><p>感谢<a href="https://www.jianshu.com/p/acc8b52b3c4f">@JamFF</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;更新记录&quot;&gt;&lt;a href=&quot;#更新记录&quot; class=&quot;headerlink&quot; title=&quot;更新记录&quot;&gt;&lt;/a&gt;更新记录&lt;/h2&gt;&lt;p&gt;更新了文末使用注意事项。&lt;/p&gt;
&lt;p&gt;更新了EC2 每个月可以用100G流量的说明。&lt;/p&gt;
&lt;h2 id=&quot;正文&quot;&gt;&lt;a</summary>
      
    
    
    
    <category term="VPS推荐" scheme="https://blog.laoda.de/categories/VPS%E6%8E%A8%E8%8D%90/"/>
    
    
    <category term="AWS" scheme="https://blog.laoda.de/tags/AWS/"/>
    
    <category term="亚马逊云服务" scheme="https://blog.laoda.de/tags/%E4%BA%9A%E9%A9%AC%E9%80%8A%E4%BA%91%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="EC2" scheme="https://blog.laoda.de/tags/EC2/"/>
    
    <category term="免费服务器" scheme="https://blog.laoda.de/tags/%E5%85%8D%E8%B4%B9%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="新加坡服务器" scheme="https://blog.laoda.de/tags/%E6%96%B0%E5%8A%A0%E5%9D%A1%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="亚太服务器" scheme="https://blog.laoda.de/tags/%E4%BA%9A%E5%A4%AA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="低延迟" scheme="https://blog.laoda.de/tags/%E4%BD%8E%E5%BB%B6%E8%BF%9F/"/>
    
    <category term="DD新系统" scheme="https://blog.laoda.de/tags/DD%E6%96%B0%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】80、90回忆杀，10分钟搭建复古中文 DOS 游戏，最多畅玩1898款！</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-chinese-dos-games/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-chinese-dos-games/</id>
    <published>2023-07-24T13:36:56.000Z</published>
    <updated>2023-07-24T15:23:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>小学的时候，班上有几个同学家里比较富裕，爸爸妈妈给他们买了步步高电子词典，本来是学习的工具，但是有一天发现可以下载游戏，于是学习机就变成了游戏机。</p><p>我当时没有这个机器，只能看着他们玩，还记得又一次把作业给同学抄，然后借他的步步高玩了金庸群侠传，非常上头。后来还玩了伏魔记、魔塔……</p><p>一晃眼，现在都工作好多年了……</p><p>今天就让我们重温一下儿时的游戏吧。</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p><img src="https://img.laoda.de/i/2023/07/22/10tjkvw-0.webp" alt="2d2152aefff4cd3ac04ecb2ecb40e274.png"></p><p><img src="https://img.laoda.de/i/2023/07/22/10tl4tg-0.webp" alt="0883c841c73871b1341edfd1e2599c3f.png"></p><p><img src="https://img.laoda.de/i/2023/07/22/10u0cnp-0.webp" alt="fb998df7fa96a7b4f8cdc8cf76faf7c8.png"></p><p><img src="https://img.laoda.de/i/2023/07/22/10u1g9d-0.webp" alt="7ea1d4f1b4afddf85ccf03e96fb99f3f.png"></p><p><img src="https://img.laoda.de/i/2023/07/22/10u2shj-0.webp" alt="b22232140b0564a01e554112536644dd.png"></p><img src="https://img.laoda.de/i/2023/07/22/118uku3-0.webp" alt="image-20230722225209477" style="zoom: 50%;" /><img src="https://img.laoda.de/i/2023/07/22/11931dd-0.webp" alt="image-20230722225248152" style="zoom:50%;" /><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li>支持docker一键部署</li><li>中文 DOS 游戏合集，目前共有 1898 款游戏</li><li>支持存档</li></ul><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>咕咕的Demo：<a href="https://games.gugu.ovh/">https://games.gugu.ovh/</a><br>GitHub官方仓库：<a href="https://github.com/rwv/chinese-dos-games">https://github.com/rwv/chinese-dos-games</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：<del>腾讯香港轻量应用服务器 24 元 &#x2F; 月 VPS 一台</del> 咕咕自己搭建用的是香港的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（这次最好选带宽比较大的，而且线路还不错的机器）如果是小白刚开始玩的话，可以选择<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：带宽最好大一些，硬盘能大一些也最好，1898 款游戏大概36G，需要手动下载一下。</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/B_tZLDbBN0I">https://youtu.be/B_tZLDbBN0I</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1nc411w7JD/">https://www.bilibili.com/video/BV1nc411w7JD/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/games</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><p>这边有两种搭建方式，因为36G的游戏做成docker的镜像太大了，所以作者只是将40多个经典的DOS游戏封装到了docker的镜像里面，所以你的服务器如果硬盘不够大，可以直接用默认的方式安装。</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">dosgame-web-docker:</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">dosgame</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;8090:262&#x27;</span>  <span class="comment">#8090可以改成其他服务器没被占用的端口</span></span><br><span class="line"><span class="comment">#         volumes:</span></span><br><span class="line"><span class="comment">#             - &#x27;/root/data/docker_data/games/chinese-dos-games:/app/static/games&#x27;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&#x27;oldiy/dosgame-web-docker:latest&#x27;</span></span><br></pre></td></tr></table></figure><p>修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><p>如果你的服务器硬盘大于36G，那你可以尝试直接装1989款游戏。</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">dosgame-web-docker:</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">dosgame</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;8090:262&#x27;</span>  <span class="comment">#8090可以改成其他服务器没被占用的端口</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;/root/data/docker_data/games/chinese-dos-games:/app/static/games&#x27;</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&#x27;oldiy/dosgame-web-docker:latest&#x27;</span></span><br></pre></td></tr></table></figure><p>修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><p>然后在</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games/</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/rwv/chinese-dos-games.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> chinese-dos-games/</span><br><span class="line"></span><br><span class="line">python3 download_data.py</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://img.laoda.de/i/2023/07/24/s4abll-0.webp" alt="image-20230724170023076"></p><p>注意这边下载默认是下载1989款游戏的，总共36G左右，如果你的服务器的下载带宽不大的话，可能需要非常非常久。这也是这边推荐大家用海外的服务器的原因，带宽普遍较大，比如<a href="https://blog.laoda.de/vps/">Racknerd</a>（注意选美西地区），下载是G口的速度，理论值在128M&#x2F;s，下载起来相对较快。</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: git: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>输入:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt update -y</span><br><span class="line">apt install git -y</span><br></pre></td></tr></table></figure><p>再重新运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/rwv/chinese-dos-games.git</span><br></pre></td></tr></table></figure><p>即可。</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: python: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>说明电脑上没装python，你需要装一个</p><p>这边还是以Debian系统为例：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install python3</span><br><span class="line"></span><br><span class="line">python3 download_data.py</span><br></pre></td></tr></table></figure><p>即可。</p><p>如果你担心SSH断开，或者你不想一直等着，想让它后台慢慢下载，可以试试咕咕之前分享过的Screen的使用方法：<a href="https://blog.laoda.de/archives/how-to-use-linux-screen/">Linux 实用工具 Screen —— 再也不怕因为网络连接中断杀死任务了！</a></p><p>下载完成之后，你可以运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /root/data/docker_data/games/chinese-dos-games/bin | grep <span class="string">&quot;^-&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><p>查看文件夹中的文件数量。不出意外应该显示<code>1898</code></p><p>你也可以用：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh /root/data/docker_data/games</span><br></pre></td></tr></table></figure><p>计算文件夹的总大小，不出意外应该显示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">36G /root/data/docker_data/games</span><br></pre></td></tr></table></figure><p>没什么问题的话，我们可以运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games</span><br><span class="line"></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/root/data/docker_data/games</span><br><span class="line"></span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p>取决于你的docker compose的版本，新的是没有<code>-</code>的</p><p>等待拉取镜像即可。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>如果你是阿里云、腾讯云、甲骨文、azure等大厂的机器，可能需要打开防火墙的端口 <code>8090</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>图中示例填的是 <code>5230</code>，备注填的是 <code>memos</code>，这边我们填 <code>8090</code>，示例填 <code>games</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2022/08/19/o4byqz-2.webp" alt="image-20220819145844555" style="zoom: 25%;" /><p>查看端口是否被占用（以 <code>8090</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8090  <span class="comment">#查看 8090 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>最后：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games    <span class="comment"># 来到 dockercompose 文件所在的文件夹下</span></span><br><span class="line"></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure><p>理论上，等出现绿色的<code>done</code>字样，</p><p>我们就可以输入 <code>http://ip:8090</code> 访问了。</p><blockquote><p><strong>注意：</strong></p><p>1、不知道服务器 IP，可以直接在命令行输入：<code>curl ip.sb</code>，会显示当前服务器的 IP。</p><p>2、遇到访问不了的情况，请再次检查在宝塔面板的防火墙和服务商的后台防火墙是否打开对应了端口。</p></blockquote><p>不过现在我们还是用IP+端口的方式访问的，不够优雅，一般情况下，我们都需要给网页加上https！让网页更安全！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>gugugege</code> 来获得 1 美元的优惠（失效的话可以评论区反馈一下～）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><p>我们要用域名而不是IP+端口的方式来访问我们的服务！</p><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2022/05/02/kfes4s_7.webp" alt="image-20220502123517401" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/05/27/lvep5w-0.webp" alt="image-20230527132253249" style="zoom: 33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8090</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 games 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>games</code> 所在的服务器 IP 就行。</p><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><p>再次打开，勾选这些：</p><img src="https://img.laoda.de/i/2022/10/16/n7nn6e-2.webp" alt="image-20221016140356324" style="zoom:50%;" /><p>然后就可以用域名来安装访问了。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8090/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>参考视频。</p><h3 id="8-1-更新-games"><a href="#8-1-更新-games" class="headerlink" title="8.1 更新 games"></a>8.1 更新 games</h3><p>一般应该不需要怎么更新，作者停更很久了，不过这边还是提供一下docker-compose安装的应用的基本更新方法。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -r /root/data/docker_data/games /root/data/docker_data/games.archive  <span class="comment"># 万事先备份，以防万一</span></span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line">docker image prune  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-games"><a href="#8-2-卸载-games" class="headerlink" title="8.2 卸载 games"></a>8.2 卸载 games</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/games</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/games  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><ul><li><p>部分游戏没有按键说明，可能需要自己在键盘尝试一下，一般就是<code>shift</code>、<code>alt</code>、<code>enter</code>、<code>空格</code>、<code>command</code>、<code>z</code>、<code>x</code>这几个键，大家自己试试看。</p></li><li><p>部分游戏可能有bug，大家可以<a href="https://github.com/rwv/chinese-dos-games/issues">反馈一下</a>。</p></li></ul><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/rwv/chinese-dos-games/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/rwv/chinese-dos-games/">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/rwv/chinese-dos-games/">https://github.com/rwv/chinese-dos-games/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;小学的时候，班上有几个同学家里比较富裕，爸爸妈妈给他们买了步步高电子词典，本来是学习的工具，但是有一天发现可以下载游戏，于是</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="DockerCompose" scheme="https://blog.laoda.de/tags/DockerCompose/"/>
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="DOS 游戏" scheme="https://blog.laoda.de/tags/DOS-%E6%B8%B8%E6%88%8F/"/>
    
    <category term="复古游戏" scheme="https://blog.laoda.de/tags/%E5%A4%8D%E5%8F%A4%E6%B8%B8%E6%88%8F/"/>
    
  </entry>
  
  <entry>
    <title>【好玩儿的Docker项目】5分钟搭建一个又小又快的文本、代码粘贴工具—— Hasty Paste</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-hasty-paste/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-hasty-paste/</id>
    <published>2023-07-18T10:28:03.000Z</published>
    <updated>2023-07-19T05:05:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>Hasty Paste 是一个快速粘贴文本并共享的地方，主要用于共享调试日志等，以帮助开发人员提供技术支持。该项目的目标是既快又小。</p><p>之前介绍过的类似项目：<a href="https://blog.laoda.de/archives/docker-compose-install-microbin/">【好玩儿的 Docker 项目】10 分钟搭建一个巨好用的粘贴板工具 ——MicroBin</a></p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><p><img src="https://img.laoda.de/i/2023/07/18/x2x1rn-0.webp" alt="361535150c7231d1b5defa5005cbd426.png"></p><p><img src="https://img.laoda.de/i/2023/07/18/x2vsm9-0.webp" alt="43c0d6c3ba13d306e53029e874caca1a.png"></p><p><img src="https://img.laoda.de/i/2023/07/18/x2usc3-0.webp" alt="7479c1257d5e50aec04b7e900d7b48cd.png"></p><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li>支持docker一键部署，轻量级Docker镜像（使用Alpine Linux）</li><li>支持快速粘贴和保存，分享一些文本</li><li>公开访问，无需身份验证</li><li>随机生成的ID，可选择使用“长”ID以减少暴力攻击</li><li>支持添加过期时间</li><li>支持深色主题</li><li>可选语法高亮显示</li><li>不需要JavaScript</li><li>REST API接口</li><li>支持S3对象存储</li><li>支持缓存（内部和Redis）</li></ul><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>咕咕的Demo：<a href="https://paste-test.gugu.ovh/">https://paste-test.gugu.ovh/</a><br>GitHub官方仓库：<a href="https://github.com/enchant97/hasty-paste">https://github.com/enchant97/hasty-paste</a><br>官方文档地址：<a href="https://enchantedcode.co.uk/hasty-paste/">https://enchantedcode.co.uk/hasty-paste/</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：<del>腾讯香港轻量应用服务器 24 元 &#x2F; 月 VPS 一台</del> 咕咕自己搭建用的是硅谷的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（这次最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择 <a href="https://gao.ee/lca">莱卡云 美国CN2 GIA</a> 的服务器，（莱卡云服务器介绍：<a href="https://blog.laoda.de/archives/vps-lcayun/">点击查看</a>）或者<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：内存建议1G，能安装Docker即可～</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/R35imcsDfDo">https://youtu.be/R35imcsDfDo</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV12V411N7M1/">https://www.bilibili.com/video/BV12V411N7M1/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://blog.laoda.de/archives/nginxproxymanager/">https://blog.laoda.de/archives/nginxproxymanager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/hastypaste</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/hastypaste</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">paste-bin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ghcr.io/enchant97/hasty-paste:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hasty-paste</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8090</span><span class="string">:8000</span> <span class="comment"># 左边的8090可以自行修改成服务器上没有使用的端口</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/app/data</span></span><br></pre></td></tr></table></figure><p>修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8090</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>图中示例填的是 <code>5230</code>，备注填的是 <code>memos</code>，这边我们填 <code>8090</code>，示例填 <code>hastypaste</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2022/08/19/o4byqz-2.webp" alt="image-20220819145844555" style="zoom: 25%;" /><p>查看端口是否被占用（以 <code>8090</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8090  <span class="comment">#查看 8090 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>最后：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/hastypaste    <span class="comment"># 来到 dockercompose 文件所在的文件夹下</span></span><br><span class="line"></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 777 data</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>理论上我们就可以输入 <code>http://ip:8090</code> 访问了。</p><blockquote><p><strong>注意：</strong></p><p>1、不知道服务器 IP，可以直接在命令行输入：<code>curl ip.sb</code>，会显示当前服务器的 IP。</p><p>2、遇到访问不了的情况，请再次检查在宝塔面板的防火墙和服务商的后台防火墙是否打开对应了端口。</p></blockquote><p>一般情况下，我们都需要给网页加上https！让网页更安全！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://blog.laoda.de/archives/namesilo/">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><p>我们要用域名而不是IP+端口的方式来访问我们的服务！</p><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2022/05/02/kfes4s_7.webp" alt="image-20220502123517401" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/05/27/lvep5w-0.webp" alt="image-20230527132253249" style="zoom: 33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8090</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 hastypaste 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>hastypaste</code> 所在的服务器 IP 就行。</p><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><p>再次打开，勾选这些：</p><img src="https://img.laoda.de/i/2022/10/16/n7nn6e-2.webp" alt="image-20221016140356324" style="zoom:50%;" /><p>然后就可以用域名来安装访问了。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8090/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>参考视频，或者官方文档：<a href="https://enchantedcode.co.uk/hasty-paste/install.html">https://enchantedcode.co.uk/hasty-paste/install.html</a></p><h3 id="8-1-更新-hastypaste"><a href="#8-1-更新-hastypaste" class="headerlink" title="8.1 更新 hastypaste"></a>8.1 更新 hastypaste</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/hastypaste</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -r /root/data/docker_data/hastypaste /root/data/docker_data/hastypaste.archive  <span class="comment"># 万事先备份，以防万一</span></span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line">docker image prune  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-hastypaste"><a href="#8-2-卸载-hastypaste" class="headerlink" title="8.2 卸载 hastypaste"></a>8.2 卸载 hastypaste</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/hastypaste</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/hastypaste  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><p>暂未发现</p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/enchant97/hasty-paste/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/enchant97/hasty-paste/">项目</a> 中来，贡献自己的一份力量！</p><blockquote><p>目前这个项目非常需要维护人员，欢迎小伙伴贡献自己的力量。</p></blockquote><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/enchant97/hasty-paste">https://github.com/enchant97/hasty-paste</a><br>官方文档地址：<a href="https://enchantedcode.co.uk/hasty-paste/">https://enchantedcode.co.uk/hasty-paste/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;Hasty Paste 是一个快速粘贴文本并共享的地方，主要用于共享调试日志等，以帮助开发人员提供技术支持。该项目的目标是既</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="DockerCompose" scheme="https://blog.laoda.de/tags/DockerCompose/"/>
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="paste" scheme="https://blog.laoda.de/tags/paste/"/>
    
  </entry>
  
  <entry>
    <title>Hexo博客Butterfly主题配置记录（附简单聊一下之前博客的问题）</title>
    <link href="https://blog.laoda.de/archives/hexo-butterfly-config/"/>
    <id>https://blog.laoda.de/archives/hexo-butterfly-config/</id>
    <published>2023-07-15T00:54:55.000Z</published>
    <updated>2023-07-15T03:02:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简单聊一下之前博客的问题"><a href="#简单聊一下之前博客的问题" class="headerlink" title="简单聊一下之前博客的问题"></a>简单聊一下之前博客的问题</h2><p>博客前段时间不确定是DNS解析的问题还是被攻击了，导致无法访问。（期间更换了高防服务器依旧无果，只要用<code>blog.laoda.de</code>或者<code>iwanlab.com</code>一反代，源站服务器CPU立马飙升到100%，不管是OVH还是HZ，但是换别的域名反代源站CPU占用一直保持在3-5%的水平）</p><p><img src="https://img.laoda.de/i/2023/07/12/12dg711-0.webp"></p><p>通过top查看是java的进程占用过多（机器上架设了halo，是基于Java的）</p><p><img src="https://img.laoda.de/i/2023/07/12/12ruyhd-0.webp"></p><p>但是我有其他服务器也搭建了halo的博客，那个基本只有20-60%的占用</p><p><img src="https://img.laoda.de/i/2023/07/12/12sttd0-0.webp"></p><p>折腾了好久，做了以下尝试，均没有效果：</p><p>1、利用hetzner的备份功能，直接找一台新的服务器部署，然后反代（还是用瓦工，同一个域名），源站服务器CPU在反代之前一直是0-5%占用，一旦反代，飙升到200%（2核心的）</p><p>2、 直接换反代服务器（换成了斯巴达，同一个域名），效果同上，没反代之前是cpu低占用，一旦反代，直接飙满；</p><p>3、停用Wordpress，重新用docker部署另一个halo博客，用同一个域名，依旧如上，换了一个域名之后，恢复正常。</p><p>猜想会不会是这个域名的问题，于是我用了 <a href="http://www.aaa.com/">www.aaa.com</a> 依旧采用源站+反代的模式，正常了，cpu在5%左右。</p><p>然后我把aaa.com 301重定向到了 <a href="http://www.aaa.com/">www.aaa.com</a> 今天一天正常，结果刚刚，源站服务器cpu又爆了</p><p>心力交瘁，于是就想索性换到无后台的静态博客Hexo吧，正好以前也弄过，有经验，这样后台没有数据处理，应该就没问题了。</p><blockquote><p>想不到折腾了近三年，还是回到了Hexo &#x3D; &#x3D;</p></blockquote><p>又用上了当时折腾博客一眼相中的Butterfly主题（当时记得只有300+ star，现在已经是5K+了）</p><p>因为Hexo没有后台，很多东西需要自己手动来配置一下的，期间有些内容也是网上搜索得到的答案，为了防止遗忘，咕咕这边特别记录一下一些我认为的重点，同时也给想要使用Hexo博客的新手小伙伴一些参考吧。</p><h2 id="Hexo博客配置记录"><a href="#Hexo博客配置记录" class="headerlink" title="Hexo博客配置记录"></a>Hexo博客配置记录</h2><h3 id="将Hexo博客自动部署到服务器"><a href="#将Hexo博客自动部署到服务器" class="headerlink" title="将Hexo博客自动部署到服务器"></a>将Hexo博客自动部署到服务器</h3><p>下面的很多内容网上都能找到各种解决方案，这边先把网上没有的，咕咕自己折腾的分享给大家。</p><p>之前用Hexo博客，最大的痛点就是：<strong>我怎么样才能一键把我本地生成的博客推送到我的服务器上？</strong></p><blockquote><p>其实可以推送到GitHub，但是GitHub访问比较慢，很多地区的联通宽带甚至无法访问，咕咕这边有<a href="https://bwh81.net/aff.php?aff=67086&pid=87">搬瓦工</a>的<a href="https://blog.laoda.de/archives/vps-route/">三网CN2 GIA</a>的服务器，国内访问速度很不错，所以想着部署在搬瓦工上，给国内不管是使用移动、联通还是电信宽带的小伙伴们都能提供一个良好的访问体验。</p></blockquote><p>其实，在现在的博客里有一个方法：<a href="https://blog.laoda.de/archives/hexo-building/">将 Hexo 部署到阿里云轻量服务器（保姆级教程）</a> （这个是转载的当时一位大佬的博客，大概是3年前，当时自己跟着一步一步做成功了，也很激动。）</p><p>但是这个方法说实话配置起来还是比较复杂的。</p><p>有没有简单一点的方法呢？</p><p>突然想到，现在不是有<a href="https://blog.laoda.de/archives/chatgpt-plus-depay/">ChatGPT</a>吗？之前一直不会写脚本，现在把需求给ChatGPT，让它帮忙写一个自动部署脚本不就行了？</p><p>于是有了下面要介绍的这个脚本。</p><p>先说一下我的环境与目的：</p><ul><li><a href="https://bwh81.net/aff.php?aff=67086&pid=87">搬瓦工服务器</a>一台，IP：<code>173.242.118.113</code> SSH端口:<code>3451</code> ，安装了<a href="https://blog.laoda.de/archives/nginxproxymanager/">Nginx Proxy Manager</a>（你也可以是任意的一台服务器，比如<a href="https://loll.cc/tx">腾讯云</a>、<a href="https://blog.laoda.de/vps/">Racknerd</a>等等，可以是任意系统，只要也安装上Nginx Proxy Manager即可）</li><li>本地使用MacBook Air（需要python和rsync，Windows的同学也不要慌，下面有windows的安装方法）</li><li>Hexo文件存放在<code>/Users/gugu/blog</code>，Hexo的public文件（就是我们需要上传到服务器的）路径是<code>/Users/gugu/blog/public</code></li><li>目标把本地<code>/Users/gugu/blog/public</code>的内容发送到服务器的<code>/root/data/docker_data/npm/data/blog</code></li></ul><p>直接把需求仍给ChatGPT，看看回答：</p><p>Prompt：</p><blockquote><p>我需要把本地mac电脑上，<code>/Users/gugu/blog/public</code>文件夹里面的内容，上传到服务器的<code>/root/data/docker_data/npm/data/blog</code>里，服务器的IP：<code>173.242.118.113</code> ，SSH端口：<code>3451</code> ，请帮我写一个自动化脚本。</p></blockquote><p>ChatGPT回答：</p><blockquote><p>这里是一个基本的bash脚本，使用<code>rsync</code>命令通过SSH协议上传文件，<code>rsync</code>可以保持源文件和目标文件之间的一致性，非常适合用于备份和镜像。如果<code>rsync</code>命令在你的机器上没有安装，它应该在大多数Linux发行版和MacOS上通过包管理器（如apt，yum，brew等）就可以安装。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义源路径、目标路径、服务器地址</span></span><br><span class="line">SOURCE_PATH=<span class="string">&#x27;/Users/gugu/blog/public&#x27;</span></span><br><span class="line">DEST_PATH=<span class="string">&#x27;/root/data/docker_data/npm/data/blog&#x27;</span></span><br><span class="line">SERVER_IP=<span class="string">&#x27;173.242.118.113&#x27;</span></span><br><span class="line">SSH_PORT=3451</span><br><span class="line"></span><br><span class="line"><span class="comment"># rsync命令</span></span><br><span class="line">rsync -avz -e <span class="string">&quot;ssh -p <span class="variable">$SSH_PORT</span>&quot;</span> --progress <span class="variable">$SOURCE_PATH</span> username@<span class="variable">$SERVER_IP</span>:<span class="variable">$DEST_PATH</span></span><br></pre></td></tr></table></figure><p>这个脚本使用了<code>rsync</code>的以下选项：</p><ul><li><code>-a</code>：这是”归档”模式，可以保留文件的所有属性和权限,同时递归地拷贝文件夹。</li><li><code>-v</code>：这是”详细”模式，表示输出详细信息。</li><li><code>-z</code>：使用gzip压缩数据，可以加快传输速度。</li><li><code>-e</code>：使用指定的传输命令，如ssh，并可以附带上其他选项，如 <code>-p</code>用于指定端口。</li></ul><p>在<code>rsync</code>命令的最后，你需要替换<code>username</code>为你登录目标服务器的用户名。请注意，这个脚本默认认为你已经设置了从你的Mac电脑到服务器的无密码SSH登录。如果尚未设置，你需要在运行脚本时手动输入密码，或者设置SSH密钥无密码登录。</p><p>将上述脚本保存为如<code>sync.sh</code>文件，你可以在终端中通过以下命令来运行它：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash sync.sh</span><br></pre></td></tr></table></figure><p>确保你的脚本有执行权限，如果没有，你可以使用下面的命令来给你的脚本添加执行权限：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x sync.sh</span><br></pre></td></tr></table></figure><p>然后你可以简单地通过以下命令运行脚本：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./sync.sh</span><br></pre></td></tr></table></figure></blockquote><p>注意：这边的<code>sync.sh</code>文件我们可以放在Hexo博客的根目录。</p><p>Windows安装Rsync：</p><blockquote><p>由于Windows自身并没有类似于<code>rsync</code>的命令，你需要下载和安装Cygwin，这是一个在Windows下提供类UNIX环境支持的软件，其中包含了大量GNU和开源工具，包括<code>rsync</code>。</p><p>以下是具体步骤：</p><ol><li><p>下载并安装Cygwin:</p><ul><li>访问Cygwin的官方网站（<a href="https://www.cygwin.com/%EF%BC%89%E5%B9%B6%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F%E3%80%82">https://www.cygwin.com/）并下载安装程序。</a></li><li>运行下载的<code>setup-x86.exe</code>（32位系统）或<code>setup-x86_64.exe</code>（64位系统）文件。</li><li>在Cygwin Setup的包选择界面，输入<code>rsync</code>在搜索框中，然后在搜索结果中找到对应的<code>rsync</code>包，在SpinBox中将Skip更改为对应的版本，点击下一步完成安装。</li></ul></li><li><p>设置Path环境变量:</p><ul><li>右击电脑上的“此电脑”图标或者”My Computer”，选择“属性”或者”Properties”。</li><li>在弹出界面中，选择“高级系统设置”或者”Advanced System Settings”。</li><li>在“系统属性”或者”System Properties”窗口中，点击“环境变量”或者”Environment Variables”。</li><li>在“环境变量”窗口中，系统变量栏找到Path，点击编辑或者”Edit”，在变量值的末尾添加<code>;C:\cygwin64\bin</code>（64位系统，32位系统则添加<code>;C:\cygwin\bin</code>），点击“确定”或者”OK”。</li></ul></li><li><p>测试<code>rsync</code>是否安装成功:</p><ul><li>打开命令提示符（CMD）或者Powershell，输入<code>rsync --version</code>并按回车。</li><li>如果显示rsync的版本信息，那么rsync已经安装成功。</li></ul></li></ol><p>注意：安装Cygwin时可能需要管理员权限。同时也请注意保证Cygwin软件包的完整性和安全性，以免引入恶意软件。</p></blockquote><p>Windows安装python：</p><blockquote><p>在Windows上安装Python的步骤如下：</p><ol><li><p>访问Python的官方网站： <a href="https://www.python.org/">https://www.python.org/</a></p></li><li><p>鼠标悬停在顶部菜单栏的“Downloads”选项上，它会显示最新版本的Python供你下载。如果你需要安装其他版本的Python，可以点击“Downloads”选项进入下载页面，查看并选择你需要的版本。</p></li><li><p>点击下载Python对应版本的安装器，通常你应该选择64位安装包，除非你知道自己的电脑是32位的。文件应为”python-x.x.x-amd64.exe”格式，其中”x.x.x”代表Python的版本。</p></li><li><p>运行下载的安装程序，选择“Customize installation”，然后点击“Next”。</p></li><li><p>在下一个页面，可以看到一个“Add Python to PATH”选项，记得勾选它。这样可以使得Python在你的系统路径（PATH环境变量）中，这样你就可以在命令提示符（cmd）中直接运行Python。接下来点击”Install Now”开始安装。</p></li><li><p>安装完成后，点击“Close”。</p></li><li><p>验证Python是否正确安装：打开命令提示符（cmd），然后输入<code>python --version</code>，如果正确输出了Python的版本号，那么Python就安装成功了。</p></li></ol><p>注意：介于权限问题，你可能需要管理员权限来完成Python的安装。</p></blockquote><p>我们当然是想着能偷懒就偷懒，不输入密码，于是接着提问：</p><p>Prompt：</p><blockquote><p>如何安装rsync? 我本地是mac电脑，服务器是Debian11，另外如何配置无密码访问？</p></blockquote><p>ChatGPT回答：</p><blockquote><p><strong>在Mac上安装rsync：</strong></p><p>Mac系统通常预装了rsync，你可以通过输入以下命令在终端检查rsync是否已经安装：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync --version</span><br></pre></td></tr></table></figure><p>如果rsync已经安装，这个命令会显示其版本号。如果rsync没有安装，你需要通过brew来安装。</p><p>首先，如果你还没有安装brew，你需要安装它。在终端执行以下命令：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure><p>然后，你可以使用brew安装rsync：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install rsync</span><br></pre></td></tr></table></figure><p><strong>在Debian11服务器上安装rsync：</strong></p><p>在Debian系统上，你可以使用apt来安装rsync。运行以下命令安装rsync：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install rsync</span><br></pre></td></tr></table></figure><p><strong>配置SSH密钥无密码访问：</strong></p><p>无密码登录的设置基于SSH公私钥对的认证。基本的步骤如下：</p><ol><li><p>在本地Mac上生成SSH公私钥对。在终端中输入以下命令：</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p> 然后按提示操作。默认情况下，公私钥对会被保存在<code>~/.ssh/id_rsa.pub</code>（公钥）和<code>~/.ssh/id_rsa</code>（私钥）。如果需要，你可以在生成时设置一个密码，但是如果你想实现无密码登录，这里就不要设置密码。</p></li><li><p>将生成的公钥复制到服务器上。在终端输入以下命令：</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub -p 3451 username@173.242.118.113</span><br></pre></td></tr></table></figure><p> 这里需要将<code>username</code>替换为你的用户名。这个命令会将你的公钥添加到服务器上的<code>~/.ssh/authorized_keys</code>文件中，这样服务器就可以识别你的本地机器了。</p></li><li><p>测试无密码登录。你可以尝试ssh登录服务器：</p> <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh -p 3451 username@173.242.118.113</span><br></pre></td></tr></table></figure><p> 如果一切顺利，你应该能够不输入密码就登录服务器了。</p></li></ol></blockquote><p>注意：这边的brew的安装，由于网络原因，用ChatGPT提供的方法可能装不上，可以尝试用这个方法：[M1 芯片 Mac 上 Homebrew 安装](M1 芯片 Mac 上 Homebrew 安装)   或者直接看作者的GitHub：<a href="https://github.com/ineo6/homebrew-install">https://github.com/ineo6/homebrew-install</a></p><p>好了，接下来我们到服务器上操作一下。</p><p>其实关于如何在把静态网站部署在NPM上，咕咕也有过分享：<a href="https://blog.laoda.de/archives/host-static-sites-on-npm/">如何在 Nginx Proxy Manager（NPM）上部署静态网站</a></p><p>直接看这篇就行了。</p><p>注意只要新建一个文件夹：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/npm/data/blog</span><br></pre></td></tr></table></figure><p>然后参考上面文章，把<code>/data/demo10.gao.ee</code>改成<code>/data/blog</code>就行。</p><p>好了，可以来测试一下了！</p><p>以后写好文章之后发布，就只需要三步：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line">hexo g</span><br><span class="line"></span><br><span class="line">./sync.sh</span><br></pre></td></tr></table></figure><p>很舒服了，而且文章什么的都保存在你的本地，也比较有安全感。（当然你可以选择把这个也上传到服务器里，双保险）</p><blockquote><p>以下为咕咕在Hexo Butterfly主题下安装的插件，不过理论上是Hexo博客都可用的。</p><p>注意以下插件均到Hexo根目录安装。</p></blockquote><h3 id="Hexo-Butterfly文章置顶插件"><a href="#Hexo-Butterfly文章置顶插件" class="headerlink" title="Hexo Butterfly文章置顶插件"></a>Hexo Butterfly文章置顶插件</h3><p>卸载<code>hexo-generator-index</code>，然后安装<code>hexo-generator-index-pin-top</code></p><p>注意到Hexo根目录安装。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-generator-index --save</span><br><span class="line">npm install hexo-generator-index-pin-top --save</span><br></pre></td></tr></table></figure><p>使用方法：</p><p>在需要置顶的文章的Front-matter中加上top: true&#x2F;数字即可，数字越大，文章越靠前。</p><p>例如</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cover: </span><br><span class="line">top: 1 <span class="comment">#这里加一个top就行</span></span><br><span class="line">abbrlink: 1d543</span><br><span class="line"><span class="built_in">date</span>: 2023-07-15 10:32:05</span><br></pre></td></tr></table></figure><h3 id="Hexo-Butterfly-sitemap插件"><a href="#Hexo-Butterfly-sitemap插件" class="headerlink" title="Hexo Butterfly sitemap插件"></a>Hexo Butterfly sitemap插件</h3><p>站点地图即 <a href="https://baike.baidu.com/item/sitemap/6241567?fr=aladdin">sitemap</a>， 是一个页面，上面放置了网站上需要搜索引擎抓取的所有页面的链接。站点地图可以告诉搜索引擎网站上有哪些可供抓取的网页，以便搜索引擎可以更加智能地抓取网站。所以我们首先需要生成一个站点地图。</p><p>安装 Google 的站点地图生成插件：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>然后来到 Hexo 根目录配置文件 <code>config.yml</code>，在下面添加：</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 站点地图</span></span><br><span class="line"><span class="attr">sitemap:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">sitemap.xml</span></span><br></pre></td></tr></table></figure><p>然后重新推送到服务器，访问如下 URL:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://你的域名/sitemap.xml</span><br></pre></td></tr></table></figure><p>看看网页中有没有出现代码。有的话就成功。</p><p>比如咕咕的sitemap就是：<a href="https://blog.laoda.de/sitemap.xml">https://blog.laoda.de/sitemap.xml</a></p><p>参考：<a href="https://qmike.top/posts/2a1b5a62">https://qmike.top/posts/2a1b5a62</a></p><h3 id="Hexo-Butterfly-RSS插件"><a href="#Hexo-Butterfly-RSS插件" class="headerlink" title="Hexo Butterfly RSS插件"></a>Hexo Butterfly RSS插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure><p>在hexo的主配置文件<code>_config.yml</code>中任意位置添加以下代码：</p><p><img src="https://img.laoda.de/i/2023/07/15/h2lp1b-0.webp" alt="image-20230715103228334"></p><p>比如咕咕的RSS：<a href="https://blog.laoda.de/atom.xml">https://blog.laoda.de/atom.xml</a></p><p>参考：<a href="https://www.cnblogs.com/MoYu-zc/p/14395965.html">https://www.cnblogs.com/MoYu-zc/p/14395965.html</a></p><h3 id="Hexo-Butterfly-本地搜索插件"><a href="#Hexo-Butterfly-本地搜索插件" class="headerlink" title="Hexo Butterfly 本地搜索插件"></a>Hexo Butterfly 本地搜索插件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure><p>同时修改主题配置文件：</p><p><img src="https://img.laoda.de/i/2023/07/15/h1cmwc-0.webp" alt="image-20230715103018077"></p><h3 id="持续更新中"><a href="#持续更新中" class="headerlink" title="持续更新中"></a>持续更新中</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;简单聊一下之前博客的问题&quot;&gt;&lt;a href=&quot;#简单聊一下之前博客的问题&quot; class=&quot;headerlink&quot; title=&quot;简单聊一下之前博客的问题&quot;&gt;&lt;/a&gt;简单聊一下之前博客的问题&lt;/h2&gt;&lt;p&gt;博客前段时间不确定是DNS解析的问题还是被攻击了，导致无法访</summary>
      
    
    
    
    <category term="网站搭建" scheme="https://blog.laoda.de/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="Hexo" scheme="https://blog.laoda.de/tags/Hexo/"/>
    
    <category term="Butterfly" scheme="https://blog.laoda.de/tags/Butterfly/"/>
    
    <category term="ChatGPT" scheme="https://blog.laoda.de/tags/ChatGPT/"/>
    
  </entry>
  
  <entry>
    <title>开箱即用！一款注重隐私、安全可控的IOS自定义通知推送工具——Bark，配合Uptime Kuma搭建网站监控！</title>
    <link href="https://blog.laoda.de/archives/docker-compose-install-bark/"/>
    <id>https://blog.laoda.de/archives/docker-compose-install-bark/</id>
    <published>2023-07-11T07:18:17.000Z</published>
    <updated>2023-07-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>免费、简单、安全，开箱即用！</p><h2 id="2-项目展示"><a href="#2-项目展示" class="headerlink" title="2. 项目展示"></a>2. 项目展示</h2><p>直接丢几个图：</p><img src="https://img.laoda.de/i/2023/06/26/skv0ci-0.webp" alt="IMG_8A07D54D57DD-1.jpeg" style="zoom:25%;" /><h3 id="2-1-特点"><a href="#2-1-特点" class="headerlink" title="2.1 特点"></a>2.1 特点</h3><ul><li>免费、轻量！简单调用接口即可给自己的iPhone发送推送。</li><li>依赖苹果APNs，及时、稳定、可靠</li><li>不会消耗设备的电量， 基于系统推送服务与推送扩展，APP本体并不需要运行。</li><li>隐私安全，可以通过一些方式确保包含作者本人在内的所有人都无法窃取你的隐私。点击详细了解如何保障<a href="https://bark.day.app/#/privacy">隐私安全</a></li></ul><h2 id="3-相关地址"><a href="#3-相关地址" class="headerlink" title="3. 相关地址"></a>3. 相关地址</h2><p>GitHub官方仓库：<a href="https://github.com/Finb/bark-server">https://github.com/Finb/bark-server</a><br>官方文档地址：<a href="https://bark.day.app/">https://bark.day.app/</a><br>作者博客：<a href="https://day.app/2018/06/bark-server-document/">https://day.app/2018/06/bark-server-document/</a></p><h2 id="4-搭建环境"><a href="#4-搭建环境" class="headerlink" title="4. 搭建环境"></a>4. 搭建环境</h2><ul><li>服务器：<del>腾讯香港轻量应用服务器 24 元 &#x2F; 月 VPS 一台</del> 咕咕自己搭建用的是硅谷的<a href="https://loll.cc/tx">腾讯轻量应用服务器</a> ，（这次最好选 非大陆的，而且线路还不错的机器）如果是小白刚开始玩的话，也可以选择 <a href="https://gao.ee/lca">莱卡云 美国CN2 GIA</a> 的服务器，（莱卡云服务器介绍：<a href="https://blog.laoda.de/archives/vps-lcayun/">点击查看</a>）或者<a href="https://blog.laoda.de/vps/">Racknerd</a>的高性价比服务器（注意地区选美国西部城市的）</li><li>系统：Debian 11 （<a href="https://blog.laoda.de/archives/useful-script/">DD 脚本</a> 非必需 DD，用原来的系统也 OK，之后教程都是用 Debian 或者 Ubuntu 搭建～）</li><li>安装好 Docker、Docker-compose（<a href="https://blog.laoda.de/archives/hello-docker/">相关脚本</a>）</li><li>【非必需但建议】域名一枚，并做好解析到服务器上（<a href="https://blog.laoda.de/archives/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</li><li>【非必需】提前安装好宝塔面板海外版本 aapanel，并安装好 Nginx（<a href="https://forum.aapanel.com/d/9-aapanel-linux-panel-6812-installation-tutorial">安装地址</a>）</li><li>【非必需本教程选用】安装好 Nginx Proxy Manager（<a href="https://blog.laoda.de/archives/nginxproxymanager/">相关教程</a>）</li></ul><blockquote><p>服务器要求：内存建议1G，能安装Docker即可～</p></blockquote><h2 id="5-搭建视频"><a href="#5-搭建视频" class="headerlink" title="5. 搭建视频"></a>5. 搭建视频</h2><h3 id="5-1-YouTube"><a href="#5-1-YouTube" class="headerlink" title="5.1 YouTube"></a>5.1 YouTube</h3><p>视频地址：<a href="https://youtu.be/Pfrla3su_Js">https://youtu.be/Pfrla3su_Js</a></p><h3 id="5-2-哔哩哔哩"><a href="#5-2-哔哩哔哩" class="headerlink" title="5.2 哔哩哔哩"></a>5.2 哔哩哔哩</h3><p>哔哩哔哩：<a href="https://www.bilibili.com/video/BV1qP411e7Qm/">https://www.bilibili.com/video/BV1qP411e7Qm/</a></p><h2 id="6-搭建方式"><a href="#6-搭建方式" class="headerlink" title="6. 搭建方式"></a>6. 搭建方式</h2><p>如果你不是用的腾讯云的轻量应用服务器，可以直接跳到 6.1 部分。</p><h3 id="安装系统（腾讯云轻量应用服务器）"><a href="#安装系统（腾讯云轻量应用服务器）" class="headerlink" title="安装系统（腾讯云轻量应用服务器）"></a>安装系统（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlyhcz-2.webp" alt="e59713fba8726d3cb55ae11bca83fe3c.png" style="zoom:33%;" /><p>腾讯云轻量服务器最大的特点就是 “轻量”，相比 CVM，更适合小白上手，这边我们之间选择 Docker 基础镜像，就可以省去后面安装 Docker 的步骤 <del>（如果你非要用国内的服务器，这边装的 Docker 镜像还会帮你配置好国内镜像源，让你加速访问 docker 镜像资源）</del> 不建议用国内的 。</p><h3 id="登陆（腾讯云轻量应用服务器）"><a href="#登陆（腾讯云轻量应用服务器）" class="headerlink" title="登陆（腾讯云轻量应用服务器）"></a>登陆（腾讯云轻量应用服务器）</h3><img src="https://img.laoda.de/i/2022/08/16/zlzlj7-2.webp" alt="2722040ee311eb4a9ebf2a4945bf38f4.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm0gv8-2.webp" alt="c0b5d360053746c4095d592967ee401f.png" style="zoom:25%;" /><img src="https://img.laoda.de/i/2022/08/16/zm1vqw-2.webp" alt="e0ba858f021b846ad0abc27acf5008c2.png" style="zoom:25%;" /><h3 id="6-1-安装-Docker-与-Nginx-Proxy-Manager"><a href="#6-1-安装-Docker-与-Nginx-Proxy-Manager" class="headerlink" title="6.1 安装 Docker 与 Nginx Proxy Manager"></a>6.1 安装 Docker 与 Nginx Proxy Manager</h3><p>可以直接参考这篇内容：</p><p><a href="https://iwanlab.com/nginx-proxy-manager/">https://iwanlab.com/nginx-proxy-manager/</a></p><h3 id="6-2-创建安装目录"><a href="#6-2-创建安装目录" class="headerlink" title="6.2 创建安装目录"></a>6.2 创建安装目录</h3><p>创建一下安装的目录：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -i</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /root/data/docker_data/bark</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /root/data/docker_data/bark</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><p>英文输入法下，按 <code>i</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">bark-server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">finab/bark-server</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">bark-server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8090:8080&quot;</span>  <span class="comment"># 左边的8090可以自行修改成服务器上没有使用的端口</span></span><br></pre></td></tr></table></figure><p>修改好之后，注意切换成英文输入法，然后按一下 <code>esc</code>，然后 <code>:wq</code> 保存退出。</p><h3 id="6-3-打开服务器防火墙（非必需）并访问网页"><a href="#6-3-打开服务器防火墙（非必需）并访问网页" class="headerlink" title="6.3 打开服务器防火墙（非必需）并访问网页"></a>6.3 打开服务器防火墙（非必需）并访问网页</h3><p>打开防火墙的端口 <code>8090</code></p><p>举例，腾讯云打开方法如下（部分服务商没有自带的面板防火墙，就不用这步操作了）：</p><img src="https://img.laoda.de/i/2022/06/30/zlio5h-2.webp" alt="image-20220630215240864" style="zoom: 25%;" /><img src="https://img.laoda.de/i/2022/06/30/10h3dqt-2.webp" alt="image-20220630220546335" style="zoom: 25%;" /><p>图中示例填的是 <code>5230</code>，备注填的是 <code>memos</code>，这边我们填 <code>8090</code>，示例填 <code>bark</code> ，确定即可（如果你在 docker-compose 文件里换了 <code>9009</code>，这边就需要填 <code>9009</code>，以此类推）</p><img src="https://img.laoda.de/i/2022/08/19/o4byqz-2.webp" alt="image-20220819145844555" style="zoom: 25%;" /><p>查看端口是否被占用（以 <code>8090</code> 为例），输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i:8090  <span class="comment">#查看 8090 端口是否被占用，如果被占用，重新自定义一个端口</span></span><br></pre></td></tr></table></figure><p>如果啥也没出现，表示端口未被占用，我们可以继续下面的操作了～</p><p>如果出现：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-bash: lsof: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>运行：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt install lsof  <span class="comment">#安装 lsof</span></span><br></pre></td></tr></table></figure><p>如果端口没有被占用（被占用了就修改一下端口，比如改成 <code>8081</code>，注意 docker 命令行里和防火墙都要改）</p><p>最后：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/bark    <span class="comment"># 来到 dockercompose 文件所在的文件夹下</span></span><br><span class="line"></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure><p>理论上我们就可以输入 <code>http://ip:8090/ping</code> 访问了。</p><blockquote><p><strong>注意：</strong></p><p>1、不知道服务器 IP，可以直接在命令行输入：<code>curl ip.sb</code>，会显示当前服务器的 IP。</p><p>2、遇到访问不了的情况，请再次检查在宝塔面板的防火墙和服务商的后台防火墙是否打开对应了端口。</p></blockquote><img src="https://img.laoda.de/i/2023/06/26/slfwwq-0.webp" alt="5c6c9207637033970fd9f0c2c502aaa8.png" style="zoom: 33%;" /><p>出现<code>code:200</code>代表安装成功！</p><p>因为这个涉及到个人消息的，所以非常需要https！会让网页更安全！</p><p> <a href="https://loll.cc/ns">namesilo</a> 上面 xyz 后缀的域名一年就 7 块钱，可以年抛。（冷知识，namesilo上 6位数字的xyz续费永远都是0.99美元 &#x3D; &#x3D;）</p><p>如果想要长期使用，还是建议买 com 后缀的域名，更加正规一些，可以输入 <code>laodade</code> 来获得 1 美元的优惠（不知道现在还有没有）</p><p><a href="https://loll.cc/ns">namesilo</a> 自带隐私保护，咕咕一直在用这家，价格也是这些注册商里面比较低的，关键是他家不像其他家域名注册商，没有七七八八的套路！（就是后台界面有些<del>丑</del> 古老 &#x3D; &#x3D;）</p><p><a href="https://iwanlab.com/namesilo">【域名购买】Namesilo 优惠码和域名解析教程（附带服务器购买推荐和注意事项）</a></p><p>我们接着往下看！</p><h2 id="7-反向代理"><a href="#7-反向代理" class="headerlink" title="7. 反向代理"></a>7. 反向代理</h2><p>我们要用域名而不是IP+端口的方式来访问我们的服务！</p><h3 id="7-1-利用-Nginx-Proxy-Manager"><a href="#7-1-利用-Nginx-Proxy-Manager" class="headerlink" title="7.1 利用 Nginx Proxy Manager"></a>7.1 利用 Nginx Proxy Manager</h3><p>在添加反向代理之前，确保你已经完成了域名解析，不会的可以看这个：<strong>域名一枚，并做好解析到服务器上</strong>（<a href="https://iwanlab.com/namesilo/">域名购买、域名解析</a> <a href="https://www.bilibili.com/video/BV1Sy4y1k7kZ/">视频教程</a>）</p><img src="https://img.laoda.de/i/2022/10/16/n6t02e-2.webp" alt="image-20221016140213282" style="zoom:33%;" /><p>之后，登陆 Nginx Proxy Manager（不会的看这个：<strong>安装 Nginx Proxy Manager</strong>（<a href="https://iwanlab.com/nginx-proxy-manager/">相关教程</a>））</p><blockquote><p><strong>注意：</strong></p><p>Nginx Proxy Manager（以下简称 NPM）会用到 <code>80</code>、<code>443</code> 端口，所以本机不能占用（比如原来就有 Nginx）</p></blockquote><p>直接丢几张图：</p><img src="https://img.laoda.de/i/2022/05/02/kfes4s_7.webp" alt="image-20220502123517401" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2023/05/27/lvep5w-0.webp" alt="image-20230527132253249" style="zoom: 33%;" /><blockquote><p>注意填写对应的 <code>域名</code>、<code>IP</code> 和 <code>端口</code>，按文章来的话，应该是 <code>8090</code></p></blockquote><p><strong>IP 填写：</strong></p><p>如果 Nginx Proxy Manager 和 bark 在同一台服务器上，可以在终端输入：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr show docker0</span><br></pre></td></tr></table></figure><p>查看对应的 Docker 容器内部 IP。</p><img src="https://img.laoda.de/i/2022/09/29/pcdnz5-2.webp" style="zoom:50%;" /><p>否则直接填 <code>bark</code> 所在的服务器 IP 就行。</p><img src="https://img.laoda.de/i/2022/04/03/h9azjx_7.webp" alt="image-20220403104353185" style="zoom: 33%;" /><p>再次打开，勾选这些：</p><img src="https://img.laoda.de/i/2022/10/16/n7nn6e-2.webp" alt="image-20221016140356324" style="zoom:50%;" /><p>然后就可以用域名来安装访问了。</p><h3 id="7-2-利用宝塔面板"><a href="#7-2-利用宝塔面板" class="headerlink" title="7.2 利用宝塔面板"></a>7.2 利用宝塔面板</h3><p>发现还是有不少小伙伴习惯用宝塔面板，这边也贴一个宝塔面板的反代配置：</p><p>直接新建一个站点，不要数据库，不要 php，纯静态即可。</p><p>然后打开下面的配置，修改 Nginx 的配置。</p><img src="https://img.laoda.de/i/2022/08/19/ov4xrt-2.webp" alt="image-20220819150345725" style="zoom: 33%;" /><img src="https://img.laoda.de/i/2022/08/19/owbbkb-2.webp" alt="image-20220819150542867" style="zoom: 33%;" /><p>代码如下：</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> http://127.0.0.1:8090/;       <span class="comment"># 注意改成你实际使用的端口</span></span><br><span class="line">  <span class="attribute">rewrite</span><span class="regexp"> ^/(.*)$</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">  <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> Upgrade-Insecure-Requests <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">proxy_set_header</span> X-Forwarded-Proto https;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法对 90% 的反向代理都能生效，然后就可以用域名来安装访问了。</p><p>有同学可能会问，为什么不直接用宝塔自带的反向代理功能。</p><img src="https://img.laoda.de/i/2022/08/19/oxf800-2.webp" alt="image-20220819150730128" style="zoom: 33%;" /><p>也可以，不过咕咕自己之前遇到过当有多个网站需要反代的时候，在这边设置会报错的情况 &#x3D; &#x3D;</p><p>所以后来就不用了，直接用上面的方法来操作了。</p><h2 id="8-使用教程"><a href="#8-使用教程" class="headerlink" title="8. 使用教程"></a>8. 使用教程</h2><p>参考视频，或者官方文档：<a href="https://bark.day.app/#/tutorial">https://bark.day.app/#/tutorial</a></p><h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><p>在 <code>APP Store</code> 里找到 <code>Bark</code></p><p>打开 <code>APP</code>，默认指向了官方服务器 <code>api.day.app</code>，需要点右上角的 <code>+</code> 号来添加我们前面搭建的私有服务器：</p><img src="https://img.laoda.de/i/2023/06/26/sln5b0-0.webp" alt="c4a53736051c675cbff711ffeb5ec91a.png" style="zoom:33%;" /><p>在 <code>APP</code>端填入你的服务器 <code>IP</code>或域名：</p><img src="https://img.laoda.de/i/2023/06/26/sm4ws5-0.webp" alt="4feba2a8cd724a158f94c99a6c74bd59.png" style="zoom: 25%;" /><p>添加成功之后，要 <code>允许</code> 发消息通知：</p><img src="https://img.laoda.de/i/2023/06/26/sm7p7s-0.webp" alt="046502e4cd8a24680cbd22a8cb02b9b1.png" style="zoom:25%;" /><p>点中间的注册设备：</p><img src="https://img.laoda.de/i/2023/06/26/sm99xv-0.webp" alt="7d1ff1a29599ecf097782e79c8e5fdfe.png" style="zoom:25%;" /><p>会显示不同内容的发送格式</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#  推送内容</span><br><span class="line">https://bark.gugu.ovh/Xy4ssdd2pARjLfFY/这里改成你自己的推送内容</span><br><span class="line"></span><br><span class="line"># 推送标题</span><br><span class="line">https://bark.gugu.ovh/Xy4ssdd2pARjLfFY/推送标题/这里改成你自己的推送内容</span><br></pre></td></tr></table></figure><img src="https://img.laoda.de/i/2023/06/26/smb7z9-0.webp" alt="53d945659fd6737f4d92e320f9168274.png" style="zoom:25%;" /><p>其中域名后面的一串字符 <code>Xy4ssdd2pARjLfFY</code> 就是用来标识设备的唯一码，别人知道这个码，然后知道你的这个域名，就可以给你推送消息了，所以注意保管好不要泄漏。</p><p>接下来你就可以用命令行、<code>API</code> 调试工具或者 <code>chrome</code>插件，来向<code>iphone</code> 发送消息</p><h3 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h3><p>Chrome插件：</p><img src="https://img.laoda.de/i/2023/06/26/smlz9c-0.webp" alt="1da8b329d0b6944511fa1fee3cb2890b.png" style="zoom:33%;" /><p>安装完成后，点浏览器上的插件图标，会弹出提示</p><p><img src="https://img.laoda.de/i/2023/06/26/smo92x-0.webp" alt="img"></p><p><code>Default Push Content</code> 是指缺省推送的内容，<code>Clipboard</code>是剪贴板中的内容，<code>Current page URL</code> 是当前打开网页的地址</p><p>找到下面的<code>New device push URL</code></p><img src="https://img.laoda.de/i/2023/06/26/sms193-0.webp" alt="img" style="zoom: 67%;" /><p>填入前面获取的地址，<code>https://bark.gugu.ovh/Xy4ssdd2pARjLfFY</code></p><blockquote><p>如果你有多台iPhone，<code>Alias</code> （别名）要填一下，用来区分不同的手机</p></blockquote><img src="https://img.laoda.de/i/2023/06/26/smuj1p-0.webp" alt="02e03b76ec16769b43e87e11f8b989a0.png" style="zoom: 33%;" /><p>在网页上选取内容后，右键找到 <code>Push To Device</code></p><img src="https://img.laoda.de/i/2023/06/26/smwwj4-0.webp" alt="405c404554edc2acd7d08560154265a3.png" style="zoom:33%;" /><p>手机端就会收到发送的消息</p><img src="https://img.laoda.de/i/2023/06/26/sn7970-0.webp" alt="9badcd63aeda2536be39ab6e09ab1e0a.png" style="zoom:25%;" /><h3 id="Uptim-Kuma使用实例"><a href="#Uptim-Kuma使用实例" class="headerlink" title="Uptim Kuma使用实例"></a>Uptim Kuma使用实例</h3><p>安装教程：<a href="https://iwanlab.com/uptimekuma-install/">【好玩的Docker项目】搭建一个专属自己的网站监控——Uptime Kuma</a></p><p>进入设置：</p><img src="https://img.laoda.de/i/2023/06/26/sn97tm-0.webp" alt="ff0682029b207137bf40dc0ad24817a6.png" style="zoom:33%;" /><p>选择Bark：</p><img src="https://img.laoda.de/i/2023/06/26/snb4ae-0.webp" alt="74b5be25747d23f7cf5cff9de1a6b465.png" style="zoom:33%;" /><p>接入点填写：</p><p><code>https://域名/设备ID</code></p><p>Bark群组这边记得填写英文：</p><img src="https://img.laoda.de/i/2023/06/26/sncw7j-0.webp" alt="53f2d32d9db9ab87dbbbb8e209b2071d.png" style="zoom:33%;" /><p>如果你填写了中文，需要把他转成浏览器可以识别的字符：</p><img src="https://img.laoda.de/i/2023/06/26/snf7iu-0.webp" alt="24b0ae4007dba9fed69761602b00cf93.png" style="zoom:33%;" /><img src="https://img.laoda.de/i/2023/06/26/snhfl3-0.webp" alt="8af6535933c9ddfe753529c10952df4d.png" style="zoom:33%;" /><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%E7%BD%91%E7%AB%99%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5</span><br></pre></td></tr></table></figure><p>否则会遇到<code>Request path contains unescaped characters </code>的错误</p><img src="https://img.laoda.de/i/2023/06/26/snjbyv-0.webp" alt="23c14183a9b7cde5a89a2eb6b9f7a226.png" style="zoom:33%;" /><p>测试成功，iPhone上会收到这样的信息：</p><img src="https://img.laoda.de/i/2023/06/26/snuwzc-0.webp" alt="IMG_11A65204D6F2-1.jpeg" style="zoom:25%;" /><h3 id="8-1-更新-bark"><a href="#8-1-更新-bark" class="headerlink" title="8.1 更新 bark"></a>8.1 更新 bark</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/bark</span><br><span class="line"></span><br><span class="line">docker-compose down </span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> -r /root/data/docker_data/bark /root/data/docker_data/bark.archive  <span class="comment"># 万事先备份，以防万一</span></span><br><span class="line"></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line">docker-compose up -d    <span class="comment"># 请不要使用 docker-compose stop 来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d 直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。</span></span><br><span class="line"></span><br><span class="line">docker image prune  <span class="comment"># prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像</span></span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WARNING! This will remove all dangling images.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] </span><br></pre></td></tr></table></figure><p>输入 <code>y</code></p><p>利用 Docker 搭建的应用，更新非常容易～</p><h3 id="8-2-卸载-bark"><a href="#8-2-卸载-bark" class="headerlink" title="8.2 卸载 bark"></a>8.2 卸载 bark</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/data/docker_data/bark</span><br><span class="line"></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /root/data/docker_data/bark  <span class="comment"># 完全删除映射到本地的数据</span></span><br></pre></td></tr></table></figure><p>可以卸载得很干净。</p><h2 id="9-常见问题"><a href="#9-常见问题" class="headerlink" title="9. 常见问题"></a>9. 常见问题</h2><p>参考官方FAQ：<a href="https://bark.day.app/#/faq">https://bark.day.app/#/faq</a></p><h2 id="10-结尾"><a href="#10-结尾" class="headerlink" title="10. 结尾"></a>10. 结尾</h2><p>祝大家用得开心，有问题可以去 GitHub 提 <a href="https://github.com/Finb/bark-server/issues">Issues</a>，也可以在评论区互相交流探讨。</p><p>同时，有能力给项目做贡献的同学，也欢迎积极加入到 <a href="https://github.com/Finb/bark-server">项目</a> 中来，贡献自己的一份力量！</p><p>最后，感谢开发人员们的辛苦付出，让我们能用到这么优秀的项目！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>GitHub官方仓库：<a href="https://github.com/Finb/bark-server">https://github.com/Finb/bark-server</a></p><p>官方文档地址：<a href="https://bark.day.app/">https://bark.day.app</a></p><p>作者博客：<a href="https://day.app/2018/06/bark-server-document/">https://day.app/2018/06/bark-server-document/</a></p><p><a href="https://www.v2ex.com/t/467407">https://www.v2ex.com/t/467407</a></p><p><a href="https://day.app/2018/06/bark-server-document/">https://day.app/2018/06/bark-server-document/</a></p><p><a href="https://github.com/Finb/Bark/blob/master/README.md">https://github.com/Finb/Bark/blob/master/README.md</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-前言&quot;&gt;&lt;a href=&quot;#1-前言&quot; class=&quot;headerlink&quot; title=&quot;1.前言&quot;&gt;&lt;/a&gt;1.前言&lt;/h2&gt;&lt;p&gt;免费、简单、安全，开箱即用！&lt;/p&gt;
&lt;h2 id=&quot;2-项目展示&quot;&gt;&lt;a href=&quot;#2-项目展示&quot; class=&quot;he</summary>
      
    
    
    
    <category term="Docker系列" scheme="https://blog.laoda.de/categories/Docker%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="DockerCompose" scheme="https://blog.laoda.de/tags/DockerCompose/"/>
    
    <category term="Docker部署" scheme="https://blog.laoda.de/tags/Docker%E9%83%A8%E7%BD%B2/"/>
    
    <category term="Bark" scheme="https://blog.laoda.de/tags/Bark/"/>
    
  </entry>
  
  <entry>
    <title>博客换域名+框架啦！</title>
    <link href="https://blog.laoda.de/archives/turn-to-wordpress/"/>
    <id>https://blog.laoda.de/archives/turn-to-wordpress/</id>
    <published>2023-06-19T03:36:46.165Z</published>
    <updated>2023-06-19T13:47:17.026Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://img.laoda.de/i/2023/06/19/ilixux-0.webp" alt="image-20230619112451731"></p><h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><h3 id="YouTube："><a href="#YouTube：" class="headerlink" title="YouTube："></a>YouTube：</h3><p>视频地址：<a href="https://youtu.be/LM4WmyVtLjY">https://youtu.be/LM4WmyVtLjY</a></p><h3 id="哔哩哔哩"><a href="#哔哩哔哩" class="headerlink" title="哔哩哔哩"></a>哔哩哔哩</h3><p>【高清版本可以点击去吐槽到 B 站观看】：</p><p><joe-bilibili bvid="BV1Mm4y1i7tY"></joe-bilibili></p><p>为了给小伙伴们更好地体验，咕咕斥巨资购买了<a href="https://gao.ee/justnews">justnews</a>主题，博客又换回了<a href="https://iwanlab.com/">WordPress</a>了。</p><p>同时为了照顾大家的习惯，尽可能还原了之前Halo主题的风格。</p><p>Wordpress之前咕咕也和大家有过介绍——<a href="https://iwanlab.com/blog-choosing/">Hexo还是Hugo？Typecho还是WordPress？读完这篇或许你就有答案了！</a>，基本上就是相对Halo比较笨重，自定义程度更高（<del>意味着可以放更多的广告位了</del>），后续会逐步把文章搬过来，以后就在新的博客这边更新内容！</p><p>新的博客地址：<a href="https://iwanlab.com/">https://iwanlab.com/</a></p><p>因为后续考虑到会更新一些加密货币、Web3、数字移民的内容，所以咕咕给网站取名为：“<strong>爱玩实验室</strong>”，<code>iwan</code>（爱玩）+<code>lab</code>（实验室）并采用了主流的<code>com</code>域名后缀。</p><p>之后，旧的博客就不再维护更新啦，以后的内容都放在<a href="https://iwanlab.com/">爱玩实验室</a>这个新网站里</p><p>希望能和大家一直一起折腾捣鼓一些好玩儿的东西。</p><h2 id="几大更新"><a href="#几大更新" class="headerlink" title="几大更新"></a>几大更新</h2><h3 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h3><p>因为咕咕一直用的<a href="https://halo.run/">Halo</a>的<a href="https://github.com/qinhua/halo-theme-joe2.0">Joe</a>这款主题，主题作者可能工作比较忙，暂时还未适配Halo2.0，而Halo1.x 已经停止维护了，Halo1.x有一个普遍的问题就是搜索有时候可能不是很准（不过在Halo2.0以后已经有一个非常强大的搜索系统了），可能有不少小伙伴遇到过部分关键词搜索不到结果的情况，这次换新之后应该会好一些了。</p><h3 id="快讯"><a href="#快讯" class="headerlink" title="快讯"></a>快讯</h3><p>右侧栏目新增了快讯功能，会第一时间更新一些VPS到货或者是即时性比较强的信息。</p><h2 id="待完善"><a href="#待完善" class="headerlink" title="待完善"></a>待完善</h2><p>这个主题有一个缺点就是友情链接不太好整，只能显示在首页底部，之前加友链的小伙伴们比较多，全部显示出来不现实，后续尝试看看能不能搞个专门的页面来显示。</p><p>后续可能会考虑加入论坛功能。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://img.laoda.de/i/2023/06/19/ilixux-0.webp&quot; alt=&quot;image-20230619112451731&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;视频&quot;&gt;&lt;a href=&quot;#视频&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="网站搭建" scheme="https://blog.laoda.de/categories/%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA/"/>
    
    
    <category term="爱玩实验室" scheme="https://blog.laoda.de/tags/%E7%88%B1%E7%8E%A9%E5%AE%9E%E9%AA%8C%E5%AE%A4/"/>
    
    <category term="博客迁移" scheme="https://blog.laoda.de/tags/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB/"/>
    
  </entry>
  
</feed>
